<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>This world is a bridge</title>
  <icon>https://www.gravatar.com/avatar/028062b7fd7bdf46904af3a6c9c1030f</icon>
  <subtitle>One wild and precious life</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://angry-bird.github.io/"/>
  <updated>2019-02-07T09:31:44.000Z</updated>
  <id>https://angry-bird.github.io/</id>
  
  <author>
    <name>zuoshi</name>
    <email>archnewbie@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Disassembler</title>
    <link href="https://angry-bird.github.io/2019/01/22/radare2/"/>
    <id>https://angry-bird.github.io/2019/01/22/radare2/</id>
    <published>2019-01-22T00:00:00.000Z</published>
    <updated>2019-02-07T09:31:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orgabae6ce">1. Radare2&#xA0;&#xA0;&#xA0;<span class="tag"><span class="r2">r2</span>&#xA0;<span class="cutter">cutter</span></span></a></li><li><a href="#orgfbdb6ab">2. Interactive Disassembler&#xA0;&#xA0;&#xA0;<span class="tag"><span class="IDA">IDA</span></span></a></li><li><a href="#orgdeeabd1">3. WinDebug</a></li><li><a href="#org895d65f">4. ninja</a></li><li><a href="#org0c7951a">5. OllDbg&#xA0;&#xA0;&#xA0;<span class="tag"><span class="32bit">32bit</span></span></a></li></ul></div></div><a id="more"></a><p>Reverse engineer needs the right disassembler.</p><p>Disassembler can generate assembly language source code from machine-executable code.</p><div id="outline-container-orgabae6ce" class="outline-2"><h2 id="orgabae6ce"><span class="section-number-2">1</span> <a href="https://github.com/radare/radare2" target="_blank" rel="noopener">Radare2</a>&#xA0;&#xA0;&#xA0;<span class="tag"><span class="r2">r2</span>&#xA0;<span class="cutter">cutter</span></span></h2><div class="outline-text-2" id="text-1"><p>Radare2 is new portable set of libraries and tools to work with binary files.Started as a forensics tool, a CLI hexa editor able to open disk files;Later add support for analyzing binaries, disassembling code, debugging programs, attaching to remote gdb servers, etc.</p><p><a href="https://github.com/radareorg/cutter" target="_blank" rel="noopener">cutter</a> is GUI for radare2.</p></div><div id="outline-container-orgc32395a" class="outline-3"><h3 id="orgc32395a"><span class="section-number-3">1.1</span> installation and package management</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Install or update r2</span></span><br><span class="line">sys/install.sh</span><br><span class="line"><span class="comment"># sys/user.sh</span></span><br><span class="line"><span class="comment">### Remove r2</span></span><br><span class="line">make uninstall</span><br><span class="line">make purge</span><br><span class="line">make system-purge</span><br><span class="line"><span class="comment">### Package</span></span><br><span class="line">r2pm init</span><br><span class="line">r2pm update</span><br><span class="line">r2pm install [pkg name]</span><br><span class="line"><span class="comment">### Language bindings</span></span><br><span class="line">r2pm install lang-python3</span><br><span class="line">r2pm install r2api-python</span><br><span class="line">r2pm install r2pipe-py</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org28d454b" class="outline-3"><h3 id="org28d454b"><span class="section-number-3">1.2</span> assembly language</h3><div class="outline-text-3" id="text-1-2"><p><a href="https://www.cs.uaf.edu/2008/fall/cs301/support/x86/" target="_blank" rel="noopener">x86 assembly cheatsheet</a><a href="https://www.cs.virginia.edu/~evans/cs216/guides/x86.html" target="_blank" rel="noopener">x86 assembly guide</a><a href="https://en.wikipedia.org/wiki/X86_assembly_language" target="_blank" rel="noopener">x86 assembly wiki</a><a href="https://en.wikipedia.org/wiki/X86_instruction_listings" target="_blank" rel="noopener">instruction list</a></p></div></div><div id="outline-container-org00156bd" class="outline-3"><h3 id="org00156bd"><span class="section-number-3">1.3</span> Approaches of Reverse-Engineering</h3><div class="outline-text-3" id="text-1-3"></div><div id="outline-container-org429d4b6" class="outline-4"><h4 id="org429d4b6">reverse analyzing</h4></div><div id="outline-container-org7b11bb9" class="outline-4"><h4 id="org7b11bb9">modify executable files</h4><div class="outline-text-4" id="text-org7b11bb9"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r2 -w crackme0x00</span><br><span class="line"><span class="comment">### If file aleady opened</span></span><br><span class="line"><span class="built_in">eval</span> cfg.write=<span class="literal">true</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org4802606" class="outline-4"><h4 id="org4802606">vulnerabilities</h4><div class="outline-text-4" id="text-org4802606"><p>scanf, strcpy &#x2013; stack buffer overflow &#x2013; exploit<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup><sup>, </sup><sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></p></div></div><div id="outline-container-org5bde654" class="outline-4"><h4 id="org5bde654">fuzzy</h4><div class="outline-text-4" id="text-org5bde654"><p>afl, libFuzzer</p></div></div></div><div id="outline-container-org06c7c9e" class="outline-3"><h3 id="org06c7c9e"><span class="section-number-3">1.4</span> Demo</h3><div class="outline-text-3" id="text-1-4"><p><a href="https://github.com/radare/radare2book/blob/master/crackmes/ioli/IOLI-crackme.tar.gz" target="_blank" rel="noopener">crackme files link</a></p><ul class="org-ul"><li>radare2 startup<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup></li><li>crackme<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup><sup>, </sup><sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup></li></ul></div></div><div id="outline-container-orgd5ce528" class="outline-3"><h3 id="orgd5ce528"><span class="section-number-3">1.5</span> Usage</h3><div class="outline-text-3" id="text-1-5"></div><div id="outline-container-org21fc17f" class="outline-4"><h4 id="org21fc17f">binary info extrator</h4><div class="outline-text-4" id="text-org21fc17f"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rabin2 -S crackme0x00</span><br><span class="line">r2 crackme0x00</span><br><span class="line"><span class="comment">### ? without blank after command display help</span></span><br><span class="line"><span class="comment">## seek addr/func/var</span></span><br><span class="line">s section..comment</span><br><span class="line">ps 128</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org1c3c98e" class="outline-4"><h4 id="org1c3c98e">analyse all and print disassembled functions</h4><div class="outline-text-4" id="text-org1c3c98e"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r2 crackme0x00</span><br><span class="line">aa</span><br><span class="line">pdf</span><br><span class="line">pdf@sym.main</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org8dccd03" class="outline-4"><h4 id="org8dccd03">Visual View of program</h4><div class="outline-text-4" id="text-org8dccd03"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VV</span><br><span class="line">p/P toggle graph mode</span><br><span class="line">: r2 commands</span><br><span class="line">! <span class="keyword">for</span> debug</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org83428e6" class="outline-4"><h4 id="org83428e6">Forms of variables</h4><div class="outline-text-4" id="text-org83428e6"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### all forms of var</span></span><br><span class="line">? 0x149a</span><br><span class="line"><span class="comment">### var type</span></span><br><span class="line">ps @ addr</span><br><span class="line">px size @ addr/func</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org675e295" class="outline-4"><h4 id="org675e295">Project for reverse-engineer</h4><div class="outline-text-4" id="text-org675e295"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">P</span><br><span class="line">Po ioli00</span><br><span class="line">Ps ioli00</span><br><span class="line">s main</span><br><span class="line">afv</span><br><span class="line">afvn input local_4h</span><br><span class="line">afv- local_4h_2</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org882a9e8" class="outline-3"><h3 id="org882a9e8"><span class="section-number-3">1.6</span> Utils</h3><div class="outline-text-3" id="text-1-6"></div><div id="outline-container-orga20b9d4" class="outline-4"><h4 id="orga20b9d4">rasm2  disassembling</h4><div class="outline-text-4" id="text-orga20b9d4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rasm2 -a x86 -b 32 -d <span class="string">&quot;0x740e&quot;</span></span><br><span class="line"><span class="comment">### Reverse</span></span><br><span class="line">rasm2 -a x86 -b 32 <span class="string">&quot;jmp 0x10&quot;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org56121b7" class="outline-4"><h4 id="org56121b7">rax2  x</h4><div class="outline-text-4" id="text-org56121b7"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### rax2 s hexstr to raw</span></span><br><span class="line">rax2 -s 414243</span><br><span class="line">rax2 0x149a</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org167c254" class="outline-4"><h4 id="org167c254">rabin2  binary</h4><div class="outline-text-4" id="text-org167c254"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabin2 -z crackme0x00</span><br><span class="line">rabin2 -I crackme0x00</span><br><span class="line">rabin2 -l crackme0x00</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org51ecf01" class="outline-4"><h4 id="org51ecf01">rahash2 hash</h4><div class="outline-text-4" id="text-org51ecf01"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rahash2 -a md5 -s string</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="outline-container-orgfbdb6ab" class="outline-2"><h2 id="orgfbdb6ab"><span class="section-number-2">2</span> <a href="https://en.wikipedia.org/wiki/Interactive_Disassembler" target="_blank" rel="noopener">Interactive Disassembler</a>&#xA0;&#xA0;&#xA0;<span class="tag"><span class="IDA">IDA</span></span></h2><div class="outline-text-2" id="text-2"><p>Latest full version of IDA Pro is commercial, while an earlier and less capable version is available for download and free<sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup>.</p></div></div><div id="outline-container-orgdeeabd1" class="outline-2"><h2 id="orgdeeabd1"><span class="section-number-2">3</span> <a href="https://en.wikipedia.org/wiki/WinDbg" target="_blank" rel="noopener">WinDebug</a></h2><div class="outline-text-2" id="text-3"><p>Microsoft&apos;s bebugger.</p></div></div><div id="outline-container-org895d65f" class="outline-2"><h2 id="org895d65f"><span class="section-number-2">4</span> <a href="https://binary.ninja/" target="_blank" rel="noopener">ninja</a></h2></div><div id="outline-container-org0c7951a" class="outline-2"><h2 id="org0c7951a"><span class="section-number-2">5</span> <a href="http://www.ollydbg.de/" target="_blank" rel="noopener">OllDbg</a>&#xA0;&#xA0;&#xA0;<span class="tag"><span class="32bit">32bit</span></span></h2><div class="outline-text-2" id="text-5"><p>A 32-bit assembler level analysing debugger for windows, latest version 2.0.1h updated at <span class="timestamp-wrapper"><span class="timestamp">[2013-09-27 Fri]</span></span>.64-bit <a href="http://www.ollydbg.de/odbg64.html" target="_blank" rel="noopener">OllyDbg 64</a> is promised and updated at <span class="timestamp-wrapper"><span class="timestamp">[2014-02-05 Wed]</span></span>.</p></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.jianshu.com/p/58d03dd3680a" target="_blank" rel="noopener">https://www.jianshu.com/p/58d03dd3680a</a></p></div></div><div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/pannengzhi/p/exploit-the-stack.html" target="_blank" rel="noopener">https://www.cnblogs.com/pannengzhi/p/exploit-the-stack.html</a></p></div></div><div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/pannengzhi/p/play-with-radare2.html" target="_blank" rel="noopener">https://www.cnblogs.com/pannengzhi/p/play-with-radare2.html</a></p></div></div><div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/pannengzhi/p/2018-02-11-ioli-crackme1-5.html" target="_blank" rel="noopener">https://www.cnblogs.com/pannengzhi/p/2018-02-11-ioli-crackme1-5.html</a></p></div></div><div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/pannengzhi/p/2018-03-10-ioli-crackme6-9.html" target="_blank" rel="noopener">https://www.cnblogs.com/pannengzhi/p/2018-03-10-ioli-crackme6-9.html</a></p></div></div><div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara"><a href="http://www.hex-rays.com/idapro/idadownfreeware.html" target="_blank" rel="noopener">http://www.hex-rays.com/idapro/idadownfreeware.html</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgabae6ce&quot;&gt;1. Radare2&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span class=&quot;tag&quot;&gt;&lt;span class=&quot;r2&quot;&gt;r2&lt;/span&gt;&amp;#xA0;&lt;span class=&quot;cutter&quot;&gt;cutter&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgfbdb6ab&quot;&gt;2. Interactive Disassembler&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span class=&quot;tag&quot;&gt;&lt;span class=&quot;IDA&quot;&gt;IDA&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgdeeabd1&quot;&gt;3. WinDebug&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org895d65f&quot;&gt;4. ninja&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org0c7951a&quot;&gt;5. OllDbg&amp;#xA0;&amp;#xA0;&amp;#xA0;&lt;span class=&quot;tag&quot;&gt;&lt;span class=&quot;32bit&quot;&gt;32bit&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="reverse-engineer" scheme="https://angry-bird.github.io/categories/reverse-engineer/"/>
    
    
      <category term="disassembler" scheme="https://angry-bird.github.io/tags/disassembler/"/>
    
      <category term="r2" scheme="https://angry-bird.github.io/tags/r2/"/>
    
      <category term="ida" scheme="https://angry-bird.github.io/tags/ida/"/>
    
      <category term="reverse-engineer" scheme="https://angry-bird.github.io/tags/reverse-engineer/"/>
    
  </entry>
  
  <entry>
    <title>python3_newbie</title>
    <link href="https://angry-bird.github.io/2018/12/05/python3_newbie/"/>
    <id>https://angry-bird.github.io/2018/12/05/python3_newbie/</id>
    <published>2018-12-05T00:00:00.000Z</published>
    <updated>2018-12-05T05:06:26.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org905fb7a">1. variables</a></li></ul></div></div><a id="more"></a><div id="outline-container-org905fb7a" class="outline-2"><h2 id="org905fb7a"><span class="section-number-2">1</span> variables</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-orgbb1e7ec" class="outline-3"><h3 id="orgbb1e7ec"><span class="section-number-3">1.1</span> print binary of variables</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var = <span class="string">&apos;test&apos;</span></span><br><span class="line">print(var.encode(<span class="string">&apos;utf-8&apos;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> var.encode(<span class="string">&apos;utf-8&apos;</span>) == <span class="string">b&apos;\xef\xbb\xbf&apos;</span> :</span><br><span class="line">    print(<span class="string">&apos;nul&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> var <span class="keyword">and</span> var.encode(<span class="string">&apos;utf-8&apos;</span>) != <span class="string">b&apos;\xef\xbb\xbf&apos;</span> :</span><br><span class="line">    print(<span class="string">&apos;available&apos;</span>)</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org905fb7a&quot;&gt;1. variables&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="python" scheme="https://angry-bird.github.io/categories/python/"/>
    
    
      <category term="python3" scheme="https://angry-bird.github.io/tags/python3/"/>
    
  </entry>
  
  <entry>
    <title>crawler</title>
    <link href="https://angry-bird.github.io/2018/11/28/crawler/"/>
    <id>https://angry-bird.github.io/2018/11/28/crawler/</id>
    <published>2018-11-28T00:00:00.000Z</published>
    <updated>2018-12-05T13:35:41.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orga9021f3">1. Basic</a></li><li><a href="#org7ca0b49">2. beautifulsoup</a></li><li><a href="#org8cbea51">3. Crawler</a></li><li><a href="#org3702a1e">4. PhantomJS</a></li><li><a href="#org6be2eff">5. selenium</a></li><li><a href="#orgd34ccbc">6. scrapy</a></li><li><a href="#orgf6251cd">7. query movie info from dianying.fm</a></li><li><a href="#org49669a0">8. query movie info from movie.douban.com</a></li><li><a href="#org23e6b30">9. query movie info from baidu baike</a></li></ul></div></div><a id="more"></a><p>Use requests to get GET results, and BeautifulSoup to parse it (html).Or urllib to do the basic parse, and lxml is a great tool to parse xml.</p><div id="outline-container-orga9021f3" class="outline-2"><h2 id="orga9021f3"><span class="section-number-2">1</span> Basic</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-orgdd24bb8" class="outline-3"><h3 id="orgdd24bb8"><span class="section-number-3">1.1</span> packages</h3><div class="outline-text-3" id="text-1-1"><ul class="org-ul"><li><code>urllib</code> is python official module and not as efficient as 3rd-party downloader <code>requests</code>.</li><li>We may need cookie, proxy, https, Redirect handlers to download the target webpage.</li><li><code>beautifulsoup</code> is the ideal parser for html and lxml.</li></ul><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> lxml</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org088bcb3" class="outline-3"><h3 id="org088bcb3"><span class="section-number-3">1.2</span> requests</h3><div class="outline-text-3" id="text-1-2"></div><div id="outline-container-org2465cfe" class="outline-4"><h4 id="org2465cfe">regular request</h4><div class="outline-text-4" id="text-org2465cfe"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = urllib.request.urlopen(url)</span><br><span class="line">print(res.getcode() == <span class="number">200</span>)</span><br><span class="line">cont = res.read().decode(<span class="string">&apos;utf-8)</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgd6cf742" class="outline-4"><h4 id="orgd6cf742">request with data and header</h4><div class="outline-text-4" id="text-orgd6cf742"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">req = urllib.request.Request(url)</span><br><span class="line">req.data = <span class="string">&apos;demo&apos;</span></span><br><span class="line">req.add_header(<span class="string">&apos;User-Agent&apos;</span>, <span class="string">&apos;Mozilla/5.0&apos;</span>)</span><br><span class="line">req.add_header(<span class="string">&apos;Origin&apos;</span>, <span class="string">&apos;https://baike.baidu.com&apos;</span>)</span><br><span class="line">resp = urllib.request.urlopen(req)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf683845" class="outline-4"><h4 id="orgf683845">request with cookiejar</h4><div class="outline-text-4" id="text-orgf683845"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cj = http.cookiejar.CookieJar()</span><br><span class="line">opr = urllib.request.build_opener(urllib.request.HTTPCookieProcessor(cj))</span><br><span class="line">urllib.request.install_opener(opener)</span><br><span class="line">resp = urllib.request.urlopen(url)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org5a9312d" class="outline-4"><h4 id="org5a9312d">post</h4><div class="outline-text-4" id="text-org5a9312d"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">      <span class="keyword">from</span> urllib.request <span class="keyword">import</span> Request</span><br><span class="line">      <span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line">      req = Request(url)</span><br><span class="line">      postData = parse.urlencode([</span><br><span class="line">          (key1, value1),</span><br><span class="line">          (key2, value2),</span><br><span class="line">          ...</span><br><span class="line">      ])</span><br><span class="line">      urlopen(req, data=postData.encode(<span class="string">&apos;utf-8&apos;</span>))</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org5eace2a" class="outline-3"><h3 id="org5eace2a"><span class="section-number-3">1.3</span> random user agents</h3><div class="outline-text-3" id="text-1-3"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">User_Agents =[</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11&apos;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">    headers = {<span class="string">&apos;User-Agent&apos;</span>: random.choice(User_Agents)}</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org7ca0b49" class="outline-2"><h2 id="org7ca0b49"><span class="section-number-2">2</span> beautifulsoup<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></h2><div class="outline-text-2" id="text-2"></div><div id="outline-container-orgb5ae031" class="outline-3"><h3 id="orgb5ae031"><span class="section-number-3">2.1</span> make soup</h3><div class="outline-text-3" id="text-2-1"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">html = urlopen(url).read().decode(<span class="string">&apos;utf-8&apos;</span>)</span><br><span class="line">soup = BeautifulSoup(html, features=<span class="string">&apos;lxml&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### store webpage at local</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&apos;index.html&apos;</span>, <span class="string">&apos;w&apos;</span>) <span class="keyword">as</span> h:</span><br><span class="line">    h.write(html)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf44787a" class="outline-3"><h3 id="orgf44787a"><span class="section-number-3">2.2</span> re</h3><div class="outline-text-3" id="text-2-2"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">soup.find(<span class="string">&apos;a&apos;</span>, href=re.compile(<span class="string">r&quot;view&quot;</span>))</span><br><span class="line">soup.find_all(<span class="string">&quot;img&quot;</span>, {<span class="string">&quot;src&quot;</span>:re.compile(<span class="string">&quot;xxx&quot;</span>)})</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org1445877" class="outline-3"><h3 id="org1445877"><span class="section-number-3">2.3</span> soup find</h3><div class="outline-text-3" id="text-2-3"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wiki = soup.find(mu=re.compile(<span class="string">&quot;baike.baidu.com&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> wiki:</span><br><span class="line">    <span class="keyword">return</span> (wiki[<span class="string">&apos;mu&apos;</span>])</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awiki = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&apos;result c-container &apos;</span>)</span><br><span class="line"><span class="keyword">if</span> awiki:</span><br><span class="line">    <span class="keyword">return</span> (awiki.a[<span class="string">&apos;href&apos;</span>])</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org8c87aa3" class="outline-3"><h3 id="org8c87aa3"><span class="section-number-3">2.4</span> soup tag</h3><div class="outline-text-3" id="text-2-4"><p>Tag are list for storage.</p><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">print(wiki.attrs)</span><br><span class="line"><span class="keyword">print</span> (wiki[<span class="string">&apos;mu&apos;</span>])</span><br><span class="line"><span class="keyword">print</span> (awiki.a[<span class="string">&apos;href&apos;</span>])</span><br><span class="line"><span class="keyword">print</span> (awiki.a.get_text())</span><br><span class="line">bsobj.find(<span class="string">&quot;table&quot;</span>, {<span class="string">&quot;id&quot;</span>:<span class="string">&quot;giftlist&quot;</span>}).children</span><br><span class="line">bsobj.find(<span class="string">&quot;table&quot;</span>, {<span class="string">&quot;id&quot;</span>:<span class="string">&quot;giftlist&quot;</span>}).descendants</span><br><span class="line">bsobj.find(<span class="string">&quot;table&quot;</span>, {<span class="string">&quot;id&quot;</span>:<span class="string">&quot;giftlist&quot;</span>}).tr.next_siblings</span><br><span class="line">bsobj.find(<span class="string">&quot;table&quot;</span>, {<span class="string">&quot;id&quot;</span>:<span class="string">&quot;giftlist&quot;</span>}).tr.previous_siblings</span><br><span class="line">bsobj.find(<span class="string">&quot;table&quot;</span>, {<span class="string">&quot;id&quot;</span>:<span class="string">&quot;giftlist&quot;</span>}).tr.parent</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org8cbea51" class="outline-2"><h2 id="org8cbea51"><span class="section-number-2">3</span> Crawler</h2><div class="outline-text-2" id="text-3"><p>Now we are able to write a full function crawler, just with these fundamental tools.But code as sophisticated programmer, we must consider error capture.</p></div><div id="outline-container-org0574094" class="outline-3"><h3 id="org0574094"><span class="section-number-3">3.1</span> urlopen error</h3><div class="outline-text-3" id="text-3-1"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  html = urlopen(<span class="string">&quot;http://www.pythonscraping.com/pages/page1.html&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> HTTPError <span class="keyword">as</span> e:</span><br><span class="line">  print(e)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org7c8dc8a" class="outline-3"><h3 id="org7c8dc8a"><span class="section-number-3">3.2</span> soup check</h3><div class="outline-text-3" id="text-3-2"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    badContent = bsObj.nonExistingTag.anotherTag</span><br><span class="line">exceptAttributeError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&quot;Tag was not found&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> badContent == <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">&quot;Tag was not found&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(badContent)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgffae8ab" class="outline-3"><h3 id="orgffae8ab"><span class="section-number-3">3.3</span> crawler framework</h3><div class="outline-text-3" id="text-3-3"><ul class="org-ul"><li>crawler_main.py</li><li>url_manager.py</li><li>html_downloader.py</li><li>html_parser.py</li><li>meta_storage.py</li></ul></div></div><div id="outline-container-orgc14fe5d" class="outline-3"><h3 id="orgc14fe5d"><span class="section-number-3">3.4</span> url_manager</h3><div class="outline-text-3" id="text-3-4"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrlManager</span><span class="params">(object)</span>:</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">          self.new_urls = set()</span><br><span class="line">          self.old_urls = set()</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">add_new_url</span><span class="params">(self, url)</span>:</span></span><br><span class="line">          <span class="keyword">if</span> url <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">if</span> url <span class="keyword">not</span> <span class="keyword">in</span> self.new_urls <span class="keyword">or</span> self.old_urls:</span><br><span class="line">              self.new_urls.add(url)</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">add_new_urls</span><span class="params">(self, urls)</span>:</span></span><br><span class="line">          <span class="keyword">if</span> urls <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> len(urls) == <span class="number">0</span>:</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">              self.add_new_url(url)</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">has_new_url</span><span class="params">(self)</span>:</span></span><br><span class="line">          <span class="keyword">return</span> len(self.new_urls) != <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">get_new_url</span><span class="params">(self)</span>:</span></span><br><span class="line">          new_url = self.new_urls.pop()</span><br><span class="line">          self.old_urls.add(new_url)</span><br><span class="line">          <span class="keyword">return</span> new_url</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">HtmlDownloader</span><span class="params">(object)</span>:</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(self, url)</span>:</span></span><br><span class="line">          <span class="keyword">if</span> url <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">          response = urllib.request.urlopen(url)</span><br><span class="line">          <span class="keyword">if</span> response.getcode() != <span class="number">200</span>:</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">          <span class="keyword">return</span> response.read()</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org4bdb599" class="outline-3"><h3 id="org4bdb599"><span class="section-number-3">3.5</span> html_parser</h3><div class="outline-text-3" id="text-3-5"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">  <span class="keyword">import</span> urllib.parse</span><br><span class="line">  <span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">HtmlParser</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">_get_new_urls</span><span class="params">(self, page_url, soup)</span>:</span></span><br><span class="line">          new_urls = set()</span><br><span class="line">          links = soup.find_all(<span class="string">&apos;a&apos;</span>, href = re.compile(<span class="string">r&quot;/item/&quot;</span>))</span><br><span class="line">          <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">              new_url = link[<span class="string">&apos;href&apos;</span>]</span><br><span class="line">              new_full_url = urllib.parse.urljoin(page_url, new_url)</span><br><span class="line">              new_urls.add(new_full_url)</span><br><span class="line">          <span class="keyword">return</span> new_urls</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">_get_new_data</span><span class="params">(self, page_url, soup)</span>:</span></span><br><span class="line">          res_data = {}</span><br><span class="line">          res_data[<span class="string">&apos;url&apos;</span>] = page_url</span><br><span class="line">          title_node = soup.find(<span class="string">&apos;dd&apos;</span>, class_=<span class="string">&quot;lemmaWgt-lemmaTitle-title&quot;</span>).find(<span class="string">&quot;h1&quot;</span>)</span><br><span class="line">          res_data[<span class="string">&apos;title&apos;</span>] = title_node.get_text()</span><br><span class="line">          summary_node = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&quot;lemma-summary&quot;</span>)</span><br><span class="line">          res_data[<span class="string">&apos;summary&apos;</span>] = summary_node.get_text()</span><br><span class="line">          <span class="keyword">return</span> res_data</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, page_url, html_cont)</span>:</span></span><br><span class="line">          <span class="keyword">if</span> page_url <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> html_cont <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">          soup = BeautifulSoup(html_cont, <span class="string">&apos;html.parser&apos;</span>, from_encoding=<span class="string">&apos;utf-8&apos;</span>)</span><br><span class="line">          new_urls = self._get_new_urls(page_url, soup)</span><br><span class="line">          new_data = self._get_new_data(page_url, soup)</span><br><span class="line">          <span class="keyword">return</span> new_urls, new_data</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org967fff0" class="outline-3"><h3 id="org967fff0"><span class="section-number-3">3.6</span> crawler_main</h3><div class="outline-text-3" id="text-3-6"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line">  <span class="keyword">from</span> baike_spider <span class="keyword">import</span> url_manager, html_downloader, html_parser, html_outputer</span><br><span class="line">  <span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">CrawlerMain</span><span class="params">(object)</span>:</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">          self.urls = url_manager.UrlManager()</span><br><span class="line">          self.downloader = html_downloader.HtmlDownloader()</span><br><span class="line">          self.parser = html_parser.HtmlParser()</span><br><span class="line">          self.outputer = html_outputer.HtmlOutputer()</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">crawl</span><span class="params">(self, root_url)</span>:</span></span><br><span class="line">          count = <span class="number">1</span> <span class="comment"># record the current number url</span></span><br><span class="line">          self.urls.add_new_url(root_url)</span><br><span class="line">          <span class="keyword">while</span> self.urls.has_new_url():</span><br><span class="line">              <span class="keyword">try</span>:</span><br><span class="line">                  new_url = self.urls.get_new_url()</span><br><span class="line">                  print(<span class="string">&apos;crawl No.%d: %s&apos;</span>%(count, new_url))</span><br><span class="line">                  html_cont = self.downloader.download(new_url)</span><br><span class="line">                  new_urls, new_data = self.parser.parse(new_url, html_cont)</span><br><span class="line">                  self.urls.add_new_urls(new_urls)</span><br><span class="line">                  self.outputer.collect_data(new_data)</span><br><span class="line">                  <span class="keyword">if</span> count == <span class="number">1000</span>:</span><br><span class="line">                      <span class="keyword">break</span></span><br><span class="line">                  count += <span class="number">1</span></span><br><span class="line">              <span class="keyword">except</span>:</span><br><span class="line">                  logging.warning(<span class="string">&apos;crawl failed&apos;</span>)</span><br><span class="line">          self.outputer.output_html()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">      root_url = <span class="string">&quot;https://baike.baidu.com/item/Python/407313&quot;</span></span><br><span class="line">      obj_spider = CrawlerMain()</span><br><span class="line">      obj_spider.crawl(root_url)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org04dc88f" class="outline-3"><h3 id="org04dc88f"><span class="section-number-3">3.7</span> meta_storage</h3><div class="outline-text-3" id="text-3-7"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlOutputer</span><span class="params">(object)</span>:</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">          self.datas = []</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">collect_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">          <span class="keyword">if</span> data <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">          self.datas.append(data)</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">output_html</span><span class="params">(self)</span>:</span></span><br><span class="line">          <span class="keyword">with</span> open(<span class="string">&apos;output.html&apos;</span>, <span class="string">&apos;w&apos;</span>, encoding=<span class="string">&apos;utf-8&apos;</span>) <span class="keyword">as</span> fout:</span><br><span class="line">              fout.write(<span class="string">&quot;&lt;html&gt;&quot;</span>)</span><br><span class="line">              fout.write(<span class="string">&quot;&lt;head&gt;&lt;meta http-equiv=\&quot;content-type\&quot; content=\&quot;text/html;charset=utf-8\&quot;&gt;&lt;/head&gt;&quot;</span>)</span><br><span class="line">              fout.write(<span class="string">&quot;&lt;body&gt;&quot;</span>)</span><br><span class="line">              fout.write(<span class="string">&quot;&lt;table&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">              <span class="keyword">for</span> data <span class="keyword">in</span> self.datas:</span><br><span class="line">                  fout.write(<span class="string">&quot;&lt;tr&gt;&quot;</span>)</span><br><span class="line">                  fout.write(<span class="string">&quot;&lt;td&gt;%s&lt;/td&gt;&quot;</span> % data[<span class="string">&quot;url&quot;</span>])</span><br><span class="line">                  fout.write(<span class="string">&quot;&lt;td&gt;%s&lt;/td&gt;&quot;</span> % data[<span class="string">&quot;title&quot;</span>])</span><br><span class="line">                  fout.write(<span class="string">&quot;&lt;td&gt;%s&lt;/td&gt;&quot;</span> % data[<span class="string">&quot;summary&quot;</span>])</span><br><span class="line">                  fout.write(<span class="string">&quot;&lt;/tr&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">              fout.write(<span class="string">&quot;&lt;/table&gt;&quot;</span>)</span><br><span class="line">              fout.write(<span class="string">&quot;&lt;/body&gt;&quot;</span>)</span><br><span class="line">              fout.write(<span class="string">&quot;&lt;/html&gt;&quot;</span>)</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org3702a1e" class="outline-2"><h2 id="org3702a1e"><span class="section-number-2">4</span> PhantomJS<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></h2><div class="outline-text-2" id="text-4"><p>Webpage may apply code confusion with js code, while soup can only parse html page.The data is in window._DATA_, use CasperJS or PhantomJS headless browser to parse it.</p><p>If webpage needs login to GET, then use headless browser like PhantomJS or chrome headless.Or we write code to decode js code, or write a light browser.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap homebrew/cask</span><br><span class="line">brew cask install phantomjs</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org6be2eff" class="outline-2"><h2 id="org6be2eff"><span class="section-number-2">5</span> selenium</h2><div class="outline-text-2" id="text-5"><p>Selenium is operate browser to decode js, which will be a little slow.Here is the demo.<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup></p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install selenium</span><br></pre></td></tr></table></figure></div><p><a href="https://sites.google.com/a/chromium.org/chromedriver/home" target="_blank" rel="noopener">For chrome</a></p></div></div><div id="outline-container-orgd34ccbc" class="outline-2"><h2 id="orgd34ccbc"><span class="section-number-2">6</span> scrapy</h2></div><div id="outline-container-orgf6251cd" class="outline-2"><h2 id="orgf6251cd"><span class="section-number-2">7</span> query movie info from dianying.fm</h2><div class="outline-text-2" id="text-7"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> lxml</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">User_Agents =[</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11&apos;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_movie</span><span class="params">(query_str)</span>:</span></span><br><span class="line">    headers = {<span class="string">&apos;User-Agent&apos;</span>: random.choice(User_Agents)}</span><br><span class="line">    num = <span class="string">&apos;&apos;</span>.join(random.sample(string.digits + string.ascii_letters, <span class="number">11</span>))</span><br><span class="line">    cookie = {<span class="string">&apos;bid&apos;</span>: num, <span class="string">&apos;ll&apos;</span>: <span class="string">&apos;&quot;108296&quot;&apos;</span>}</span><br><span class="line">    base_url = <span class="string">&quot;http://dianying.fm/search/?text=&quot;</span></span><br><span class="line">    query_url = quote(query_str)</span><br><span class="line">    url = base_url + query_url</span><br><span class="line">    soup = BeautifulSoup(requests.get(url).text, <span class="string">&apos;html.parser&apos;</span>)</span><br><span class="line">    info = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&apos;fm-movie-title&apos;</span>)</span><br><span class="line">    <span class="keyword">if</span> info:</span><br><span class="line">        <span class="keyword">return</span> info.get_text().replace(<span class="string">&apos;\n&apos;</span>,<span class="string">&quot;&quot;</span>).strip()+<span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> query_str</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&apos;movies.txt&apos;</span>,encoding=<span class="string">&apos;utf-8&apos;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    result = set()</span><br><span class="line">    <span class="keyword">for</span> lines <span class="keyword">in</span> f.readlines():</span><br><span class="line">        result.add(get_movie(lines))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&apos;mres.txt&apos;</span>,<span class="string">&apos;w&apos;</span>,encoding=<span class="string">&apos;utf-8&apos;</span>) <span class="keyword">as</span> fo:</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">if</span> r:</span><br><span class="line">            fo.write(r)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org49669a0" class="outline-2"><h2 id="org49669a0"><span class="section-number-2">8</span> query movie info from movie.douban.com</h2><div class="outline-text-2" id="text-8"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">&apos;--headless&apos;</span>)</span><br><span class="line">driver = webdriver.Chrome(chrome_options=chrome_options)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_raw</span><span class="params">(query_str)</span>:</span></span><br><span class="line">    base_url = <span class="string">&quot;https://movie.douban.com/subject_search?search_text=&quot;</span></span><br><span class="line">    query_url = quote(query_str)</span><br><span class="line">    url = base_url + query_url</span><br><span class="line">    driver.get(url)</span><br><span class="line">    print(driver.title)</span><br><span class="line">    iroot = driver.find_element_by_class_name(<span class="string">&apos;item-root&apos;</span>)</span><br><span class="line">    print(iroot)</span><br><span class="line">    driver.quit()</span><br><span class="line"></span><br><span class="line">get_raw(<span class="string">&apos;&#x5343;&#x4E0E;&#x5343;&#x5BFB;&apos;</span>)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org23e6b30" class="outline-2"><h2 id="org23e6b30"><span class="section-number-2">9</span> query movie info from baidu baike</h2><div class="outline-text-2" id="text-9"></div><div id="outline-container-org35cd35b" class="outline-3"><h3 id="org35cd35b"><span class="section-number-3">9.1</span> baike lemmaWgt</h3><div class="outline-text-3" id="text-9-1"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> lxml</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">User_Agents =[</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11&apos;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_movie</span><span class="params">(query_str)</span>:</span></span><br><span class="line">    headers = {<span class="string">&apos;User-Agent&apos;</span>: random.choice(User_Agents)}</span><br><span class="line">    num = <span class="string">&apos;&apos;</span>.join(random.sample(string.digits + string.ascii_letters, <span class="number">11</span>))</span><br><span class="line">    cookie = {<span class="string">&apos;bid&apos;</span>: num, <span class="string">&apos;ll&apos;</span>: <span class="string">&apos;&quot;108296&quot;&apos;</span>}</span><br><span class="line">    base_url = <span class="string">&quot;https://baike.baidu.com/item/&quot;</span></span><br><span class="line">    query_url = quote(query_str)</span><br><span class="line">    url = base_url + query_url</span><br><span class="line">    <span class="comment"># print (url)</span></span><br><span class="line">    html = urlopen(url).read().decode(<span class="string">&apos;utf-8&apos;</span>)</span><br><span class="line">    soup = BeautifulSoup(html, features=<span class="string">&apos;lxml&apos;</span>)</span><br><span class="line">   <span class="comment"># soup = BeautifulSoup(html, &apos;html.parser&apos;)</span></span><br><span class="line">   <span class="comment"># with open(&apos;index.html&apos;, &apos;w&apos;) as h:</span></span><br><span class="line">   <span class="comment">#     h.write(html)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># for str in soup.strings:</span></span><br><span class="line">    <span class="comment"># for str in soup.stripped_strings:</span></span><br><span class="line">    <span class="comment">#     print(str)</span></span><br><span class="line">    <span class="comment"># print(soup.li.next_siblings)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print (soup.title)</span></span><br><span class="line">    info = soup.find(<span class="string">&apos;dd&apos;</span>, class_=<span class="string">&apos;lemmaWgt-lemmaTitle-keyInfo&apos;</span>)</span><br><span class="line">    name = soup.find(<span class="string">&apos;h1&apos;</span>)</span><br><span class="line">    <span class="comment"># name = soup.find(&apos;dd&apos;, class_=&apos;lemmaWgt-lemmaTitle-title&apos;)</span></span><br><span class="line">    subtitle = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&apos;lemmaWgt-subLemmaListTitle&apos;</span>)</span><br><span class="line">    <span class="keyword">if</span> subtitle:</span><br><span class="line">        <span class="comment"># lis = soup.find_all(&apos;li&apos;, class_=&apos;list-dot list-dot-paddingleft&apos;)</span></span><br><span class="line">        lis = soup.find_all(<span class="string">&apos;li&apos;</span>, class_=<span class="string">&apos;list-dot list-dot-paddingleft&apos;</span>, string=re.compile(<span class="string">&quot;&#x7535;&#x5F71;&quot;</span>))</span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> lis:</span><br><span class="line">            print(l.string)</span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">        <span class="comment"># if info:</span></span><br><span class="line">        <span class="comment">#     print (info.string)</span></span><br><span class="line">            <span class="comment"># if name:</span></span><br><span class="line">    <span class="comment">#     print (name.string)</span></span><br><span class="line">        <span class="comment"># print(type(info.get_text()))</span></span><br><span class="line">        <span class="comment"># print(info.get_text())</span></span><br><span class="line">        <span class="comment"># return info.get_text().replace(&apos;\n&apos;,&quot;&quot;).strip()+&quot;\n&quot;</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">        <span class="comment"># info = soup.find(&apos;div&apos;, class_=&apos;lemmaWgt-lemmaTitle-keyInfo&apos;)</span></span><br><span class="line">        <span class="comment"># print (info)</span></span><br><span class="line">        <span class="comment"># return query_str</span></span><br><span class="line"></span><br><span class="line">   binfo = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&apos;basic-info cmn-clearfix&apos;</span>)</span><br><span class="line">   <span class="keyword">if</span> binfo <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">       linfo = [x.replace(<span class="string">&apos;\xa0&apos;</span>,<span class="string">&quot;&quot;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> list(binfo.stripped_strings)]</span><br><span class="line">       i = iter(linfo)</span><br><span class="line">       d = dict(zip(i,i))</span><br><span class="line">       print(d)</span><br><span class="line"></span><br><span class="line">       names = binfo.find_all(<span class="string">&apos;dt&apos;</span>)</span><br><span class="line">       vals = binfo.find_all(<span class="string">&apos;dd&apos;</span>)</span><br><span class="line">       <span class="keyword">for</span> n <span class="keyword">in</span> names:</span><br><span class="line">           print(n.get_text(strip=<span class="keyword">True</span>).replace(<span class="string">&apos;\xa0&apos;</span>,<span class="string">&apos;&apos;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       names = [n.get_text(strip=<span class="keyword">True</span>).replace(<span class="string">&apos;\xa0&apos;</span>,<span class="string">&apos;&apos;</span>) <span class="keyword">for</span> n <span class="keyword">in</span> binfo.find_all(<span class="string">&apos;dt&apos;</span>)]</span><br><span class="line">       <span class="keyword">print</span> (names)</span><br><span class="line">       vals = [<span class="string">&quot;&quot;</span>.join(n.get_text(strip=<span class="keyword">True</span>).split()) <span class="keyword">for</span> n <span class="keyword">in</span> binfo.find_all(<span class="string">&apos;dd&apos;</span>)]</span><br><span class="line">       <span class="keyword">print</span> (vals)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&apos;mov.txt&apos;</span>,encoding=<span class="string">&apos;utf-8&apos;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = <span class="number">1</span></span><br><span class="line">    result = set()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="comment"># if flag == 1:</span></span><br><span class="line">        <span class="comment">#     line = line[1:]</span></span><br><span class="line">        <span class="comment"># print(line.strip(&apos;\n&apos;))</span></span><br><span class="line">        result.add(get_movie(line.strip(<span class="string">&apos;\n&apos;</span>)))</span><br><span class="line">    <span class="comment"># print(result)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           <span class="comment">### It&apos;s for dicts</span></span><br><span class="line">           hdr = d.keys()</span><br><span class="line">           vals = d.values()</span><br><span class="line">           csvwr = csv.DictWriter(csvfile, fieldnames = hdr)</span><br><span class="line">           csvwr.writeheader()</span><br><span class="line">           csvwr.writerow(d)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&apos;mres.txt&apos;</span>,<span class="string">&apos;w&apos;</span>,encoding=<span class="string">&apos;utf-8&apos;</span>) <span class="keyword">as</span> fo:</span><br><span class="line">    <span class="comment"># fo.write(str(result))</span></span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">if</span> r:</span><br><span class="line">            fo.write(r)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org52bbf18" class="outline-3"><h3 id="org52bbf18"><span class="section-number-3">9.2</span> dict 2 csv/txt<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup></h3><div class="outline-text-3" id="text-9-2"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> lxml</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">User_Agents =[</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11&apos;</span>,</span><br><span class="line">    <span class="string">&apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11&apos;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_movie</span><span class="params">(query_str)</span>:</span></span><br><span class="line">    headers = {<span class="string">&apos;User-Agent&apos;</span>: random.choice(User_Agents)}</span><br><span class="line">    num = <span class="string">&apos;&apos;</span>.join(random.sample(string.digits + string.ascii_letters, <span class="number">11</span>))</span><br><span class="line">    cookie = {<span class="string">&apos;bid&apos;</span>: num, <span class="string">&apos;ll&apos;</span>: <span class="string">&apos;&quot;108296&quot;&apos;</span>}</span><br><span class="line">    base_url = <span class="string">&quot;https://baike.baidu.com/item/&quot;</span></span><br><span class="line">    query_url = quote(query_str)</span><br><span class="line">    url = base_url + query_url</span><br><span class="line">    <span class="comment"># print (url)</span></span><br><span class="line">    html = urlopen(url).read().decode(<span class="string">&apos;utf-8&apos;</span>)</span><br><span class="line">    soup = BeautifulSoup(html, features=<span class="string">&apos;lxml&apos;</span>)</span><br><span class="line"></span><br><span class="line">    mtitle = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&apos;lemmaWgt-subLemmaListTitle&apos;</span>)</span><br><span class="line">    <span class="keyword">if</span> mtitle:</span><br><span class="line">        lis = soup.find(<span class="string">&apos;li&apos;</span>, class_=<span class="string">&apos;list-dot list-dot-paddingleft&apos;</span>, string=re.compile(<span class="string">&quot;&#x7535;&#x5F71;&quot;</span>))</span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> lis:</span><br><span class="line">            <span class="keyword">return</span> l.string</span><br><span class="line"></span><br><span class="line">    binfo = soup.find(<span class="string">&apos;div&apos;</span>, class_=<span class="string">&apos;basic-info cmn-clearfix&apos;</span>)</span><br><span class="line">    <span class="keyword">if</span> binfo <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">if</span> binfo.find(<span class="string">&apos;sup&apos;</span>):</span><br><span class="line">            binfo.sup.extract()</span><br><span class="line">        linfo = [x.replace(<span class="string">&apos;\xa0&apos;</span>,<span class="string">&quot;&quot;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> list(binfo.stripped_strings)]</span><br><span class="line">        i = iter(linfo)</span><br><span class="line">        d = dict(zip(i,i))</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dict2json</span><span class="params">(filename, d)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&apos;a&apos;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(d, f, indent=<span class="number">2</span>, ensure_ascii=<span class="keyword">False</span>)</span><br><span class="line">        f.write(<span class="string">&apos;,\n&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2txt</span><span class="params">(filename, s)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&apos;a&apos;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(s + <span class="string">&apos;\n&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&apos;mov.txt&apos;</span>,encoding=<span class="string">&apos;utf-8&apos;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        film = line.strip(<span class="string">&apos;\n&apos;</span>)</span><br><span class="line">        wiki = get_movie(film)</span><br><span class="line">        <span class="keyword">if</span> wiki <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">if</span> isinstance(wiki, dict):</span><br><span class="line">                dict2json(<span class="string">&apos;res_mov.json&apos;</span>, wiki)</span><br><span class="line">            <span class="keyword">if</span> isinstance(wiki, str):</span><br><span class="line">                str2txt(<span class="string">&apos;res_mul.txt&apos;</span>, wiki)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            str2txt(<span class="string">&apos;res_non.txt&apos;</span>, film)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb246a9d" class="outline-3"><h3 id="orgb246a9d"><span class="section-number-3">9.3</span> 0xEF0xBB0xBF<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup></h3></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/" target="_blank" rel="noopener">https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/</a></p></div></div><div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/ariya/phantomjs" target="_blank" rel="noopener">https://github.com/ariya/phantomjs</a></p></div></div><div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/wycm/crawler-set.git" target="_blank" rel="noopener">https://github.com/wycm/crawler-set.git</a></p></div></div><div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/moye13/p/5291156.html" target="_blank" rel="noopener">https://www.cnblogs.com/moye13/p/5291156.html</a></p></div></div><div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/yizhenfeng168/p/6938149.html" target="_blank" rel="noopener">https://www.cnblogs.com/yizhenfeng168/p/6938149.html</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orga9021f3&quot;&gt;1. Basic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org7ca0b49&quot;&gt;2. beautifulsoup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8cbea51&quot;&gt;3. Crawler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org3702a1e&quot;&gt;4. PhantomJS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org6be2eff&quot;&gt;5. selenium&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgd34ccbc&quot;&gt;6. scrapy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf6251cd&quot;&gt;7. query movie info from dianying.fm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org49669a0&quot;&gt;8. query movie info from movie.douban.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org23e6b30&quot;&gt;9. query movie info from baidu baike&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="python" scheme="https://angry-bird.github.io/categories/python/"/>
    
    
      <category term="python" scheme="https://angry-bird.github.io/tags/python/"/>
    
      <category term="crawler" scheme="https://angry-bird.github.io/tags/crawler/"/>
    
      <category term="js" scheme="https://angry-bird.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>karabiner</title>
    <link href="https://angry-bird.github.io/2018/11/24/karabiner/"/>
    <id>https://angry-bird.github.io/2018/11/24/karabiner/</id>
    <published>2018-11-24T00:00:00.000Z</published>
    <updated>2018-11-26T23:07:48.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org428eb6f">1. Seil and karabiner</a></li><li><a href="#org05c6532">2. Private.xml</a></li></ul></div></div><a id="more"></a><p>Karabiner is a great tool to modify our keyboard, which can define different key remap in various applications.</p><div id="outline-container-org428eb6f" class="outline-2"><h2 id="org428eb6f"><span class="section-number-2">1</span> Seil and karabiner</h2><div class="outline-text-2" id="text-1"><p>We have to download seil to modify <code>Caps lock</code> in yosemite.</p></div></div><div id="outline-container-org05c6532" class="outline-2"><h2 id="org05c6532"><span class="section-number-2">2</span> Private.xml</h2><div class="outline-text-2" id="text-2"><p>Define all keymaps in <a href="file:///Users/eula/Library/Application%20Support/Karabiner/private.xml" target="_blank" rel="noopener">private.xml</a> as we wish.The <a href="https://link.jianshu.com/?t=https://pqrs.org/osx/karabiner/xml.html.en" target="_blank" rel="noopener">official tutorial</a> and <a href="https://pqrs.org/osx/karabiner/xml.html" target="_blank" rel="noopener">sample xml</a> are greate help to write our <code>private.xml</code>.</p><p>We modify our keyboard just as <a href="https://pqrs.org/osx/karabiner/xml.html" target="_blank" rel="noopener">this</a> said.</p><div class="org-src-container"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Command_R to Control_L (only in emacs, terminal)<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">identifier</span>&gt;</span>private.right_command_to_left_control<span class="tag">&lt;/<span class="name">identifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">only</span>&gt;</span>EMACS, TERMINAL<span class="tag">&lt;/<span class="name">only</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::COMMAND_R, KeyCode::CONTROL_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Swap Command_L and Option_L (only in emacs)<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">identifier</span>&gt;</span>private.swap_left_command_and_left_option<span class="tag">&lt;/<span class="name">identifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">only</span>&gt;</span>EMACS<span class="tag">&lt;/<span class="name">only</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::COMMAND_L, KeyCode::OPTION_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::OPTION_L, KeyCode::COMMAND_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appendix</span>&gt;</span>Keep Command_L+Tab<span class="tag">&lt;/<span class="name">appendix</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::TAB,ModifierFlag::OPTION_L, KeyCode::TAB,ModifierFlag::COMMAND_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::TAB,ModifierFlag::COMMAND_L, KeyCode::TAB,ModifierFlag::OPTION_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Application Key to Option_L+Space<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">identifier</span>&gt;</span>private.app_key_to_left_option_and_space<span class="tag">&lt;/<span class="name">identifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::PC_APPLICATION, KeyCode::SPACE,ModifierFlag::OPTION_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Swap backtick ` and tilde ~<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">identifier</span>&gt;</span>private.swap_backtick_and_tilde<span class="tag">&lt;/<span class="name">identifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::BACKQUOTE,ModifierFlag::SHIFT_L, KeyCode::BACKQUOTE<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::BACKQUOTE,ModifierFlag::SHIFT_R, KeyCode::BACKQUOTE<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">autogen</span>&gt;</span>__KeyToKey__ KeyCode::BACKQUOTE, KeyCode::BACKQUOTE,ModifierFlag::SHIFT_L<span class="tag">&lt;/<span class="name">autogen</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org428eb6f&quot;&gt;1. Seil and karabiner&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org05c6532&quot;&gt;2. Private.xml&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="macos" scheme="https://angry-bird.github.io/categories/macos/"/>
    
    
      <category term="macos" scheme="https://angry-bird.github.io/tags/macos/"/>
    
      <category term="keymodifier" scheme="https://angry-bird.github.io/tags/keymodifier/"/>
    
      <category term="karabiner" scheme="https://angry-bird.github.io/tags/karabiner/"/>
    
  </entry>
  
  <entry>
    <title>kindle ear</title>
    <link href="https://angry-bird.github.io/2018/11/21/kindle%20ear/"/>
    <id>https://angry-bird.github.io/2018/11/21/kindle ear/</id>
    <published>2018-11-21T00:00:00.000Z</published>
    <updated>2018-11-22T16:28:24.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org4be294c">1. Installation</a><ul><li><a href="#orge073d02">1.1. prepare</a></li><li><a href="#orgc9d1ace">1.2. Google accounts</a></li><li><a href="#org97acc0b">1.3. GAE SDK</a></li><li><a href="#org8913053">1.4. KindleEar download and configuration</a></li><li><a href="#orgda13f78">1.5. Deploying KindleEar to GAE</a></li><li><a href="#org8a5776a">1.6. Install the kindleear on Google Cloud shell.</a></li></ul></li><li><a href="#org16b5218">2. Configuration</a></li><li><a href="#org1131bca">3. Post configuration</a></li><li><a href="#org5263400">4. Issues</a><ul><li><a href="#org17a016e">4.1. gcloud deploy error</a></li><li><a href="#orgceadbd7">4.2. <span class="done DONE">DONE</span> internal server error</a></li></ul></li></ul></div></div><a id="more"></a><p>KindleEar is a github repo for generating and pushing subscription stuff to your kindle.</p><div id="outline-container-org4be294c" class="outline-2"><h2 id="org4be294c"><span class="section-number-2">1</span> Installation</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-orge073d02" class="outline-3"><h3 id="orge073d02"><span class="section-number-3">1.1</span> prepare</h3><div class="outline-text-3" id="text-1-1"></div><div id="outline-container-org2c7ff9f" class="outline-4"><h4 id="org2c7ff9f">python2.7.x</h4></div></div><div id="outline-container-orgc9d1ace" class="outline-3"><h3 id="orgc9d1ace"><span class="section-number-3">1.2</span> Google accounts</h3><div class="outline-text-3" id="text-1-2"><ul class="org-ul"><li>Register <a href="https://accounts.google.com/SignUp" target="_blank" rel="noopener">here</a>.</li><li>Enable less secure application <a href="https://www.google.com/settings/security/lesssecureapps" target="_blank" rel="noopener">here</a>.</li><li>Apply a google project <a href="https://console.developers.google.com/project" target="_blank" rel="noopener">here</a>.</li></ul><pre class="example">https://console.developers.google.com/iam-admin/settings?project=YOUR_PROJECT_ID</pre></div></div><div id="outline-container-org97acc0b" class="outline-3"><h3 id="org97acc0b"><span class="section-number-3">1.3</span> GAE SDK<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></h3><div class="outline-text-3" id="text-1-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -q https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-225.0.0-darwin-x86_64.tar.gz</span><br><span class="line">tar -xzf google-cloud-sdk*</span><br><span class="line"><span class="built_in">cd</span> google-cloud-sdk*</span><br><span class="line">./install.sh</span><br><span class="line">./bin/gcloud init</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&#x279C;  google-cloud-sdk ./install.sh</span><br><span class="line">Welcome to the Google Cloud SDK!</span><br><span class="line"></span><br><span class="line">To <span class="built_in">help</span> improve the quality of this product, we collect anonymized usage data</span><br><span class="line">and anonymized stacktraces when crashes are encountered; additional information</span><br><span class="line">is available at &lt;https://cloud.google.com/sdk/usage-statistics&gt;. You may choose</span><br><span class="line">to opt out of this collection now (by choosing <span class="string">&apos;N&apos;</span> at the below prompt), or at</span><br><span class="line">any time <span class="keyword">in</span> the future by running the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    gcloud config <span class="built_in">set</span> disable_usage_reporting <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Do you want to <span class="built_in">help</span> improve the Google Cloud SDK (Y/n)?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Your current Cloud SDK version is: 225.0.0</span><br><span class="line">The latest available version is: 225.0.0</span><br><span class="line"></span><br><span class="line">&#x250C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2510;</span><br><span class="line">&#x2502;                                                  Components                                                 &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x252C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502;     Status    &#x2502;                         Name                         &#x2502;            ID            &#x2502;    Size   &#x2502;</span><br><span class="line">&#x251C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x253C;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;</span><br><span class="line">&#x2502; Not Installed &#x2502; App Engine Go Extensions                             &#x2502; app-engine-go            &#x2502;  56.4 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud Bigtable Command Line Tool                     &#x2502; cbt                      &#x2502;   6.3 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud Bigtable Emulator                              &#x2502; bigtable                 &#x2502;   4.3 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud Datalab Command Line Tool                      &#x2502; datalab                  &#x2502;   &lt; 1 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud Datastore Emulator                             &#x2502; cloud-datastore-emulator &#x2502;  17.7 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud Datastore Emulator (Legacy)                    &#x2502; gcd-emulator             &#x2502;  38.1 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud Pub/Sub Emulator                               &#x2502; pubsub-emulator          &#x2502;  33.4 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Cloud SQL Proxy                                      &#x2502; cloud_sql_proxy          &#x2502;   3.7 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Emulator Reverse Proxy                               &#x2502; emulator-reverse-proxy   &#x2502;  14.5 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Google Cloud Build Local Builder                     &#x2502; cloud-build-local        &#x2502;   5.9 MiB &#x2502;</span><br><span class="line">&#x2502; Not Installed &#x2502; Google Container Registry<span class="string">&apos;s Docker credential helper &#x2502; docker-credential-gcr    &#x2502;   1.8 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; gcloud Alpha Commands                                &#x2502; alpha                    &#x2502;   &lt; 1 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; gcloud Beta Commands                                 &#x2502; beta                     &#x2502;   &lt; 1 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; gcloud app Java Extensions                           &#x2502; app-engine-java          &#x2502; 108.8 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; gcloud app PHP Extensions                            &#x2502; app-engine-php           &#x2502;  21.9 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; gcloud app Python Extensions                         &#x2502; app-engine-python        &#x2502;   6.2 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; gcloud app Python Extensions (Extra Libraries)       &#x2502; app-engine-python-extras &#x2502;  28.5 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Not Installed &#x2502; kubectl                                              &#x2502; kubectl                  &#x2502;   &lt; 1 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Installed     &#x2502; BigQuery Command Line Tool                           &#x2502; bq                       &#x2502;   &lt; 1 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Installed     &#x2502; Cloud SDK Core Libraries                             &#x2502; core                     &#x2502;   8.9 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2502; Installed     &#x2502; Cloud Storage Command Line Tool                      &#x2502; gsutil                   &#x2502;   3.5 MiB &#x2502;</span></span><br><span class="line"><span class="string">&#x2514;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2534;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2518;</span></span><br><span class="line"><span class="string">To install or remove components at your current SDK version [225.0.0], run:</span></span><br><span class="line"><span class="string">  $ gcloud components install COMPONENT_ID</span></span><br><span class="line"><span class="string">  $ gcloud components remove COMPONENT_ID</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To update your SDK installation to the latest version [225.0.0], run:</span></span><br><span class="line"><span class="string">  $ gcloud components update</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Modify profile to update your $PATH and enable shell command</span></span><br><span class="line"><span class="string">completion?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Do you want to continue (Y/n)?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The Google Cloud SDK installer will now prompt you to update an rc</span></span><br><span class="line"><span class="string">file to bring the Google Cloud CLIs into your environment.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter a path to an rc file to update, or leave blank to use</span></span><br><span class="line"><span class="string">[/Users/eula/.zshrc]:</span></span><br><span class="line"><span class="string">Backing up [/Users/eula/.zshrc] to [/Users/eula/.zshrc.backup].</span></span><br><span class="line"><span class="string">[/Users/eula/.zshrc] has been updated.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">==&gt; Start a new shell for the changes to take effect.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information on how to get started, please visit:</span></span><br><span class="line"><span class="string">  https://cloud.google.com/sdk/docs/quickstarts</span></span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#x279C;  google-cloud-sdk ./bin/gcloud init</span><br><span class="line">Welcome! This <span class="built_in">command</span> will take you through the configuration of gcloud.</span><br><span class="line"></span><br><span class="line">Your current configuration has been <span class="built_in">set</span> to: [default]</span><br><span class="line"></span><br><span class="line">You can skip diagnostics next time by using the following flag:</span><br><span class="line">  gcloud init --skip-diagnostics</span><br><span class="line"></span><br><span class="line">Network diagnostic detects and fixes <span class="built_in">local</span> network connection issues.</span><br><span class="line">Checking network connection...done.</span><br><span class="line">Reachability Check passed.</span><br><span class="line">Network diagnostic passed (1/1 checks passed).</span><br><span class="line"></span><br><span class="line">You must <span class="built_in">log</span> <span class="keyword">in</span> to <span class="built_in">continue</span>. Would you like to <span class="built_in">log</span> <span class="keyword">in</span> (Y/n)?</span><br><span class="line"></span><br><span class="line">Your browser has been opened to visit:</span><br><span class="line"></span><br><span class="line">    https://accounts.google.com/o/oauth2/auth?redirect_uri=http%3A%2F%2Flocalhost%3A8085%2F&amp;prompt=select_account&amp;response_type=code&amp;client_id=32555940559.ap</span><br><span class="line">ps.googleusercontent.com&amp;scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform+https%3A%2F%</span><br><span class="line">2Fwww.googleapis.com%2Fauth%2Fappengine.admin+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcompute+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Faccounts.reauth&amp;acc</span><br><span class="line">ess_type=offline</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You are logged <span class="keyword">in</span> as: [your_gmail_account@gmail.com].</span><br><span class="line"></span><br><span class="line">Pick cloud project to use:</span><br><span class="line"> [1] your_project_id-01</span><br><span class="line"> [2] your_project_id-02</span><br><span class="line"> [3] your_project_id-03</span><br><span class="line"> [4] your_project_id-04</span><br><span class="line"> [5] your_project_id-05</span><br><span class="line"> [6] your_project_id-06</span><br><span class="line"> [7] your_project_id-07</span><br><span class="line"> [8] your_project_id-08</span><br><span class="line"> [9] your_project_id-09</span><br><span class="line"> [10] your_project_id-10</span><br><span class="line"> [11] your_project_id-11</span><br><span class="line"> [12] your_project_id-12</span><br><span class="line"> [13] Create a new project</span><br><span class="line">Please enter numeric choice or text value (must exactly match list</span><br><span class="line">item):  1</span><br><span class="line"></span><br><span class="line">Your current project has been <span class="built_in">set</span> to: [your_project_id-01].</span><br><span class="line"></span><br><span class="line">Not setting default zone/region (this feature makes it easier to use</span><br><span class="line">[gcloud compute] by setting an appropriate default value <span class="keyword">for</span> the</span><br><span class="line">--zone and --region flag).</span><br><span class="line">See https://cloud.google.com/compute/docs/gcloud-compute section on how to <span class="built_in">set</span></span><br><span class="line">default compute region and zone manually. If you would like [gcloud init] to be</span><br><span class="line">able to <span class="keyword">do</span> this <span class="keyword">for</span> you the next time you run it, make sure the</span><br><span class="line">Compute Engine API is enabled <span class="keyword">for</span> your project on the</span><br><span class="line">https://console.developers.google.com/apis page.</span><br><span class="line"></span><br><span class="line">Created a default .boto configuration file at [/Users/eula/.boto]. See this file and</span><br><span class="line">[https://cloud.google.com/storage/docs/gsutil/commands/config] <span class="keyword">for</span> more</span><br><span class="line">information about configuring Google Cloud Storage.</span><br><span class="line">Your Google Cloud SDK is configured and ready to use!</span><br><span class="line"></span><br><span class="line"> Commands that require authentication will use your_gmail_account@gmail.com by default</span><br><span class="line"> Commands will reference project `your_project_id-01` by default</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org8913053" class="outline-3"><h3 id="org8913053"><span class="section-number-3">1.4</span> KindleEar download and configuration</h3><div class="outline-text-3" id="text-1-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget -qO KindleEar.zip https://github.com/cdhigh/KindleEar/archive/master.zip</span><br><span class="line">unzip KindleEar.zip</span><br></pre></td></tr></table></figure></div><p>Modify 3 files under KindleEar with your google application id, gmail, domain name.</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"><colgroup><col class="org-left"><col class="org-left"><col class="org-left"></colgroup><thead><tr><th scope="col" class="org-left">File</th><th scope="col" class="org-left">Item</th><th scope="col" class="org-left">Note</th></tr></thead><tbody><tr><td class="org-left">app.yaml</td><td class="org-left">application</td><td class="org-left">Project ID</td></tr><tr><td class="org-left">module_worker.yaml</td><td class="org-left">application</td><td class="org-left">Project ID</td></tr><tr><td class="org-left">config.py</td><td class="org-left">DOMAIN</td><td class="org-left"><a href="http://project_id.appspot.com" target="_blank" rel="noopener">http://project_id.appspot.com</a></td></tr><tr><td class="org-left">config.py</td><td class="org-left">SRC_EMAIL</td><td class="org-left">gmail</td></tr></tbody></table></div></div><div id="outline-container-orgda13f78" class="outline-3"><h3 id="orgda13f78"><span class="section-number-3">1.5</span> Deploying KindleEar to GAE</h3><div class="outline-text-3" id="text-1-5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Go to your google-cloud-sdk</span></span><br><span class="line"><span class="built_in">cd</span> google-cloud-sdk</span><br><span class="line">./gcloud app deploy --project Project_ID ~/Downloads/KindleEar-master/app.yaml ~/Downloads/KindleEar-master/module-worker.yaml</span><br></pre></td></tr></table></figure></div><pre class="example">WARNING: In file [/Users/xxxx/Downloads/KindleEar-master/module-worker.yaml]: (&apos;module&apos;, &apos;Field module is deprecated; use service instead.&apos;)Initializing App Engine resources...done.Services to deploy:descriptor:      [/Users/xxxx/Downloads/KindleEar-master/app.yaml]source:          [/Users/xxxx/Downloads/KindleEar-master]target project:  [YOUR_project_ID]target service:  [default]target version:  [20181121t131444]target url:      [https://YOUR_project_ID.appspot.com]descriptor:      [/Users/xxxx/Downloads/KindleEar-master/module-worker.yaml]source:          [/Users/xxxx/Downloads/KindleEar-master]target project:  [YOUR_project_ID]target service:  [worker]target version:  [20181121t131444]target url:      [https://worker-dot-YOUR_PROJECT_ID.appspot.com]Do you want to continue (Y/n)?Beginning deployment of service [default]...&#x2554;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2557;&#x2560;&#x2550; Uploading 489 files to Google Cloud Storage              &#x2550;&#x2563;&#x255A;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x255D;File upload done.Updating service [default]...done.Setting traffic split for service [default]...done.Deployed service [default] to [https://YOUR_project_ID.appspot.com]Beginning deployment of service [worker]...&#x2554;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2557;&#x2560;&#x2550; Uploading 0 files to Google Cloud Storage                &#x2550;&#x2563;&#x255A;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x2550;&#x255D;File upload done.</pre></div></div><div id="outline-container-org8a5776a" class="outline-3"><h3 id="org8a5776a"><span class="section-number-3">1.6</span> Install the kindleear on Google Cloud shell.</h3><div class="outline-text-3" id="text-1-6"></div><div id="outline-container-orgdae0fc6" class="outline-4"><h4 id="orgdae0fc6"><a href="https://cloud.google.com/shell/docs/starting-cloud-shell" target="_blank" rel="noopener">Start cloud shell guide</a></h4><div class="outline-text-4" id="text-orgdae0fc6"><p>Select or Create a App <a href="https://console.cloud.google.com/cloud-resource-manager?_ga=2.51093865.-1563900582.1542757087" target="_blank" rel="noopener">here</a> , then Click the <code>Activate Cloud Shell</code> button, and <code>Start shell</code> button.</p><p><a href="https://console.cloud.google.com/home/dashboard" target="_blank" rel="noopener">https://console.cloud.google.com/home/dashboard</a></p></div></div><div id="outline-container-org927ad29" class="outline-4"><h4 id="org927ad29">Run these command in shell if you work on an old project</h4><div class="outline-text-4" id="text-org927ad29"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcloud config <span class="built_in">set</span> project your_project_id</span><br><span class="line">rm -f uploader.sh* &amp;&amp; wget https://raw.githubusercontent.com/kindlefere/KindleEar-Uploader/master/uploader.sh &amp;&amp; chmod +x uploader.sh &amp;&amp; ./uploader.sh</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgbb36569" class="outline-4"><h4 id="orgbb36569">Run these commands in shell if you create a new project</h4><div class="outline-text-4" id="text-orgbb36569"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcloud beta app create</span><br><span class="line">rm -f uploader.sh* &amp;&amp; wget https://raw.githubusercontent.com/kindlefere/KindleEar-Uploader/master/uploader.sh &amp;&amp; chmod +x uploader.sh &amp;&amp; ./uploader.sh</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org37db282" class="outline-4"><h4 id="org37db282">Wait kindleear to finish installation</h4><div class="outline-text-4" id="text-org37db282"><p>Google project id and gmail should be entered during installation.</p><p><a href="https://console.cloud.google.com/appengine/settings?project=YOUR_PROJECT_ID" target="_blank" rel="noopener">https://console.cloud.google.com/appengine/settings?project=YOUR_PROJECT_ID</a>  goto this webpage to set Google Accounts API.</p><p>The vist <a href="https://your_project_id.appspot.com" target="_blank" rel="noopener">https://your_project_id.appspot.com</a> and setting with default admin(password admin).</p></div></div><div id="outline-container-org2787d58" class="outline-4"><h4 id="org2787d58">Add your gmail to <code>Email sender</code></h4><div class="outline-text-4" id="text-org2787d58"><p>If you don&apos;t add this, you will get error <code>wrong SRC_EMAIL</code> when diliver the subscription.</p><ul class="org-ul"><li>On left dashboard&apos;s App Engine &#x2013; settings &#x2013; <a href="https://console.cloud.google.com/appengine/settings?project=xxnet-goagent-02&amp;folder&amp;organizationId%20https://console.cloud.google.com/appengine/settings/emailsenders" target="_blank" rel="noopener">email sender</a>.</li><li>If your gmail is not in this list, click <b>ADD</b> on the right of <b>Settings</b>, then enter your gmail with a <b>TAB</b> to finish your input.</li><li>Finally click <b>ADD</b>. Done!</li></ul></div></div></div></div><div id="outline-container-org16b5218" class="outline-2"><h2 id="org16b5218"><span class="section-number-2">2</span> Configuration</h2><div class="outline-text-2" id="text-2"><p>Now, read the FAQ to get it works as you wish.</p></div></div><div id="outline-container-org1131bca" class="outline-2"><h2 id="org1131bca"><span class="section-number-2">3</span> Post configuration</h2><div class="outline-text-2" id="text-3"><ol class="org-ol"><li>Goto <a href="https://www.amazon.com/hz/mycd/myx#/home/settings/payment" target="_blank" rel="noopener">amazon - your content and device - preferences - Personal Document Settings</a></li><li>Add the gmail to approved email list</li><li>Disable less secure application <a href="https://www.google.com/settings/security/lesssecureapps" target="_blank" rel="noopener">here</a>.</li></ol></div></div><div id="outline-container-org5263400" class="outline-2"><h2 id="org5263400"><span class="section-number-2">4</span> Issues</h2><div class="outline-text-2" id="text-4"></div><div id="outline-container-org17a016e" class="outline-3"><h3 id="org17a016e"><span class="section-number-3">4.1</span> gcloud deploy error</h3><div class="outline-text-3" id="text-4-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x279C;  bin ./gcloud app deploy --version=1 /Users/xxx/Downloads/KindleEar-master/app.yaml /Users/xxx/Downloads/KindleEar-master/module-worker.yaml</span><br><span class="line">ERROR: (gcloud.app.deploy) The [application] field is specified <span class="keyword">in</span> file [/Users/xxx/Downloads/KindleEar-master/app.yaml]. This field is not used by gcloud a</span><br><span class="line">nd must be removed. Project name should instead be specified either by `gcloud config <span class="built_in">set</span> project MY_PROJECT` or by setting the `--project` flag on individua</span><br><span class="line">l <span class="built_in">command</span> executions.</span><br></pre></td></tr></table></figure></div><p>Change the google cloud app deploy tool according to current version and notes.</p></div></div><div id="outline-container-orgceadbd7" class="outline-3"><h3 id="orgceadbd7"><span class="section-number-3">4.2</span> <span class="done DONE">DONE</span> internal server error</h3><div class="outline-text-3" id="text-4-2"><p><a href="https://console.cloud.google.com/" target="_blank" rel="noopener">Click</a> to GAE dashboard, Datastore &#x2013; indexes, check Book, DeliverLog, Feed status. Maybe should update indexes.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appcfg.py update_indexes ./</span><br></pre></td></tr></table></figure></div><p>When encountered this error, I decided to reinstall the kindleear in google cloud shell.</p></div></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://cloud.google.com/sdk/docs/" target="_blank" rel="noopener">https://cloud.google.com/sdk/docs/</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org4be294c&quot;&gt;1. Installation&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orge073d02&quot;&gt;1.1. prepare&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc9d1ace&quot;&gt;1.2. Google accounts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org97acc0b&quot;&gt;1.3. GAE SDK&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8913053&quot;&gt;1.4. KindleEar download and configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgda13f78&quot;&gt;1.5. Deploying KindleEar to GAE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8a5776a&quot;&gt;1.6. Install the kindleear on Google Cloud shell.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org16b5218&quot;&gt;2. Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org1131bca&quot;&gt;3. Post configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org5263400&quot;&gt;4. Issues&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org17a016e&quot;&gt;4.1. gcloud deploy error&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgceadbd7&quot;&gt;4.2. &lt;span class=&quot;done DONE&quot;&gt;DONE&lt;/span&gt; internal server error&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="kindle" scheme="https://angry-bird.github.io/categories/kindle/"/>
    
    
      <category term="github" scheme="https://angry-bird.github.io/tags/github/"/>
    
      <category term="kindle" scheme="https://angry-bird.github.io/tags/kindle/"/>
    
      <category term="GAE" scheme="https://angry-bird.github.io/tags/GAE/"/>
    
  </entry>
  
  <entry>
    <title>VPS roles</title>
    <link href="https://angry-bird.github.io/2018/11/20/VPS%20roles/"/>
    <id>https://angry-bird.github.io/2018/11/20/VPS roles/</id>
    <published>2018-11-20T00:00:00.000Z</published>
    <updated>2018-12-02T07:57:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orgbde96a6">1. Basic</a></li><li><a href="#org3eec1c5">2. SSR server</a><ul><li><a href="#org2f31e18">2.1. speed benchmark</a></li><li><a href="#org10e6afe">2.2. bbr</a></li><li><a href="#org1dceada">2.3. ssr</a></li><li><a href="#orgd2f14b6">2.4. Other options</a></li></ul></li><li><a href="#orgfddd994">3. Web server</a><ul><li><a href="#orgb066c28">3.1. http</a></li><li><a href="#org3895c22">3.2. domain name</a></li></ul></li><li><a href="#org246030b">4. Mail server</a><ul><li><a href="#org0d35dd7">4.1. maildev</a></li></ul></li><li><a href="#org2125fe4">5. Issues</a><ul><li><a href="#orgcc37eca">5.1. iptables</a></li><li><a href="#orgbb8f492">5.2. startup</a></li></ul></li></ul></div></div><a id="more"></a><p>What a VPS can do, actually it&apos;s out of my imagenation.</p><p>I got a really cheap and stable KVM vps on hosteons.com, and run shadowsocksR as the main job.</p><div id="outline-container-orgbde96a6" class="outline-2"><h2 id="orgbde96a6"><span class="section-number-2">1</span> Basic</h2><div class="outline-text-2" id="text-1"><p>ssh log in ubuntu 16, the vnc will encouter a template error with GUI.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh root@your_vps_ip</span><br><span class="line"><span class="built_in">export</span> LC_ALL=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line"><span class="comment">### Type yes and password to login vps</span></span><br><span class="line">ssh-keygen</span><br><span class="line">vi ~/.ssh/authorized_keys</span><br><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service sshd restart</span><br><span class="line"><span class="comment">### Add your laptop&apos;s rsa public key to it</span></span><br><span class="line">vi .ssh/config</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host eula.cf</span><br><span class="line">   HostName your_vps_ip</span><br><span class="line">   Port your_ssh_port</span><br><span class="line">   User your_user_name</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh eula.cf</span><br><span class="line"><span class="comment">## Download from vps</span></span><br><span class="line">scp eula.cf file.gz</span><br><span class="line"><span class="comment">## Upload to vps</span></span><br><span class="line">scp blog.tar.gz eula.cf</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org3eec1c5" class="outline-2"><h2 id="org3eec1c5"><span class="section-number-2">2</span> SSR server</h2><div class="outline-text-2" id="text-2"></div><div id="outline-container-org2f31e18" class="outline-3"><h3 id="org2f31e18"><span class="section-number-3">2.1</span> speed benchmark</h3><div class="outline-text-3" id="text-2-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -qO- https://raw.githubusercontent.com/oooldking/script/master/superbench.sh | bash</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org10e6afe" class="outline-3"><h3 id="org10e6afe"><span class="section-number-3">2.2</span> bbr</h3><div class="outline-text-3" id="text-2-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## for ubuntu 18</span></span><br><span class="line">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br><span class="line">chmod +x bbr.sh</span><br><span class="line">./bbr.sh</span><br><span class="line">lsmod |grep <span class="string">&apos;bbr&apos;</span></span><br><span class="line">sysctl net.ipv4.tcp_available_congestion_control</span><br><span class="line"></span><br><span class="line"><span class="comment">## for ubuntu 16</span></span><br><span class="line">wget --no-check-certificate -qO <span class="string">&apos;BBR.sh&apos;</span> <span class="string">&apos;https://moeclub.org/attachment/LinuxShell/BBR.sh&apos;</span> &amp;&amp; chmod a+x BBR.sh &amp;&amp; bash BBR.sh -f</span><br><span class="line">wget --no-check-certificate -qO <span class="string">&apos;BBR_POWERED.sh&apos;</span> <span class="string">&apos;https://moeclub.org/attachment/LinuxShell/BBR_POWERED.sh&apos;</span> &amp;&amp; chmod a+x BBR_POWERED.sh &amp;&amp; bash BBR_POWERED.sh</span><br><span class="line">lsmod |grep <span class="string">&apos;bbr&apos;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org1dceada" class="outline-3"><h3 id="org1dceada"><span class="section-number-3">2.3</span> ssr</h3><div class="outline-text-3" id="text-2-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ssr &amp;&amp; <span class="built_in">cd</span> ssr</span><br><span class="line">wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh</span><br><span class="line">chmod +x shadowsocksR.sh</span><br><span class="line">./shadowsocksR.sh 2&gt;&amp;1 | tee shadowsocksR.log</span><br><span class="line">reboot</span><br><span class="line"><span class="comment"># ./shadowsocksR.sh uninstall</span></span><br><span class="line">/etc/init.d/shadowsocks restart</span><br><span class="line">vi /etc/shadowsocks.json</span><br><span class="line"><span class="comment">## Check configuration</span></span><br><span class="line">{</span><br><span class="line">    <span class="string">&quot;server&quot;</span>:<span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server_ipv6&quot;</span>:<span class="string">&quot;[::]&quot;</span>,</span><br><span class="line">    <span class="string">&quot;port_password&quot;</span>:{</span><br><span class="line">        <span class="string">&quot;8089&quot;</span>:<span class="string">&quot;your_pass&quot;</span>,</span><br><span class="line">        <span class="string">&quot;8090&quot;</span>:<span class="string">&quot;your_passwd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;8091&quot;</span>:<span class="string">&quot;your_password&quot;</span></span><br><span class="line">        },</span><br><span class="line">    <span class="string">&quot;local_address&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;local_port&quot;</span>:1080,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;your_pass&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timeout&quot;</span>:120,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>:<span class="string">&quot;encryption_method&quot;</span>,</span><br><span class="line">    <span class="string">&quot;protocol&quot;</span>:<span class="string">&quot;choose_proto&quot;</span>,</span><br><span class="line">    <span class="string">&quot;protocol_param&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;obfs&quot;</span>:<span class="string">&quot;plain&quot;</span>,</span><br><span class="line">    <span class="string">&quot;obfs_param&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;redirect&quot;</span>:<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dns_ipv6&quot;</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;fast_open&quot;</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;workers&quot;</span>:1</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgd2f14b6" class="outline-3"><h3 id="orgd2f14b6"><span class="section-number-3">2.4</span> Other options</h3><div class="outline-text-3" id="text-2-4"></div><div id="outline-container-org629fb4a" class="outline-4"><h4 id="org629fb4a">ss</h4><div class="outline-text-4" id="text-org629fb4a"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install shadowsocks</span><br><span class="line">apt install shadowsocks</span><br><span class="line"><span class="comment">## Start service</span></span><br><span class="line">ssserver -c /etc/shadowsocks.json</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org3cdd1c9" class="outline-4"><h4 id="org3cdd1c9">local to vps</h4><div class="outline-text-4" id="text-org3cdd1c9"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apt-get install build-essential libtool libpcre3 libpcre3-dev zlib1g-dev openssl</span><br><span class="line"><span class="comment">### Auto install nginx</span></span><br><span class="line">apt install nginx</span><br><span class="line">ls /var/www/html</span><br><span class="line"><span class="comment">### Manual install newest nginx server</span></span><br><span class="line">wget http://nginx.org/download/nginx-1.15.5.tar.gz</span><br><span class="line">tar -zxvf nginx-1.15.5.tar.gz &amp;&amp; <span class="built_in">cd</span> nginx-1.15.5</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">sudo /usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">ps -ef|grep nginx</span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -V</span><br><span class="line">vi /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s reload</span><br><span class="line"><span class="comment">### Stop nginx</span></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -s stop</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org2e8a641" class="outline-4"><h4 id="org2e8a641">streisand</h4><div class="outline-text-4" id="text-org2e8a641"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apt install python</span><br><span class="line">apt install git</span><br><span class="line"><span class="comment"># apt install python-pip python-pycurl python-dev build-essential python-paramiko</span></span><br><span class="line">apt install python-pip</span><br><span class="line">pip install ansible markupsafe</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/StreisandEffect/streisand.git &amp;&amp; <span class="built_in">cd</span> streisand</span><br><span class="line"><span class="built_in">export</span> LC_ALL=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">./util/venv-dependencies.sh ./venv</span><br><span class="line"><span class="built_in">source</span> ./venv/bin/activate</span><br><span class="line">./streisand</span><br><span class="line"><span class="comment">### Linode and other famous vps should install another package or skip this</span></span><br><span class="line"><span class="comment">### I choose 7. localhost and default setting, and 8. Existing Server also is ok</span></span><br><span class="line"><span class="comment">### Then streisand will deploy successfully on Ubuntu 16 with root as default user</span></span><br><span class="line"><span class="comment">### Then default 5 accounts will be created.</span></span><br><span class="line">tar -czf streisand.tar.gz /root/streisand/generated-docs</span><br><span class="line">scp root@your_vps_ip:/root/streisand.tar.gz streisand.tar.gz</span><br><span class="line"><span class="comment">### Visit https://your_vps_ip with CA and password for user streisand.</span></span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="outline-container-orgfddd994" class="outline-2"><h2 id="orgfddd994"><span class="section-number-2">3</span> Web server</h2><div class="outline-text-2" id="text-3"></div><div id="outline-container-orgb066c28" class="outline-3"><h3 id="orgb066c28"><span class="section-number-3">3.1</span> http</h3><div class="outline-text-3" id="text-3-1"></div><div id="outline-container-org65a4a5e" class="outline-4"><h4 id="org65a4a5e">nginx</h4><div class="outline-text-4" id="text-org65a4a5e"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install nginx</span><br><span class="line">ls /var/www/html</span><br><span class="line">nginx -v</span><br><span class="line">mv ~/test.pkg /var/www/html/</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf64415c" class="outline-4"><h4 id="orgf64415c">frp</h4><div class="outline-text-4" id="text-orgf64415c"></div><ul class="org-ul"><li><a id="orgc71c07a"></a>installation<br><div class="outline-text-5" id="text-orgc71c07a"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PKG_VER=0.21.0</span><br><span class="line">PKG_ARCH=linux_amd64</span><br><span class="line">PKG_NAME=frp_$(PKG_VER)_$(PKG_ARCH)</span><br><span class="line">wget https://github.com/fatedier/frp/releases/download/v$(PKG_VER)/$(PKG_NAME).tar.gz</span><br><span class="line">tar -xzf $(PKG_NAME).tar.gz</span><br><span class="line"><span class="built_in">cd</span> $(PKG_NAME)</span><br><span class="line">PKG_PATH=$(PWD)/frps</span><br><span class="line">./frps -c ./frps.ini --reload</span><br><span class="line">sudo cat $(PKG_PATH) -c $(PKG_PATH).ini &amp; &gt;&gt; /etc/rc.local</span><br></pre></td></tr></table></figure></div></div></li><li><a id="orgb26364f"></a>frps startup<br><div class="outline-text-5" id="text-orgb26364f"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /lib/systemd/system/frps.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=frps service</span><br><span class="line">After=network.target syslog.target</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/root/frp/frps -c /root/frp/frps.ini</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">scp 0x99-frps.service eula.fc:/lib/systemd/system/frps.service</span><br><span class="line">sudo systemctl start frps</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> frps</span><br></pre></td></tr></table></figure></div></div></li><li><a id="orgea3d25f"></a>frps screen<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup><br><div class="outline-text-5" id="text-orgea3d25f"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">screen -S frp /root/frp/frps -c /root/frp/frps.ini</span><br><span class="line">ln -s /root/frp/frps /usr/bin/frps</span><br><span class="line">screen -S frp frps -c /root/frp/frps.ini</span><br></pre></td></tr></table></figure></div><p>The config file</p><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">token</span> = your_passwd</span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">kcp_bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">443</span></span><br><span class="line"><span class="attr">subdomain_host</span> = your_domain</span><br><span class="line"></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">8000</span></span><br><span class="line"><span class="attr">dashboard_user</span> = username</span><br><span class="line"><span class="attr">dashboard_pwd</span> = passwd</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">listen_port</span> = <span class="number">9000</span></span><br><span class="line"><span class="attr">auth_token</span> = passwd1</span><br><span class="line"></span><br><span class="line"><span class="section">[ssh_1]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">listen_port</span> = <span class="number">9001</span></span><br><span class="line"><span class="attr">auth_token</span> = passwd2</span><br></pre></td></tr></table></figure></div></div></li><li><a id="orgf5342fb"></a>https<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup><sup>, </sup><sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup><br><div class="outline-text-5" id="text-orgf5342fb"><p>ssl &#x2013; let&apos;s encrypt</p></div></li><li><a id="orgbb93e79"></a>frp on openwrt<br><div class="outline-text-5" id="text-orgbb93e79"><p>Add to /etc/init.d/frpc</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh /etc/rc.common</span></span><br><span class="line"></span><br><span class="line">START=99</span><br><span class="line">USE_PROCD=1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start_service</span></span>() {</span><br><span class="line">    procd_open_instance <span class="string">&quot;frpc&quot;</span></span><br><span class="line">    procd_set_param <span class="built_in">command</span> /tmp/frpc -c /root/frp/frpc.ini</span><br><span class="line">    procd_set_param stdout 1</span><br><span class="line">    procd_set_param stderr 1</span><br><span class="line">    procd_set_param user root</span><br><span class="line">    procd_close_instance</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div></div><ul class="org-ul"><li><a id="org53a6f09"></a>original<br><div class="outline-text-6" id="text-org53a6f09"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tmp/frpc -c /root/frp/frpc.ini</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = your_vps_ip</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = your_passwd</span><br><span class="line"><span class="attr">login_fail_exit</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">admin_port</span> = <span class="number">7400</span></span><br><span class="line"></span><br><span class="line"><span class="section">[lede]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">subdomain</span> = lede</span><br><span class="line"></span><br><span class="line"><span class="section">[aria2]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">192.168</span>.<span class="number">1.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">6800</span></span><br><span class="line"><span class="attr">subdomain</span> = aria2</span><br></pre></td></tr></table></figure></div></div></li><li><a id="orga767d7a"></a>xfrp<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup><br><div class="outline-text-6" id="text-orga767d7a"><p>For Netgear 4300<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup>, and xfrpc only work with xfrps.</p><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -name &quot;*libevent*&quot;</span><br><span class="line">ln -s /usr/lib/libevent-2.0.so.5 /usr/lib/libevent-2.1.so.6</span><br></pre></td></tr></table></figure></div></div></li></ul></li></ul></div><div id="outline-container-org2d46c7d" class="outline-4"><h4 id="org2d46c7d">npm</h4><div class="outline-text-4" id="text-org2d46c7d"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://deb.nodesource.com/setup_10.x | sudo bash -</span><br><span class="line">sudo apt install nodejs</span><br><span class="line">npm -v</span><br><span class="line">sudo node http_server.js</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orga1e3f63" class="outline-4"><h4 id="orga1e3f63">docker<sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup></h4><div class="outline-text-4" id="text-orga1e3f63"></div><ul class="org-ul"><li><a id="orgbb2e134"></a><a href="https://docs.docker.com/engine/reference/commandline" target="_blank" rel="noopener">docker usage</a><br><div class="outline-text-5" id="text-orgbb2e134"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable&quot;</span></span><br><span class="line">sudo apt update</span><br><span class="line">apt-cache policy docker-ce</span><br><span class="line">sudo apt install docker-ce</span><br><span class="line">sudo systemctl status docker</span><br><span class="line">sudo apt install net-tools</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run image_name</span><br><span class="line">docker ps</span><br><span class="line">docker ps -a</span><br><span class="line">docker <span class="built_in">kill</span> `docker ps -q`</span><br><span class="line">docker stop ID</span><br><span class="line">docker start ID</span><br><span class="line">docker rm `docker ps -q -a`</span><br></pre></td></tr></table></figure></div></div></li></ul></div></div><div id="outline-container-org3895c22" class="outline-3"><h3 id="org3895c22"><span class="section-number-3">3.2</span> domain name</h3><div class="outline-text-3" id="text-3-2"><p>Register a free domain name on <a href="https://my.freenom.com/" target="_blank" rel="noopener">freenom</a> and a china dnspod as nameserver according to <a href="https://www.jianshu.com/p/e02371079daa" target="_blank" rel="noopener">this</a>.</p></div><div id="outline-container-org10b4ddd" class="outline-4"><h4 id="org10b4ddd">freenom</h4><div class="outline-text-4" id="text-org10b4ddd"><p>You can register a free name for a long time.</p></div></div><div id="outline-container-orgad6414b" class="outline-4"><h4 id="orgad6414b">dnspod<sup><a id="fnr.7" class="footref" href="#fn.7">7</a></sup></h4></div></div></div><div id="outline-container-org246030b" class="outline-2"><h2 id="org246030b"><span class="section-number-2">4</span> Mail server</h2><div class="outline-text-2" id="text-4"><p>Most vps has blocked port 25 in and out traffic, so check with <code>telnet IP port</code>. Out traffic of 25 can be transferred to other ports<sup><a id="fnr.8" class="footref" href="#fn.8">8</a></sup>.</p></div><div id="outline-container-org0d35dd7" class="outline-3"><h3 id="org0d35dd7"><span class="section-number-3">4.1</span> maildev<sup><a id="fnr.9" class="footref" href="#fn.9">9</a></sup></h3><div class="outline-text-3" id="text-4-1"><p>docker or npm smtp test server, catch and send mail, webclient with password.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install -g maildev</span><br><span class="line">screen -S mail maildev -s 25 -w 8080</span><br><span class="line">screen -S mail maildev -s 25 -w 8080 --web-user adnil --web-pass 6LZ0dmYrxpSnhY</span><br><span class="line"><span class="comment">### Or run with docker</span></span><br><span class="line">docker run --name maildev -d -p 8080:80 -p 25:25 djfarrelly/maildev</span><br></pre></td></tr></table></figure></div><p><a href="https://danfarrelly.nyc/MailDev/" target="_blank" rel="noopener">https://danfarrelly.nyc/MailDev/</a></p><p><a href="https://mxtoolbox.com/diagnostic.aspx" target="_blank" rel="noopener">Check with this site</a></p></div><div id="outline-container-orgf11924a" class="outline-4"><h4 id="orgf11924a">forsaken<sup><a id="fnr.10" class="footref" href="#fn.10">10</a></sup></h4><div class="outline-text-4" id="text-orgf11924a"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  docker run --name fmail -d -p 25:25 -p 3000:3000 denghongcai/forsaken-mail</span><br><span class="line"><span class="comment"># Or like this</span></span><br><span class="line">  docker run --name fomail -d -p 1025:25 -p 3000:3000 denghongcai/forsaken-mail</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org17e827d" class="outline-4"><h4 id="org17e827d">iRedMail<sup><a id="fnr.11" class="footref" href="#fn.11">11</a></sup></h4><div class="outline-text-4" id="text-org17e827d"><p>Open source serious server,</p></div></div><div id="outline-container-orga780e83" class="outline-4"><h4 id="orga780e83">Modoboa<sup><a id="fnr.12" class="footref" href="#fn.12">12</a></sup></h4><div class="outline-text-4" id="text-orga780e83"><p>Multi-function</p></div></div><div id="outline-container-org2761254" class="outline-4"><h4 id="org2761254">mailinabox<sup><a id="fnr.13" class="footref" href="#fn.13">13</a></sup></h4><div class="outline-text-4" id="text-org2761254"><p>Multi-function</p></div></div><div id="outline-container-org8c4f7f2" class="outline-4"><h4 id="org8c4f7f2">Mailu<sup><a id="fnr.14" class="footref" href="#fn.14">14</a></sup></h4><div class="outline-text-4" id="text-org8c4f7f2"><p>Serious server, need more than 2G total memory and 1G free memory.</p></div></div><div id="outline-container-org0fd4b39" class="outline-4"><h4 id="org0fd4b39">mailslurper<sup><a id="fnr.15" class="footref" href="#fn.15">15</a></sup></h4><div class="outline-text-4" id="text-org0fd4b39"><p>Go compiled</p></div></div></div></div><div id="outline-container-org2125fe4" class="outline-2"><h2 id="org2125fe4"><span class="section-number-2">5</span> Issues</h2><div class="outline-text-2" id="text-5"></div><div id="outline-container-orgcc37eca" class="outline-3"><h3 id="orgcc37eca"><span class="section-number-3">5.1</span> iptables</h3><div class="outline-text-3" id="text-5-1"></div><div id="outline-container-orgf7738b7" class="outline-4"><h4 id="orgf7738b7">clear all</h4><div class="outline-text-4" id="text-orgf7738b7"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t mangle -F</span><br><span class="line">iptables -t raw -F</span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -nvL</span><br><span class="line"><span class="comment">### Maybe ip6tables needs clear</span></span><br><span class="line">ip6tables -P INPUT ACCEPT</span><br><span class="line">ip6tables -P FORWARD ACCEPT</span><br><span class="line">ip6tables -P OUTPUT ACCEPT</span><br><span class="line">ip6tables -t nat -F</span><br><span class="line">ip6tables -t mangle -F</span><br><span class="line">ip6tables -F</span><br><span class="line">ip6tables -X</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables-save | awk <span class="string">&apos;/^[*]/ { print $1 }</span></span><br><span class="line"><span class="string">                     /^:[A-Z]+ [^-]/ { print $1 &quot; ACCEPT&quot; ; }</span></span><br><span class="line"><span class="string">                     /COMMIT/ { print $0; }&apos;</span> | iptables-restore</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org53f0ae5" class="outline-4"><h4 id="org53f0ae5"><span class="timestamp-wrapper"><span class="timestamp">[2018-11-15 Thu]</span></span></h4><div class="outline-text-4" id="text-org53f0ae5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">root@eula:~<span class="comment"># iptables -L -n -v</span></span><br><span class="line">Chain INPUT (policy ACCEPT 138 packets, 11707 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">  131  943K DOCKER-USER  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">  131  943K DOCKER-ISOLATION-STAGE-1  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">   95  941K ACCEPT     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</span><br><span class="line">    0     0 DOCKER     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">   36  2116 ACCEPT     all  --  docker0 !docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 ACCEPT     all  --  docker0 docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 7 packets, 700 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain DOCKER (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 ACCEPT     tcp  --  !docker0 docker0  0.0.0.0/0            172.17.0.2           tcp dpt:3000</span><br><span class="line">    0     0 ACCEPT     tcp  --  !docker0 docker0  0.0.0.0/0            172.17.0.2           tcp dpt:25</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">   36  2116 DOCKER-ISOLATION-STAGE-2  all  --  docker0 !docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">  131  943K RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 DROP       all  --  *      docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">   36  2116 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">  131  943K RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">root@eula:~<span class="comment"># netstat -anpt</span></span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      255/systemd-resolve</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      440/sshd</span><br><span class="line">tcp        0      0 your_vps_ip:55313      172.217.14.78:443       ESTABLISHED 499/python</span><br><span class="line">tcp        0    376 your_vps_ip:22         14.16.103.178:61552     ESTABLISHED 707/sshd: root@pts/</span><br><span class="line">tcp        0      0 your_vps_ip:45507      74.125.197.188:443      ESTABLISHED 499/python</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      440/sshd</span><br><span class="line">tcp6       0      0 :::3000                 :::*                    LISTEN      806/docker-proxy</span><br><span class="line">tcp6       0      0 :::25                   :::*                    LISTEN      818/docker-proxy</span><br><span class="line">tcp6       0      0 :::8089                 :::*                    LISTEN      499/python</span><br><span class="line">tcp6       0      0 your_vps_ip:8089       14.16.103.178:61655     ESTABLISHED 499/python</span><br><span class="line">tcp6       0      0 your_vps_ip:8089       14.16.103.178:61596     ESTABLISHED 499/python</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">root@eula:~<span class="comment"># iptables -L -n -v</span></span><br><span class="line">Chain INPUT (policy ACCEPT 2444 packets, 579K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP 165 packets, 9880 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 1050 packets, 495K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain DOCKER (0 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 ACCEPT     tcp  --  !docker0 docker0  0.0.0.0/0            172.17.0.2           tcp dpt:3000</span><br><span class="line">    0     0 ACCEPT     tcp  --  !docker0 docker0  0.0.0.0/0            172.17.0.2           tcp dpt:25</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (0 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (0 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (0 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">root@eula:~<span class="comment"># iptables-</span></span><br><span class="line">iptables-apply    iptables-restore  iptables-save     iptables-xml</span><br><span class="line">root@eula:~<span class="comment"># iptables-</span></span><br><span class="line">iptables-apply    iptables-restore  iptables-save     iptables-xml</span><br><span class="line">root@eula:~<span class="comment"># iptables-</span></span><br><span class="line">iptables-apply    iptables-restore  iptables-save     iptables-xml</span><br><span class="line">root@eula:~<span class="comment"># iptables-save</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.6.1 on Thu Nov 15 06:30:12 2018</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [1712:142062]</span><br><span class="line">:INPUT ACCEPT [115:20353]</span><br><span class="line">:OUTPUT ACCEPT [32:7256]</span><br><span class="line">:POSTROUTING ACCEPT [32:7256]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 3000 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 25 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 3000 -j DNAT --to-destination 172.17.0.2:3000</span><br><span class="line">-A DOCKER ! -i docker0 -p tcp -m tcp --dport 25 -j DNAT --to-destination 172.17.0.2:25</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Thu Nov 15 06:30:12 2018</span></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.6.1 on Thu Nov 15 06:30:12 2018</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [2754:615656]</span><br><span class="line">:FORWARD DROP [175:10504]</span><br><span class="line">:OUTPUT ACCEPT [1141:520115]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 3000 -j ACCEPT</span><br><span class="line">-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 25 -j ACCEPT</span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Thu Nov 15 06:30:12 2018</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@eula:~<span class="comment"># iptables -L -n</span></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">DOCKER-USER  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">DOCKER-ISOLATION-STAGE-1  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</span><br><span class="line">DOCKER     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain DOCKER (1 references)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">ACCEPT     tcp  --  0.0.0.0/0            172.17.0.2           tcp dpt:3000</span><br><span class="line">ACCEPT     tcp  --  0.0.0.0/0            172.17.0.2           tcp dpt:25</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">DOCKER-ISOLATION-STAGE-2  all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (1 references)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">DROP       all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line">target     prot opt <span class="built_in">source</span>               destination</span><br><span class="line">RETURN     all  --  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">root@eula:~<span class="comment"># iptables -L -n -v</span></span><br><span class="line">Chain INPUT (policy ACCEPT 1714 packets, 385K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy DROP 0 packets, 0 bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">  205  955K DOCKER-USER  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">  205  955K DOCKER-ISOLATION-STAGE-1  all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line">  133  949K ACCEPT     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</span><br><span class="line">    4   256 DOCKER     all  --  *      docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">   68  6427 ACCEPT     all  --  docker0 !docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">    0     0 ACCEPT     all  --  docker0 docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 885 packets, 326K bytes)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line"></span><br><span class="line">Chain DOCKER (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    4   256 ACCEPT     tcp  --  !docker0 docker0  0.0.0.0/0            172.17.0.2           tcp dpt:3000</span><br><span class="line">    0     0 ACCEPT     tcp  --  !docker0 docker0  0.0.0.0/0            172.17.0.2           tcp dpt:25</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">   68  6427 DOCKER-ISOLATION-STAGE-2  all  --  docker0 !docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">  205  955K RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain DOCKER-ISOLATION-STAGE-2 (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">    0     0 DROP       all  --  *      docker0  0.0.0.0/0            0.0.0.0/0</span><br><span class="line">   68  6427 RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br><span class="line"></span><br><span class="line">Chain DOCKER-USER (1 references)</span><br><span class="line"> pkts bytes target     prot opt <span class="keyword">in</span>     out     <span class="built_in">source</span>               destination</span><br><span class="line">  205  955K RETURN     all  --  *      *       0.0.0.0/0            0.0.0.0/0</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orgbb8f492" class="outline-3"><h3 id="orgbb8f492"><span class="section-number-3">5.2</span> startup</h3><div class="outline-text-3" id="text-5-2"><p>Ubuntu 18.04 LTS support systemctl and cannot edit <b>rc.local</b> directly to config startup.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/rc-local.service</span><br><span class="line"><span class="comment">### Add this section in rc-local.service</span></span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/rc.local</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rc.local</span></span><br><span class="line">./frps -c frps.ini &amp;</span><br><span class="line">maildev -s 25 -w 8080 &amp;</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /etc/rc.local</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> rc-local</span><br><span class="line">sudo systemctl start rc-local.service</span><br></pre></td></tr></table></figure></div></div></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://blog.csdn.net/yaoxiewan6617/article/details/80063063" target="_blank" rel="noopener">https://blog.csdn.net/yaoxiewan6617/article/details/80063063</a></p></div></div><div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/fatedier/frp/issues/610" target="_blank" rel="noopener">https://github.com/fatedier/frp/issues/610</a></p></div></div><div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/fatedier/frp/issues/671" target="_blank" rel="noopener">https://github.com/fatedier/frp/issues/671</a></p></div></div><div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/KunTengRom/xfrp" target="_blank" rel="noopener">https://github.com/KunTengRom/xfrp</a></p></div></div><div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/KunTengRom/xfrp/releases/download/0.07.458/xfrpc_0.07.458-1_mips_24kc.ipk" target="_blank" rel="noopener">https://github.com/KunTengRom/xfrp/releases/download/0.07.458/xfrpc_0.07.458-1_mips_24kc.ipk</a></p></div></div><div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04" target="_blank" rel="noopener">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04</a></p></div></div><div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7">7</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.dnspod.cn/console/dns" target="_blank" rel="noopener">https://www.dnspod.cn/console/dns</a></p></div></div><div class="footdef"><sup><a id="fn.8" class="footnum" href="#fnr.8">8</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.cnblogs.com/yunweis/p/8149242.html" target="_blank" rel="noopener">https://www.cnblogs.com/yunweis/p/8149242.html</a></p></div></div><div class="footdef"><sup><a id="fn.9" class="footnum" href="#fnr.9">9</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/djfarrelly/MailDev" target="_blank" rel="noopener">https://github.com/djfarrelly/MailDev</a></p></div></div><div class="footdef"><sup><a id="fn.10" class="footnum" href="#fnr.10">10</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/denghongcai/forsaken-mail" target="_blank" rel="noopener">https://github.com/denghongcai/forsaken-mail</a></p></div></div><div class="footdef"><sup><a id="fn.11" class="footnum" href="#fnr.11">11</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.iredmail.org/" target="_blank" rel="noopener">https://www.iredmail.org/</a></p></div></div><div class="footdef"><sup><a id="fn.12" class="footnum" href="#fnr.12">12</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/modoboa/modoboa" target="_blank" rel="noopener">https://github.com/modoboa/modoboa</a></p></div></div><div class="footdef"><sup><a id="fn.13" class="footnum" href="#fnr.13">13</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/mail-in-a-box/mailinabox" target="_blank" rel="noopener">https://github.com/mail-in-a-box/mailinabox</a></p></div></div><div class="footdef"><sup><a id="fn.14" class="footnum" href="#fnr.14">14</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/Mailu/Mailu" target="_blank" rel="noopener">https://github.com/Mailu/Mailu</a></p></div></div><div class="footdef"><sup><a id="fn.15" class="footnum" href="#fnr.15">15</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/mailslurper/mailslurper" target="_blank" rel="noopener">https://github.com/mailslurper/mailslurper</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgbde96a6&quot;&gt;1. Basic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org3eec1c5&quot;&gt;2. SSR server&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org2f31e18&quot;&gt;2.1. speed benchmark&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org10e6afe&quot;&gt;2.2. bbr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org1dceada&quot;&gt;2.3. ssr&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgd2f14b6&quot;&gt;2.4. Other options&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgfddd994&quot;&gt;3. Web server&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgb066c28&quot;&gt;3.1. http&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org3895c22&quot;&gt;3.2. domain name&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org246030b&quot;&gt;4. Mail server&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org0d35dd7&quot;&gt;4.1. maildev&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2125fe4&quot;&gt;5. Issues&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgcc37eca&quot;&gt;5.1. iptables&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgbb8f492&quot;&gt;5.2. startup&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="server" scheme="https://angry-bird.github.io/tags/server/"/>
    
  </entry>
  
  <entry>
    <title>hackintosh on thinkpad T440P</title>
    <link href="https://angry-bird.github.io/2018/11/18/hackintosh%20on%20thinkpad%20T440P/"/>
    <id>https://angry-bird.github.io/2018/11/18/hackintosh on thinkpad T440P/</id>
    <published>2018-11-18T00:00:00.000Z</published>
    <updated>2018-11-18T15:53:02.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org6c1989f">1. lenovo thinkpad t440p with yosemite</a><ul><li><a href="#orgcdc5b1a">1.1. installing USB stick, MBR is recommanded though GPT is another option</a></li><li><a href="#orge1bd641">1.2. installing Clover on USB</a></li><li><a href="#org46f443b">1.3. Setting laptop BIOS</a></li><li><a href="#orga9964c5">1.4. Booting the Installer USB on laptop</a></li><li><a href="#orga00d33e">1.5. Post install kexts into laptop disk</a></li></ul></li></ul></div></div><a id="more"></a><div id="outline-container-org6c1989f" class="outline-2"><h2 id="org6c1989f"><span class="section-number-2">1</span> lenovo thinkpad t440p with yosemite</h2><div class="outline-text-2" id="text-1"><p>T440P can run osx perfectly<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.</p><p>Hardware</p><dl class="org-dl"><dt>UEFI</dt><dd>2.24</dd><dt>intel</dt><dd>i5-4210M(4300M?)</dd><dt>Memory</dt><dd>8G</dd><dt>Graphic</dt><dd>256M/512MB intel HD4600, nvidia GT730M</dd><dt>audio</dt><dd>intel Haswell</dd></dl><p>After installation, laptop harddisk should be GPT partition map scheme with one ESP partition.</p><p>All installation are done with specific guide<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup> and general guide<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup> and tools <sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup>.</p><p>Resources:</p><ul class="org-ul"><li>if your want to build your clover<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup></li><li>clover config wiki<sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup></li></ul></div><div id="outline-container-orgcdc5b1a" class="outline-3"><h3 id="orgcdc5b1a"><span class="section-number-3">1.1</span> installing USB stick, MBR is recommanded though GPT is another option</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil list</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/dev/disk0</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *121.3 GB   disk0</span><br><span class="line">   1:                        EFI EFI                     209.7 MB   disk0s1</span><br><span class="line">   2:          Apple_CoreStorage                         120.5 GB   disk0s2</span><br><span class="line">   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3</span><br><span class="line">/dev/disk1</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:                  Apple_HFS Macintosh              *120.1 GB   disk1</span><br><span class="line">                                 Logical Volume on disk0s2</span><br><span class="line">                                 687F3E47-6B8F-404E-B115-994652DD9008</span><br><span class="line">                                 Unencrypted</span><br><span class="line">/dev/disk2</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:     FDisk_partition_scheme                        *124.2 GB   disk2</span><br><span class="line">   1:                  Apple_HFS TM                      108.4 GB   disk2s1</span><br><span class="line">   2:                      Linux                         15.8 GB    disk2s2</span><br><span class="line">/dev/disk3</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:      GUID_partition_scheme                        *8.0 GB     disk3</span><br><span class="line">   1:                        EFI EFI                     209.7 MB   disk3s1</span><br><span class="line">   2:       Microsoft Basic Data EFS                     200.3 MB   disk3s2</span><br><span class="line">   3:                  Apple_HFS HFS                     7.4 GB     disk3s3</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil partitionDisk /dev/disk3 2 MBR FAT32 <span class="string">&quot;CLOVER&quot;</span> 200Mi HFS+J <span class="string">&quot;OSX&quot;</span> R</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Started partitioning on disk3</span><br><span class="line">Unmounting disk</span><br><span class="line">Creating the partition map</span><br><span class="line">Waiting <span class="keyword">for</span> the disks to reappear</span><br><span class="line">Formatting disk3s1 as MS-DOS (FAT32) with name CLOVER</span><br><span class="line">512 bytes per physical sector</span><br><span class="line">/dev/rdisk3s1: 403266 sectors <span class="keyword">in</span> 403266 FAT32 clusters (512 bytes/cluster)</span><br><span class="line">bps=512 spc=1 res=32 nft=2 mid=0xf8 spt=32 hds=32 hid=2 drv=0x80 bsec=409600 bspf=3151 rdcl=2 infs=1 bkbs=6</span><br><span class="line">Mounting disk</span><br><span class="line">Formatting disk3s2 as Mac OS Extended (Journaled) with name OSX</span><br><span class="line">Initialized /dev/rdisk3s2 as a 7 GB <span class="keyword">case</span>-insensitive HFS Plus volume with a 8192k journal</span><br><span class="line">Mounting disk</span><br><span class="line">Finished partitioning on disk3</span><br><span class="line">/dev/disk3</span><br><span class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></span><br><span class="line">   0:     FDisk_partition_scheme                        *8.0 GB     disk3</span><br><span class="line">   1:                 DOS_FAT_32 CLOVER                  209.7 MB   disk3s1</span><br><span class="line">   2:                  Apple_HFS OSX                     7.8 GB     disk3s2</span><br></pre></td></tr></table></figure></div><p>For some laptop,  you still have to GPT partition other than MBR.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil partitionDisk /dev/disk3 1 GPT HFS+J <span class="string">&quot;install_osx&quot;</span> R</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orge1bd641" class="outline-3"><h3 id="orge1bd641"><span class="section-number-3">1.2</span> installing Clover on USB</h3><div class="outline-text-3" id="text-1-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="string">&quot;/Volumes/Install OS X Yosemite/Install OS X Yosemite.app/Contents/Resources/createinstallmedia&quot;</span> --volume /Volumes/OSX --applicationpath <span class="string">&quot;/Volumes/Install OS X Yosemite/Install OS X Yosemite.app&quot;</span> --nointeraction</span><br><span class="line">sudo diskutil rename <span class="string">&quot;Install OS X Yosemite&quot;</span> install_osx</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org46f443b" class="outline-3"><h3 id="org46f443b"><span class="section-number-3">1.3</span> Setting laptop BIOS</h3><div class="outline-text-3" id="text-1-3"><ul class="org-ul"><li>VT-d (virtualization for direct i/o) should be disabled</li><li>TPM should be disabled</li><li>Anti-Theft mode should be disabled</li><li>secure boot should be disabled</li><li>fast boot should be disabled</li><li>DEP (data execution prevention) should be enabled</li><li>legacy boot optional, recommand enabled</li><li>CSM enabled or disabled(varies)</li><li>SATA mode should be AHCI</li></ul></div></div><div id="outline-container-orga9964c5" class="outline-3"><h3 id="orga9964c5"><span class="section-number-3">1.4</span> Booting the Installer USB on laptop</h3><div class="outline-text-3" id="text-1-4"><p>Do exactly as general guide and thinkpad T440P guide told, then will go to the installation.</p><ul class="org-ul"><li>run <code>disk utils</code> to format the target harddisk or SSD, which the osx will install on.</li><li>start OSX installation or restore from time machine.</li></ul><p>May encounter <b>can&apos;t be verified</b> error while install yosemite, setting the date in terminal.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date 062614102014.30</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orga00d33e" class="outline-3"><h3 id="orga00d33e"><span class="section-number-3">1.5</span> Post install kexts into laptop disk</h3><div class="outline-text-3" id="text-1-5"><p>Install clover on laptop with same setting as USB.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp *.kext /Library/Extensions/</span><br><span class="line">sudo kextcache -i /</span><br></pre></td></tr></table></figure></div><p>And there are many details to be done, like wireless network connection.</p></div></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.tonymacx86.com/threads/thanks-rehabman-yosemite-run-perfect-on-my-t440p.145029/#post-896309" target="_blank" rel="noopener">https://www.tonymacx86.com/threads/thanks-rehabman-yosemite-run-perfect-on-my-t440p.145029/#post-896309</a></p></div></div><div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.tonymacx86.com/threads/guide-lenovo-thinkpad-t440p.233282/" target="_blank" rel="noopener">https://www.tonymacx86.com/threads/guide-lenovo-thinkpad-t440p.233282/</a></p></div></div><div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara"><a href="https://www.tonymacx86.com/threads/guide-booting-the-os-x-installer-on-laptops-with-clover.148093/" target="_blank" rel="noopener">https://www.tonymacx86.com/threads/guide-booting-the-os-x-installer-on-laptops-with-clover.148093/</a></p></div></div><div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara"><a href="https://bitbucket.org/RehabMan/clover/downloads/" target="_blank" rel="noopener">https://bitbucket.org/RehabMan/clover/downloads/</a></p></div></div><div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/RehabMan/Clover" target="_blank" rel="noopener">https://github.com/RehabMan/Clover</a></p></div></div><div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara"><a href="https://clover-wiki.zetam.org/Configuration" target="_blank" rel="noopener">https://clover-wiki.zetam.org/Configuration</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org6c1989f&quot;&gt;1. lenovo thinkpad t440p with yosemite&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgcdc5b1a&quot;&gt;1.1. installing USB stick, MBR is recommanded though GPT is another option&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orge1bd641&quot;&gt;1.2. installing Clover on USB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org46f443b&quot;&gt;1.3. Setting laptop BIOS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orga9964c5&quot;&gt;1.4. Booting the Installer USB on laptop&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orga00d33e&quot;&gt;1.5. Post install kexts into laptop disk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="osx" scheme="https://angry-bird.github.io/categories/osx/"/>
    
    
      <category term="osx" scheme="https://angry-bird.github.io/tags/osx/"/>
    
      <category term="hackintosh" scheme="https://angry-bird.github.io/tags/hackintosh/"/>
    
  </entry>
  
  <entry>
    <title>openwrt on wndr4300</title>
    <link href="https://angry-bird.github.io/2018/10/31/openwrt%20on%20wndr4300/"/>
    <id>https://angry-bird.github.io/2018/10/31/openwrt on wndr4300/</id>
    <published>2018-10-31T00:00:00.000Z</published>
    <updated>2018-11-20T04:41:34.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org49553f7">1. Prep</a></li><li><a href="#orgdae4aad">2. Image Release</a></li><li><a href="#orgf95dcb1">3. Signal Strength</a></li><li><a href="#org737ed7c">4. Packages</a><ul><li><a href="#org872068a">4.1. usb storage</a></li><li><a href="#org5c01837">4.2. koolproxy</a></li><li><a href="#orgbed0b79">4.3. frp</a></li><li><a href="#org3fd5870">4.4. shadowsocksR</a></li><li><a href="#org2555285">4.5. aria2</a></li></ul></li><li><a href="#orgd6a88aa">5. Compile with SDK</a><ul><li><a href="#org3b09bfe">5.1. prepare</a></li><li><a href="#org3620ffa">5.2. shadowsocksR-libev for OpenWrt</a></li><li><a href="#orgc110d86">5.3. aria2</a></li></ul></li></ul></div></div><a id="more"></a><p>So I want to install OpenWrt on Netgear WNDR4300.</p><p>Currently, stable release is 18.06.1 which is merged with LEDE.</p><p>After days of trial, I stick to 17.01.4 which can run ssr and other cool packages.</p><div id="outline-container-org49553f7" class="outline-2"><h2 id="org49553f7"><span class="section-number-2">1</span> Prep</h2><div class="outline-text-2" id="text-1"><p>If the device can run a shell, gather device info by these commands.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh user@router.ip</span><br><span class="line">uname -a</span><br><span class="line">cat /proc/cpuinfo</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgdae4aad" class="outline-2"><h2 id="orgdae4aad"><span class="section-number-2">2</span> Image Release</h2><div class="outline-text-2" id="text-2"><p>It&apos;s recommanded to read <a href="https://openwrt.org/docs/guide-quick-start/begin_here" target="_blank" rel="noopener">start guide</a> first, then download the appropriate image file.</p><p>First-time installation on a device, or flashing openwrt firmware, choose the <code>factory install</code> <a href="https://archive.openwrt.org/releases/18.06.1/targets/ar71xx/nand/openwrt-18.06.1-ar71xx-nand-wndr4300-ubi-factory.img" target="_blank" rel="noopener">wndr4300 image</a>.<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup></p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tftp 192.168.1.1</span><br><span class="line">binary</span><br><span class="line">put lede-17.01.4-ar71xx-nand-wndr4300-ubi-factory.img</span><br></pre></td></tr></table></figure></div><p>Sysupgrading an existing openwrt device on it&apos;s web admin GUI, choose <a href="https://archive.openwrt.org/releases/18.06.1/targets/ar71xx/nand/openwrt-18.06.1-ar71xx-nand-wndr4300-squashfs-sysupgrade.tar" target="_blank" rel="noopener">wndr4300 system upgrade file</a>.Compileing package with corresponding openwrt device&apos;s SDK file, choose <a href="https://archive.openwrt.org/releases/18.06.1/targets/ar71xx/nand/openwrt-sdk-18.06.1-ar71xx-nand_gcc-7.3.0_musl.Linux-x86_64.tar.xz" target="_blank" rel="noopener">ar71xx SDK</a>.</p></div></div><div id="outline-container-orgf95dcb1" class="outline-2"><h2 id="orgf95dcb1"><span class="section-number-2">3</span> Signal Strength</h2><div class="outline-text-2" id="text-3"><ul class="org-ul"><li>Choose <code>Country</code> as <code>US</code>, which has <i>unlimited</i> <code>Transmit Power</code>.</li><li><code>Operating frequency</code> is another key parameter, relay radio will inherit the BSSID&apos;s <code>mode</code>, <code>channel</code> and <code>width</code>.</li><li><code>Frequency Width</code> may halve and will cause channel&apos;s <code>Bitrate</code> halving too.</li><li>2.4GHz &#x2013; 20/40MHz, 5GHz &#x2013; 20/40/80MHz</li></ul></div></div><div id="outline-container-org737ed7c" class="outline-2"><h2 id="org737ed7c"><span class="section-number-2">4</span> Packages</h2><div class="outline-text-2" id="text-4"><p>On openwrt 18.06.1, wndr4300 only has 13.71MB space to install packages, on LEDE 17.01.4, only has 13.9MB space.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br></pre></td></tr></table></figure></div></div><div id="outline-container-org872068a" class="outline-3"><h3 id="org872068a"><span class="section-number-3">4.1</span> usb storage</h3><div class="outline-text-3" id="text-4-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install kmod-fs-ext4 kmod-fs-btrfs block-mount kmod-usb-storage blkid hd-idle</span><br><span class="line"><span class="comment">### samba can install in 18.06.1</span></span><br><span class="line">opkg install luci-app-samba</span><br><span class="line"><span class="comment">### There&apos;s an error in 17.01.4, but still works</span></span><br><span class="line">/etc/init.d/samba <span class="built_in">enable</span></span><br><span class="line">/etc/init.d/samba restart</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org5c01837" class="outline-3"><h3 id="org5c01837"><span class="section-number-3">4.2</span> <a href="https://koolproxy.io/docs/installation" target="_blank" rel="noopener">koolproxy</a></h3><div class="outline-text-3" id="text-4-2"><div class="org-src-container"><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/cpuinfo</span><br><span class="line">opkg install --force-depends http://firmware.koolshare.cn/binary/KoolProxy/ar71xx/koolproxy_3.<span class="number">7</span>.<span class="number">2</span>-<span class="number">20180127</span>_mips_24kc.ipk</span><br></pre></td></tr></table></figure></div><p>koolproxy may cause http website unavailable.</p></div></div><div id="outline-container-orgbed0b79" class="outline-3"><h3 id="orgbed0b79"><span class="section-number-3">4.3</span> frp</h3><div class="outline-text-3" id="text-4-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp frpc.tar.xz root@192.168.1.1:/root</span><br><span class="line">ln -s /tmp/frpc /usr/bin/frpc</span><br></pre></td></tr></table></figure></div><p>Add to startup, or /etc/init.d/frpc, or /etc/rc.common, or /etc/rc.local</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xJf /root/frpc.tar.xz -C /tmp</span><br><span class="line">frpc -c /root/frpc.ini &amp;</span><br></pre></td></tr></table></figure></div><p>Remember to write this conf file, or sleep 10 seconds before start frpc.</p><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> =  vps_ip</span><br><span class="line"><span class="attr">server_port</span> = vps_port</span><br><span class="line"><span class="attr">token</span> = password</span><br><span class="line"><span class="attr">login_fail_exit</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">log_file</span> = /tmp/frpc.log</span><br><span class="line"></span><br><span class="line"><span class="section">[lede]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">subdomain</span> = lede</span><br><span class="line"></span><br><span class="line"><span class="section">[aria2]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">6800</span></span><br><span class="line"><span class="attr">subdomain</span> = aria2</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org3fd5870" class="outline-3"><h3 id="org3fd5870"><span class="section-number-3">4.4</span> shadowsocksR</h3><div class="outline-text-3" id="text-4-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scp ~/Downloads/luci-app-shaodwsocksR*_all.ipk root@192.168.1.1:/tmp/</span><br><span class="line">opkg update</span><br><span class="line">opkg remove dnsmasq</span><br><span class="line">mv /etc/dnsmasq.conf /etc/dnsmasq.conf.o</span><br><span class="line">mv /etc/config/dhcp /etc/config/dncp.o</span><br><span class="line">opkg install luci-app-shadowsocksR-GFW_1.2.1_all.ipk</span><br></pre></td></tr></table></figure></div><p>If dnsmasq running but not working, check /etc/config/network.</p><div class="org-src-container"><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config interface &apos;wan&apos;</span><br><span class="line">  option proto &apos;dhcp&apos;</span><br><span class="line">  option ifname &apos;eth0&apos;</span><br></pre></td></tr></table></figure></div><p>If GFW not working, add a line to /etc/dnsmasq.conf</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> conf-dir=/etc/dnsmasq.ssr &gt;&gt; /etc/dnsmasq.conf</span><br><span class="line">/etc/init.d/dnsmasq restart</span><br></pre></td></tr></table></figure></div><p>/etc/china_ssr.txt/etc/dnsmasq.ssr/gfw_list.conf</p></div></div><div id="outline-container-org2555285" class="outline-3"><h3 id="org2555285"><span class="section-number-3">4.5</span> aria2</h3><div class="outline-text-3" id="text-4-5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install aria2_1.34.0-1_mips_24kc.ipk</span><br><span class="line">opkg install luci-app-aria2</span><br><span class="line">aria2c --conf-path=/home/aria2/aria2.conf -D</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">enable-rpc</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">rpc-allow-origin-all</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">rpc-listen-all</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">quiet</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">continue</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">input-file</span>=/home/aria2/aria2.session</span><br><span class="line"><span class="attr">save-session</span>=/home/aria2/aria2.session</span><br><span class="line"><span class="attr">dht-file-path</span>=/home/aria2/dht.dat</span><br><span class="line"><span class="attr">log</span>=/home/aria2/aria2.log</span><br><span class="line"><span class="attr">file-allocation</span>=prealloc</span><br><span class="line"><span class="attr">bt-enable-lpd</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">enable-dht</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">rpc-listen-port</span>=<span class="number">6800</span></span><br><span class="line"><span class="attr">dir</span>=/home/tmp/inbox</span><br><span class="line"><span class="attr">disk-cache</span>=<span class="number">4</span>M</span><br><span class="line"><span class="attr">max-overall-download-limit</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">max-overall-upload-limit</span>=<span class="number">90</span>K</span><br><span class="line"><span class="attr">max-concurrent-downloads</span>=<span class="number">3</span></span><br><span class="line"><span class="attr">max-connection-per-server</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">min-split-size</span>=<span class="number">20</span>M</span><br><span class="line"><span class="attr">split</span>=<span class="number">5</span></span><br><span class="line"><span class="attr">save-session-interval</span>=<span class="number">30</span></span><br><span class="line"><span class="attr">follow-torrent</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">listen-port</span>=<span class="number">6881</span>-<span class="number">6999</span></span><br><span class="line"><span class="attr">bt-max-peers</span>=<span class="number">55</span></span><br><span class="line"><span class="attr">user-agent</span>=Mozilla/<span class="number">5.0</span> (X11; Linux x<span class="number">86_64</span>) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">63.0</span>.<span class="number">3239.132</span> Safari/<span class="number">537.36</span></span><br><span class="line"><span class="attr">rpc-secret</span>=yourtoken</span><br><span class="line"><span class="attr">log-level</span>=error</span><br><span class="line"><span class="attr">check-certificate</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">lowest-speed-limit</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orgd6a88aa" class="outline-2"><h2 id="orgd6a88aa"><span class="section-number-2">5</span> Compile with SDK</h2><div class="outline-text-2" id="text-5"></div><div id="outline-container-org3b09bfe" class="outline-3"><h3 id="org3b09bfe"><span class="section-number-3">5.1</span> prepare</h3><div class="outline-text-3" id="text-5-1"><ul class="org-ul"><li><p>Choose Ubuntu 16.04 x64 to compile</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gawk libncurses5-dev libz-dev zlib1g-dev git ccache</span><br></pre></td></tr></table></figure></div></li><li><p>Download corresponding SDK</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget https://archive.openwrt.org/releases/17.01.4/targets/ar71xx/nand/lede-sdk-17.01.4-ar71xx-nand_gcc-5.4.0_musl-1.1.16.Linux-x86_64.tar.xz</span><br><span class="line">xd -d lede-sdk-17.01.4-ar71xx-nand_gcc-5.4.0_musl-1.1.16.Linux-x86_64.tar.xz</span><br><span class="line">tar -xf lede-sdk-17.01.4-ar71xx-nand_gcc-5.4.0_musl-1.1.16.Linux-x86_64</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> OpenWrt-SDK-*</span><br><span class="line"><span class="comment">### Update packages, may not necessary.</span></span><br><span class="line">./scripts/feeds update</span><br><span class="line">./scripts/feeds update packages base luci routing telephony</span><br><span class="line">./scripts/feeds install libpcre zlib libopenssl</span><br></pre></td></tr></table></figure></div></li></ul></div></div><div id="outline-container-org3620ffa" class="outline-3"><h3 id="org3620ffa"><span class="section-number-3">5.2</span> shadowsocksR-libev for OpenWrt<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></h3><div class="outline-text-3" id="text-5-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ywb94/openwrt-ssr.git package/openwrt-ssr</span><br><span class="line"><span class="comment">### Choose in menu</span></span><br><span class="line"><span class="comment"># luci -&gt;3. Applications-&gt; luci-app-shadowsocksR         origin ver</span></span><br><span class="line"><span class="comment"># luci -&gt;3. Applications-&gt; luci-app-shadowsocksR-GFW     GFWList ver</span></span><br><span class="line">make menuconfig</span><br><span class="line"><span class="built_in">pushd</span> package/openwrt-ssr/tools/po2lmo</span><br><span class="line">make &amp;&amp; sudo make install</span><br><span class="line"><span class="built_in">popd</span></span><br><span class="line"><span class="comment"># po2lmo ./package/openwrt-ssr/files/luci/i18n/shadowsocksr.zh-cn.po ./package/openwrt-ssr/files/luci/i18n/shadowsocksr.zh-cn.lmo</span></span><br><span class="line"></span><br><span class="line">make package/openwrt-ssr/compile V=99</span><br><span class="line">ls bin/packages/mips_24kc/base/</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgc110d86" class="outline-3"><h3 id="orgc110d86"><span class="section-number-3">5.3</span> aria2</h3><div class="outline-text-3" id="text-5-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Openwrt official aria2 package is outdated, so install another compiled version.</span></span><br><span class="line">opkg install aria2</span><br><span class="line"><span class="comment">### compile own ipk</span></span><br><span class="line"><span class="built_in">cd</span> openwrt/lede*</span><br><span class="line"><span class="built_in">export</span> LC_ALL=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line">./scripts/feeds install aria2</span><br><span class="line">vi package/feeds/packages/aria2/Makefile</span><br><span class="line">cp package/feeds/packages/aria2/Makefile aria2.makefile</span><br><span class="line"><span class="comment">### change PKG_VERSION to 1.34.0, and md5 to 2c21fb1b154f828ae179b03fd368c42d</span></span><br><span class="line">make menuconfig</span><br><span class="line"><span class="comment">### Network -&gt; File Transfers -&gt; aria2 configuration,</span></span><br><span class="line"><span class="comment">### Select magnet, bit torrent... or vi .config</span></span><br><span class="line">CONFIG_PACKAGE_aria2=y</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Aria2 Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">CONFIG_ARIA2_OPENSSL=y</span><br><span class="line"><span class="comment"># CONFIG_ARIA2_GNUTLS is not set</span></span><br><span class="line"><span class="comment"># CONFIG_ARIA2_NOSSL is not set</span></span><br><span class="line">CONFIG_ARIA2_BITTORRENT=y</span><br><span class="line"><span class="comment"># CONFIG_ARIA2_SFTP is not set</span></span><br><span class="line"><span class="comment"># CONFIG_ARIA2_ASYNC_DNS is not set</span></span><br><span class="line"><span class="comment"># CONFIG_ARIA2_COOKIE is not set</span></span><br><span class="line">CONFIG_ARIA2_METALINK=y</span><br><span class="line">CONFIG_ARIA2_LIBXML2=y</span><br><span class="line"></span><br><span class="line">make package/aria2/download -j8 V=s</span><br><span class="line">make package/aria2/prepare -j8 V=s</span><br><span class="line">make package/aria2/compile -j8 V=s</span><br><span class="line">ls bin/packages/mips_24kc/packages/</span><br><span class="line">mv bin/packages/mips_24kc/packages/aria2_1.34.0-1_mips_24kc.ipk ~/</span><br><span class="line">scp eula.edu:aria2_1.34.0-1_mips_24kc.ipk ./</span><br><span class="line">scp ./aria2_1.34.0-1_mips_24kc.ipk root@192.168.1.1:/tmp/</span><br></pre></td></tr></table></figure></div></div></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/softwaredownload/openwrt-fanqiang/blob/master/ebook/wndr4300/5.wndr4300-flash-fanqiang-img.md" target="_blank" rel="noopener">https://github.com/softwaredownload/openwrt-fanqiang/blob/master/ebook/wndr4300/5.wndr4300-flash-fanqiang-img.md</a></p></div></div><div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/daiaji/openwrt-ssr" target="_blank" rel="noopener">https://github.com/daiaji/openwrt-ssr</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org49553f7&quot;&gt;1. Prep&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgdae4aad&quot;&gt;2. Image Release&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf95dcb1&quot;&gt;3. Signal Strength&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org737ed7c&quot;&gt;4. Packages&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org872068a&quot;&gt;4.1. usb storage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org5c01837&quot;&gt;4.2. koolproxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgbed0b79&quot;&gt;4.3. frp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org3fd5870&quot;&gt;4.4. shadowsocksR&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2555285&quot;&gt;4.5. aria2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgd6a88aa&quot;&gt;5. Compile with SDK&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org3b09bfe&quot;&gt;5.1. prepare&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org3620ffa&quot;&gt;5.2. shadowsocksR-libev for OpenWrt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc110d86&quot;&gt;5.3. aria2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="openwrt" scheme="https://angry-bird.github.io/tags/openwrt/"/>
    
      <category term="netgear" scheme="https://angry-bird.github.io/tags/netgear/"/>
    
  </entry>
  
  <entry>
    <title>rar command line</title>
    <link href="https://angry-bird.github.io/2018/09/14/rar/"/>
    <id>https://angry-bird.github.io/2018/09/14/rar/</id>
    <published>2018-09-14T00:00:00.000Z</published>
    <updated>2018-09-14T14:39:39.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org9914163">1. Basic usage</a></li><li><a href="#org967468c">2. 7z usage</a></li></ul></div></div><a id="more"></a><p>rar is the most popular compression software<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.</p><div id="outline-container-org9914163" class="outline-2"><h2 id="org9914163"><span class="section-number-2">1</span> Basic usage</h2><div class="outline-text-2" id="text-1"><div class="org-src-container"><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line">rar.exe a -m5 -pPASSWORD test.rar .\tmp</span><br><span class="line">rar.exe a -m5 -hpPASSWORD -df test.rar .\tmp</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org967468c" class="outline-2"><h2 id="org967468c"><span class="section-number-2">2</span> 7z usage</h2><div class="outline-text-2" id="text-2"><p>When 7z.exe and 7z.dll are under %PATH%, we can also run 7z in command line,our compiled 7za.exe, 7zr.exe work similarly.</p><p>7z vs rar:</p><ul class="org-ul"><li>7z&apos;s compression algorithm is more efficient than rar</li><li>7z is an open source software, and will be better choice for developers</li><li>rar provides more sophisticated features with more switches</li><li>rar&apos;s self-extracting archive and rar archive can convert between each other</li></ul><div class="org-src-container"><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="number">7</span>z.exe a</span><br></pre></td></tr></table></figure></div></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="http://acritum.com/winrar/console-rar-manual" target="_blank" rel="noopener">http://acritum.com/winrar/console-rar-manual</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org9914163&quot;&gt;1. Basic usage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org967468c&quot;&gt;2. 7z usage&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
    
      <category term="rar" scheme="https://angry-bird.github.io/tags/rar/"/>
    
      <category term="cli" scheme="https://angry-bird.github.io/tags/cli/"/>
    
      <category term="commands" scheme="https://angry-bird.github.io/tags/commands/"/>
    
  </entry>
  
  <entry>
    <title>Shell Text Stream</title>
    <link href="https://angry-bird.github.io/2018/08/30/Shell%20Text%20Stream/"/>
    <id>https://angry-bird.github.io/2018/08/30/Shell Text Stream/</id>
    <published>2018-08-30T00:00:00.000Z</published>
    <updated>2018-08-30T16:49:00.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org1103043">1. Query with column in text</a><ul><li><a href="#org9c2393b">1.1. Preprocess of text</a></li><li><a href="#org0c9fc92">1.2. Query IP GeoLocation</a></li><li><a href="#orgfd36edf">1.3. Query MAC Vendor</a></li></ul></li></ul></div></div><a id="more"></a><p>Deal text with sort, tail, head, cut, diff, grep, sed, awk.</p><div id="outline-container-org1103043" class="outline-2"><h2 id="org1103043"><span class="section-number-2">1</span> Query with column in text</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-org9c2393b" class="outline-3"><h3 id="org9c2393b"><span class="section-number-3">1.1</span> Preprocess of text</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">awk -F <span class="string">&apos;[@-]&apos;</span> <span class="string">&apos;/@gmail.com/{print $1,$3}&apos;</span> access.log | awk -F <span class="string">&apos;[[/=]&apos;</span> <span class="string">&apos;{print $1, $NF}&apos;</span>&gt;ip_user.txt | sort -V | uniq -c &gt; ip_user_sort.txt</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org0c9fc92" class="outline-3"><h3 id="org0c9fc92"><span class="section-number-3">1.2</span> Query IP GeoLocation</h3><div class="outline-text-3" id="text-1-2"></div><div id="outline-container-org0044fc4" class="outline-4"><h4 id="org0044fc4">awk</h4><div class="outline-text-4" id="text-org0044fc4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Default delimiter is blankspace.</span></span><br><span class="line">awk <span class="string">&apos;{print $1}&apos;</span> hosts.txt</span><br><span class="line">awk <span class="string">&apos;{print $1}&apos;</span> hosts.txt | tee ip.txt</span><br><span class="line">awk <span class="string">&apos;BEGIN {print &quot;IP\n---&quot;} {print $1}&apos;</span> hosts.txt</span><br><span class="line">awk <span class="string">&apos;BEGIN {print &quot;IP&quot;; print &quot;---&quot;} {print $1} END {print &quot;---&quot;}&apos;</span> hosts.txt</span><br><span class="line"><span class="comment">### Define another delimiter with -f &apos;x&apos;.</span></span><br><span class="line">awk -F <span class="string">&apos;:&apos;</span> <span class="string">&apos;{print $1}&apos;</span> hosts.txt</span><br><span class="line">awk -F: <span class="string">&apos;{print $1}&apos;</span> hosts.txt</span><br><span class="line"><span class="comment">### Define multiple delimiters</span></span><br><span class="line">awk -F <span class="string">&apos;[:@ /t]&apos;</span> <span class="string">&apos;{print $1}&apos;</span> hosts.txt</span><br><span class="line"><span class="comment">### Match strings</span></span><br><span class="line">awk -F: <span class="string">&apos;/root/&apos;</span> /etc/passwd</span><br><span class="line">awk -F: <span class="string">&apos;/root/{print $1}&apos;</span> /etc/passwd</span><br><span class="line"><span class="comment">### Define string delimiter</span></span><br><span class="line">awk <span class="string">&apos;$1~/^(12)/{print $1}&apos;</span> hosts.txt</span><br><span class="line"><span class="comment">## Print matched lines, and set $3</span></span><br><span class="line">awk <span class="string">&apos;$2==&quot;gmail.com&quot;{$3=&quot;gg&quot;; print $1$3}&apos;</span> hosts.txt</span><br><span class="line"><span class="comment">## Print all lines, and set $3</span></span><br><span class="line">awk <span class="string">&apos;$2==&quot;gmail.com&quot;{$3=&quot;gg&quot;}{print $1$3}&apos;</span> hosts.txt</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org517d11f" class="outline-4"><h4 id="org517d11f">Detect Private IP</h4><div class="outline-text-4" id="text-org517d11f"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Print Lan IP</span></span><br><span class="line">awk <span class="string">&apos;$1~/^(10\.|192\.168|127\.0)/{print $1}&apos;</span> hosts.txt</span><br><span class="line"><span class="comment">## Skip Lan IP</span></span><br><span class="line">awk <span class="string">&apos;$1!~/^(10\.|192\.168|127)/{print $1}&apos;</span> hosts.txt</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgd196a7e" class="outline-4"><h4 id="orgd196a7e">Curl</h4><div class="outline-text-4" id="text-orgd196a7e"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://ip-api.com/json/102.34.12.51</span><br><span class="line">curl https://ipapi.co/102.34.12.51/json</span><br><span class="line">curl https://ip.cn/index.php?ip=102.34.12.51</span><br><span class="line">sleep 0.1</span><br><span class="line">awk <span class="string">&apos;$1!~/^(10\.|192\.168|127)/{system(&quot;curl http://ip-api.com/json/&quot;$1); sleep 0.1}&apos;</span> hosts.txt | tee iploc.txt</span><br><span class="line">awk <span class="string">&apos;$1!~/^(10\.|192\.168|127)/{system(&quot;curl https://ipapi.co/$1/json&quot;); sleep 0.1}&apos;</span> hosts.txt</span><br><span class="line">awk <span class="string">&apos;$1!~/^(10\.|192\.168|127)/{system(&quot;curl https://ip.cn/index.php?ip=&quot;$1); sleep 0.1}&apos;</span> hosts.txt</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orgfd36edf" class="outline-3"><h3 id="orgfd36edf"><span class="section-number-3">1.3</span> Query MAC Vendor</h3><div class="outline-text-3" id="text-1-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl https://api.macvendors.com/64:76:ba:a6:fe:4a</span><br><span class="line">curl http://macvendors.co/api/64:76:ba:a6:fe:4a</span><br><span class="line">curl http://macvendors.co/api/64:76:ba:a6:fe:4a/pipe</span><br><span class="line">arp -a | awk -F <span class="string">&apos;[() ]&apos;</span> <span class="string">&apos;$0!~/^(\?)/{print $6}&apos;</span></span><br><span class="line">arp -a | awk -F <span class="string">&apos;[() ]&apos;</span> <span class="string">&apos;$0!~/^(\?)/{system(&quot;curl https://api.macvendors.com/&quot;$6); sleep 0.1}&apos;</span></span><br><span class="line">arp -a | awk -F <span class="string">&apos;[() ]&apos;</span> <span class="string">&apos;$0!~/^(\?)/{system(&quot;curl http://macvendors.co/api/vendorname/&quot;$6); sleep 0.1}&apos;</span></span><br><span class="line">arp -a | awk -F <span class="string">&apos;[() ]&apos;</span> <span class="string">&apos;$0!~/^(\?)/{system(&quot;curl http://macvendors.co/api/&quot;$6); sleep 0.1}&apos;</span></span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org1103043&quot;&gt;1. Query with column in text&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org9c2393b&quot;&gt;1.1. Preprocess of text&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org0c9fc92&quot;&gt;1.2. Query IP GeoLocation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgfd36edf&quot;&gt;1.3. Query MAC Vendor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="shell" scheme="https://angry-bird.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Python3 UDP</title>
    <link href="https://angry-bird.github.io/2018/08/25/Python3-UDP/"/>
    <id>https://angry-bird.github.io/2018/08/25/Python3-UDP/</id>
    <published>2018-08-25T00:00:00.000Z</published>
    <updated>2018-08-25T10:49:54.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orgd101988">1. socket</a><ul><li><a href="#orga51bc44">1.1. Python3 Coding Style</a></li><li><a href="#org4be5932">1.2. TCP Client</a></li><li><a href="#orgc977076">1.3. UDP Client</a></li><li><a href="#orgb10e0a0">1.4. test</a></li><li><a href="#org2cb5cea">1.5. UDP Server</a></li></ul></li><li><a href="#org60cead0">2. Scan</a><ul><li><a href="#org528e3a7">2.1. class IP</a></li><li><a href="#orgf364a20">2.2. class ICMP</a></li><li><a href="#orgb9a0944">2.3. scan.py</a></li></ul></li></ul></div></div><a id="more"></a><p>Memos to socket programming in python3.</p><div id="outline-container-orgd101988" class="outline-2"><h2 id="orgd101988"><span class="section-number-2">1</span> socket</h2><div class="outline-text-2" id="text-1"><ul class="org-ul"><li>Tcp socket is a little different but common and reliable connection.</li><li>Linux must run python as sudo.</li><li>Python3 socket only deal with binary data, must encode user data.</li><li>Host IP must be actual address, not 127.0.0.1.</li></ul></div><div id="outline-container-orga51bc44" class="outline-3"><h3 id="orga51bc44"><span class="section-number-3">1.1</span> Python3 Coding Style</h3><div class="outline-text-3" id="text-1-1"><p>Add this info at head of every <b>filename.py</b>.</p><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&apos;&apos;&apos;</span></span><br><span class="line"><span class="string">| author: demo@demo.com</span></span><br><span class="line"><span class="string">| date: 08/24/2018</span></span><br><span class="line"><span class="string">| desc: Learn Socket</span></span><br><span class="line"><span class="string">| version: 0.1</span></span><br><span class="line"><span class="string">&apos;&apos;&apos;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org4be5932" class="outline-3"><h3 id="org4be5932"><span class="section-number-3">1.2</span> TCP Client</h3><div class="outline-text-3" id="text-1-2"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">target_host = <span class="string">&quot;www.baidu.com&quot;</span></span><br><span class="line">target_port = <span class="number">80</span></span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((target_host,target_port))</span><br><span class="line">client.send(<span class="string">&quot;GET / HTTP/1.1\r\nHost: baidu.com\r\n\r\n&quot;</span>.encode(<span class="string">&apos;utf-8&apos;</span>))</span><br><span class="line">response = client.recv(<span class="number">4096</span>)</span><br><span class="line">print(response)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgc977076" class="outline-3"><h3 id="orgc977076"><span class="section-number-3">1.3</span> UDP Client</h3><div class="outline-text-3" id="text-1-3"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;192.168.11.113&quot;</span></span><br><span class="line">port = <span class="number">32000</span></span><br><span class="line">udp_client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># data = &apos;hello&apos;.encode(encoding=&apos;utf-8&apos;)</span></span><br><span class="line">    data = input(<span class="string">&apos;&gt;&gt;&gt;&apos;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    addr = (host, port)</span><br><span class="line"><span class="comment">### Python3 socket only deal with binary data, must encode user data.</span></span><br><span class="line">    udp_client.sendto(data.encode(encoding=<span class="string">&apos;utf-8&apos;</span>), addr)</span><br><span class="line">    print(<span class="string">&apos;Sending: &apos;</span>, addr, data)</span><br><span class="line">    data,addr = udp_client.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">&apos;Recv from&apos;</span>, addr, data)</span><br><span class="line"></span><br><span class="line">udp_client.close()</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb10e0a0" class="outline-3"><h3 id="orgb10e0a0"><span class="section-number-3">1.4</span> test</h3><div class="outline-text-3" id="text-1-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Must run .py as sudo</span></span><br><span class="line">sudo python udp.py</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org2cb5cea" class="outline-3"><h3 id="org2cb5cea"><span class="section-number-3">1.5</span> UDP Server</h3><div class="outline-text-3" id="text-1-5"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment">### Make sure the host&apos;s IP is empty to listen on all IP.</span></span><br><span class="line"><span class="comment">### Or actual IP addr, not 127.0.0.1 which make trouble.</span></span><br><span class="line">ip_port=(<span class="string">&apos;&apos;</span>,<span class="number">32000</span>)</span><br><span class="line">BUFSIZE=<span class="number">1024</span></span><br><span class="line">udp_server=socket.socket(socket.AF_INET,socket.SOCK_DGRAM)</span><br><span class="line">udp_server.bind(ip_port)</span><br><span class="line">print(<span class="string">&apos;Waiting for connection...&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    msg,addr=udp_server.recvfrom(BUFSIZE)</span><br><span class="line">    print(<span class="string">&apos;Recv from&apos;</span>, addr, msg)</span><br><span class="line">    udp_server.sendto(msg, addr)</span><br><span class="line">    print(<span class="string">&apos;Send back&apos;</span>, addr, msg)</span><br><span class="line"></span><br><span class="line">udp_server.close()</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org60cead0" class="outline-2"><h2 id="org60cead0"><span class="section-number-2">2</span> Scan</h2><div class="outline-text-2" id="text-2"><ul class="org-ul"><li>TCP, UDP, ICMP are IP packets.</li><li>Use struct.unpack network stream to C strings.</li><li>Send UDP packets, and decode ICMP packets.</li></ul></div><div id="outline-container-org528e3a7" class="outline-3"><h3 id="org528e3a7"><span class="section-number-3">2.1</span> class IP</h3><div class="outline-text-3" id="text-2-1"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IP</span><span class="params">(ctypes.Structure)</span>:</span></span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&apos;ihl&apos;</span>, ctypes.c_ubyte, <span class="number">4</span>),</span><br><span class="line">        (<span class="string">&apos;ver&apos;</span>, ctypes.c_ubyte, <span class="number">4</span>),</span><br><span class="line">        (<span class="string">&apos;tos&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;len&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;id&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;offset&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;ttl&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;pro&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;sum&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;src&apos;</span>, ctypes.c_uint),</span><br><span class="line">        (<span class="string">&apos;dst&apos;</span>, ctypes.c_uint),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.from_buffer_copy(socket_buffer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        self.protocol_map = {<span class="number">1</span>:<span class="string">&quot;ICMP&quot;</span>, <span class="number">6</span>:<span class="string">&quot;TCP&quot;</span>, <span class="number">17</span>:<span class="string">&quot;UDP&quot;</span>}</span><br><span class="line">        self.src_addr = socket.inet_ntoa(struct.pack(<span class="string">&quot;&lt;L&quot;</span>,self.src))</span><br><span class="line">        self.dst_addr = socket.inet_ntoa(struct.pack(<span class="string">&quot;&lt;L&quot;</span>,self.dst))</span><br><span class="line">        self.ihlen = self.ihl * <span class="number">4</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.protocol = self.protocol_map[self.pro]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            self.protocol = str(self.pro)</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf364a20" class="outline-3"><h3 id="orgf364a20"><span class="section-number-3">2.2</span> class ICMP</h3><div class="outline-text-3" id="text-2-2"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ICMP</span><span class="params">(ctypes.Structure)</span>:</span></span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&apos;type&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;code&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;sum&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;id&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;seq&apos;</span>, ctypes.c_ushort),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.from_buffer_copy(socket_buffer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb9a0944" class="outline-3"><h3 id="orgb9a0944"><span class="section-number-3">2.3</span> scan.py</h3><div class="outline-text-3" id="text-2-3"><div class="org-src-container"><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&apos;&apos;&apos;</span></span><br><span class="line"><span class="string">| author: demo@echo.com</span></span><br><span class="line"><span class="string">| date: 08/24/2018</span></span><br><span class="line"><span class="string">| desc: UDP tools</span></span><br><span class="line"><span class="string">| version: 0.1</span></span><br><span class="line"><span class="string">&apos;&apos;&apos;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> netaddr</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> fcntl</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColorTxt</span>:</span></span><br><span class="line">    imp = <span class="string">&apos;\033[1;33m[!]\033[1;m &apos;</span></span><br><span class="line">    err = <span class="string">&apos;\033[1;35m[*]\033[1;m &apos;</span></span><br><span class="line">    que = <span class="string">&apos;\033[1;34m[?]\033[1;m &apos;</span></span><br><span class="line">    ski = <span class="string">&apos;\033[1;31m[-]\033[1;m &apos;</span></span><br><span class="line">    tar = <span class="string">&apos;\033[1;32m[+]\033[1;m &apos;</span></span><br><span class="line">    run = <span class="string">&apos;\033[1;36m[~]\033[1;m &apos;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IP</span><span class="params">(ctypes.Structure)</span>:</span></span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&apos;ihl&apos;</span>, ctypes.c_ubyte, <span class="number">4</span>),</span><br><span class="line">        (<span class="string">&apos;ver&apos;</span>, ctypes.c_ubyte, <span class="number">4</span>),</span><br><span class="line">        (<span class="string">&apos;tos&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;len&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;id&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;offset&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;ttl&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;pro&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;sum&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;src&apos;</span>, ctypes.c_uint),</span><br><span class="line">        (<span class="string">&apos;dst&apos;</span>, ctypes.c_uint),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.from_buffer_copy(socket_buffer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        self.protocol_map = {<span class="number">1</span>:<span class="string">&quot;ICMP&quot;</span>, <span class="number">6</span>:<span class="string">&quot;TCP&quot;</span>, <span class="number">17</span>:<span class="string">&quot;UDP&quot;</span>}</span><br><span class="line">        self.src_addr = socket.inet_ntoa(struct.pack(<span class="string">&quot;&lt;L&quot;</span>,self.src))</span><br><span class="line">        self.dst_addr = socket.inet_ntoa(struct.pack(<span class="string">&quot;&lt;L&quot;</span>,self.dst))</span><br><span class="line">        self.ihlen = self.ihl * <span class="number">4</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.protocol = self.protocol_map[self.pro]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            self.protocol = str(self.pro)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ICMP</span><span class="params">(ctypes.Structure)</span>:</span></span><br><span class="line">    _fields_ = [</span><br><span class="line">        (<span class="string">&apos;type&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;code&apos;</span>, ctypes.c_ubyte),</span><br><span class="line">        (<span class="string">&apos;sum&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;id&apos;</span>, ctypes.c_ushort),</span><br><span class="line">        (<span class="string">&apos;seq&apos;</span>, ctypes.c_ushort),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.from_buffer_copy(socket_buffer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, socket_buffer)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;192.168.11.113&quot;</span></span><br><span class="line">SUBNET = <span class="string">&apos;192.168.11.0/24&apos;</span></span><br><span class="line">MESSAGE = <span class="string">&apos;hello&apos;</span>.encode(encoding=<span class="string">&apos;utf-8&apos;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">udp_sender</span><span class="params">(SUBNET, MESSAGE)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    sender = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">    <span class="keyword">for</span> ip <span class="keyword">in</span> netaddr.IPNetwork(SUBNET):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sender.sendto(MESSAGE, (<span class="string">&quot;%s&quot;</span> % ip, <span class="number">32000</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.name==<span class="string">&apos;nt&apos;</span>:</span><br><span class="line">        socket_protocol = socket.IPPROTO_IP</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        socket_protocol = socket.IPPROTO_ICMP</span><br><span class="line"></span><br><span class="line">    sniffer = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket_protocol)</span><br><span class="line">    sniffer.bind((HOST, <span class="number">0</span>))</span><br><span class="line">    sniffer.setsockopt(socket.IPPROTO_IP, socket.IP_HDRINCL, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.name == <span class="string">&apos;nt&apos;</span>:</span><br><span class="line">        sniffer.ioctl(socket.SIO_RCVALL, socket.RCVALL_ON)</span><br><span class="line"></span><br><span class="line">    t = threading.Thread(target = udp_sender, args = (SUBNET, MESSAGE))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            raw_buffer = sniffer.recvfrom(<span class="number">65565</span>)[<span class="number">0</span>]</span><br><span class="line">            ip_header = IP(raw_buffer)</span><br><span class="line"></span><br><span class="line">            buf = raw_buffer[ip_header.ihlen:ip_header.ihlen + ctypes.sizeof(ICMP)]</span><br><span class="line">            icmp_header = ICMP(buf)</span><br><span class="line">            <span class="comment"># print (&quot;[*] Received -&gt; Protocol:%s, Source:%s, TTL:%d, Type:%d, Code:%d&quot; % (ip_header.protocol, ip_header.src_addr, ip_header.ttl, icmp_header.type, icmp_header.code))</span></span><br><span class="line">            <span class="keyword">if</span> icmp_header.code == <span class="number">3</span> <span class="keyword">and</span> icmp_header.type == <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">if</span> netaddr.IPAddress(ip_header.src_addr) <span class="keyword">in</span> netaddr.IPNetwork(SUBNET):</span><br><span class="line">                    <span class="comment"># print(raw_buffer[len(raw_buffer) - len(MESSAGE):])</span></span><br><span class="line">                    <span class="keyword">if</span> raw_buffer[len(raw_buffer) - len(MESSAGE):] == MESSAGE:</span><br><span class="line">                        <span class="keyword">print</span> (<span class="string">&apos;%s%s is up&apos;</span> %  (ColorTxt.tar, ip_header.src_addr))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> (<span class="string">&apos;%s%s appears to be up&apos;</span> %  (ColorTxt.tar, ip_header.src_addr))</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt <span class="keyword">as</span> e:</span><br><span class="line">        print(ColorTxt.err, <span class="string">&apos;Quit&apos;</span>)</span><br><span class="line">        <span class="keyword">if</span> os.name == <span class="string">&apos;nt&apos;</span>:</span><br><span class="line">            sniffer.ioctl(socket.SIO_RCVALL, socket.RCVALL_OFF)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&apos;__main__&apos;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgd101988&quot;&gt;1. socket&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orga51bc44&quot;&gt;1.1. Python3 Coding Style&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org4be5932&quot;&gt;1.2. TCP Client&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc977076&quot;&gt;1.3. UDP Client&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgb10e0a0&quot;&gt;1.4. test&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2cb5cea&quot;&gt;1.5. UDP Server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org60cead0&quot;&gt;2. Scan&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org528e3a7&quot;&gt;2.1. class IP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf364a20&quot;&gt;2.2. class ICMP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgb9a0944&quot;&gt;2.3. scan.py&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="python3" scheme="https://angry-bird.github.io/categories/python3/"/>
    
    
      <category term="UDP" scheme="https://angry-bird.github.io/tags/UDP/"/>
    
      <category term="socket" scheme="https://angry-bird.github.io/tags/socket/"/>
    
      <category term="python3" scheme="https://angry-bird.github.io/tags/python3/"/>
    
  </entry>
  
  <entry>
    <title>ffmpeg</title>
    <link href="https://angry-bird.github.io/2018/02/24/ffmpeg/"/>
    <id>https://angry-bird.github.io/2018/02/24/ffmpeg/</id>
    <published>2018-02-24T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orgccb5023">1. About</a></li><li><a href="#orgab5a5cc">2. concat</a></li><li><a href="#org8239a2c">3. split</a></li><li><a href="#org316a1df">4. convert</a></li></ul></div></div><a id="more"></a><div id="outline-container-orgccb5023" class="outline-2"><h2 id="orgccb5023"><span class="section-number-2">1</span> About</h2><div class="outline-text-2" id="text-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ffmpeg -i video.avi</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgab5a5cc" class="outline-2"><h2 id="orgab5a5cc"><span class="section-number-2">2</span> concat</h2><div class="outline-text-2" id="text-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">  <span class="comment"># ls *.mkv &gt;&gt; list.txt</span></span><br><span class="line">file <span class="string">&apos;/path/to/file1&apos;</span></span><br><span class="line">file <span class="string">&apos;/path/to/file2&apos;</span></span><br><span class="line">file <span class="string">&apos;/path/to/file3&apos;</span></span><br><span class="line"></span><br><span class="line">ffmpeg -f concat -i list.txt -c copy output</span><br><span class="line">ffmpeg -i <span class="string">&quot;concat:file1.mpg|file2.mpg|file3.mpg&quot;</span> -c copy output.mpg</span><br><span class="line"></span><br><span class="line"><span class="comment">### Merge images as video</span></span><br><span class="line">ffmpeg -f image2 -i img%d.jpg video.mpg</span><br><span class="line"><span class="comment">### Or the opposite way</span></span><br><span class="line">ffmpeg -i video.mpg img%d.gif</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org8239a2c" class="outline-2"><h2 id="org8239a2c"><span class="section-number-2">3</span> split</h2><div class="outline-text-2" id="text-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Crop to 1080x1080</span></span><br><span class="line">ffmpeg -i input.mp4 strict -2 -vf crop=1080:1080:0:420 output.mp4</span><br><span class="line"><span class="comment">### Split with timestamp</span></span><br><span class="line">ffmpeg -i input.mp4 -vcodec copy -acodec copy -ss 0:12:34 -t 0:10:00 10.mins.split.mp4</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org316a1df" class="outline-2"><h2 id="org316a1df"><span class="section-number-2">4</span> convert</h2><div class="outline-text-2" id="text-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Scale 1080p to 480p</span></span><br><span class="line">ffmpeg -i input.mp4 -vf scale=853:480 -acodec aac -vcodec h264 output.mp4</span><br><span class="line"><span class="comment">### Convert avi to mp4</span></span><br><span class="line">ffmpeg -i input.avi -c:v h264 output.mp4</span><br><span class="line">ffmpeg -i input.avi -c:v libx264 -crf 24 output.mp4</span><br><span class="line"><span class="comment">### Convert between avi and mpg, gif</span></span><br><span class="line">ffmpeg -i video.avi video.mpg</span><br><span class="line">ffmpeg -i video.mpg video.avi</span><br><span class="line">ffmpeg -i video.avi anime.gif</span><br><span class="line"><span class="comment">### Extract audio from video</span></span><br><span class="line">ffmpeg -i video.avi -vn -ar 44100 -ac 2 -ab 192 -f mp3 sound.mp3</span><br><span class="line"><span class="comment">### Encapsulation video and audio files into mp4/mkv</span></span><br><span class="line">ffmpeg -i video.avi -i audio.aac -vcodec copy -acodec copy output.mp4</span><br></pre></td></tr></table></figure></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgccb5023&quot;&gt;1. About&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgab5a5cc&quot;&gt;2. concat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8239a2c&quot;&gt;3. split&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org316a1df&quot;&gt;4. convert&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="ffmpeg" scheme="https://angry-bird.github.io/tags/ffmpeg/"/>
    
  </entry>
  
  <entry>
    <title>odoo</title>
    <link href="https://angry-bird.github.io/2018/02/24/odoo/"/>
    <id>https://angry-bird.github.io/2018/02/24/odoo/</id>
    <published>2018-02-24T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org67910fb">1. Installing odoo CE11 on Ubuntu16.04</a></li><li><a href="#orgf7231a9">2. Configuration</a></li><li><a href="#org0fe2798">3. Modules/Addon</a></li><li><a href="#org9e212a7">4. API</a></li><li><a href="#org6101128">5. Issues</a></li></ul></div></div><a id="more"></a><p>odoo<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> is a suite of web based open source apps of Enterprise Resource Planning(ERP).</p><div id="outline-container-org67910fb" class="outline-2"><h2 id="org67910fb"><span class="section-number-2">1</span> Installing odoo CE11 on Ubuntu16.04</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-orgb14ec97" class="outline-3"><h3 id="orgb14ec97"><span class="section-number-3">1.1</span> Prepare</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> sudo adduser -m -g sudo -s /bin/bash odoo</span><br><span class="line"> sudo passwd odoo</span><br><span class="line"> sudo vi /etc/sudoers</span><br><span class="line"> <span class="comment">### Add odoo to sudoer group.</span></span><br><span class="line"> <span class="comment">### Then change root to odoo.</span></span><br><span class="line"> su odoo</span><br><span class="line"></span><br><span class="line"> sudo apt-get update &amp;&amp; sudo apt-get upgrade</span><br><span class="line"> sudo apt-get install -y wget git zsh postgresql npm python3-pip</span><br><span class="line"> sudo ln -s /usr/bin/nodejs /usr/bin/node</span><br><span class="line"> sudo npm install -g less</span><br><span class="line"> sudo pip3 install Babel decorator docutils ebaysdk feedparser gevent greenlet html2text Jinja2 lxml Mako MarkupSafe mock num2words ofxparse passlib Pillow psutil psycogreen psycopg2 pydot pyparsing PyPDF2 pyserial python-dateutil python-openid pytz pyusb PyYAML qrcode reportlab requests six suds-jurko vatnumber vobject Werkzeug XlsxWriter xlwt xlrd</span><br><span class="line"></span><br><span class="line">wget http://download.gna.org/wkhtmltopdf/0.12/0.12.3/wkhtmltox-0.12.3_linux-generic-amd64.tar.xz /opt/</span><br><span class="line">tar -xJf wkhtmlox-0.12.3_linux-generic-amd64.tar.xz</span><br><span class="line">sudo chown root:root /opt/wkhtmltopdf</span><br><span class="line">sudo chmod +x /opt/wkhtmltopdf</span><br><span class="line">sudo ln -s /opt/wkhtmltopdf /usr/<span class="built_in">local</span>/bin/wkhtmltopdf</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orga4b8774" class="outline-3"><h3 id="orga4b8774"><span class="section-number-3">1.2</span> Odoo</h3><div class="outline-text-3" id="text-1-2"></div><div id="outline-container-org3ac7fa5" class="outline-4"><h4 id="org3ac7fa5">from nightly</h4><div class="outline-text-4" id="text-org3ac7fa5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -O - https://nightly.odoo.com/odoo.key | sudo apt-key add -</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb http://nightly.odoo.com/11.0/nightly/deb/ ./&quot;</span> &gt;&gt; odoo.list</span><br><span class="line">sudo mv odoo.list /etc/apt/sources.list.d/</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install odoo</span><br></pre></td></tr></table></figure></div><p>If it returns error with chown /var/odoo, just mkdir of this repository.</p></div></div><div id="outline-container-org1cb822c" class="outline-4"><h4 id="org1cb822c">from github source code</h4><div class="outline-text-4" id="text-org1cb822c"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/odoo/odoo.git odoo11 -b 11.0 --depth=1</span><br><span class="line">sudo chown -R odoo:odoo odoo11</span><br><span class="line"><span class="built_in">cd</span> odoo11</span><br><span class="line">./odoo-bin -s</span><br><span class="line">ps aux | grep odoo</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="outline-container-orgf7231a9" class="outline-2"><h2 id="orgf7231a9"><span class="section-number-2">2</span> Configuration</h2><div class="outline-text-2" id="text-2"><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sudo vi /etc/odoo/odoo.conf</span></span><br><span class="line"><span class="comment">### Custom addons path</span></span><br><span class="line"><span class="attr">addons_path</span> = /usr/lib/python3/dist-packages/odoo/addons/,/home/odoo/addons</span><br><span class="line"><span class="comment">### Custom http port</span></span><br><span class="line"><span class="attr">http_port</span> = <span class="number">8089</span></span><br></pre></td></tr></table></figure></div></div><div id="outline-container-org40a9e30" class="outline-3"><h3 id="org40a9e30"><span class="section-number-3">2.1</span> nginx reverse proxy<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></h3><div class="outline-text-3" id="text-2-1"></div><div id="outline-container-org4443de9" class="outline-4"><h4 id="org4443de9">https 443</h4><div class="outline-text-4" id="text-org4443de9"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br><span class="line"><span class="comment">### Remove nginx&apos;s default config of port 80, or just change 80 to 8080 in this file</span></span><br><span class="line">sudo rm /etc/nginx/sites-avaliable/default</span><br><span class="line">sudo vim /etc/nginx/sites-avalibale/odoo.conf</span><br><span class="line"><span class="comment"># openssl req -x509 -days 3650 -subj &apos;/CN=your.domain/&apos; -nodes -newkey rsa:2048 -keyout server.key -out server.crt</span></span><br><span class="line">openssl req -x509 -days 3650 -nodes -newkey rsa:2048 -keyout server.key -out server.crt</span><br><span class="line">sudo mkdir /etc/ssl/nginx</span><br><span class="line">sudo mv server.crt server.key /etc/ssl/nginx</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight"><table><tr><td class="code"><pre><span class="line">server {</span><br><span class="line">    listen      443 default;</span><br><span class="line">    server_name odoo11s;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/odoo.access.log;</span><br><span class="line">    error_log  /var/log/nginx/odoo.error.log;</span><br><span class="line"></span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate     /etc/ssl/nginx/server.crt;</span><br><span class="line">    ssl_certificate_key /etc/ssl/nginx/server.key;</span><br><span class="line">    ssl_ciphers             HIGH:!ADH:!MD5;</span><br><span class="line">    ssl_protocols           SSLv3 TLSv1;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    location / {</span><br><span class="line">        proxy_pass http://127.0.0.1:8089;</span><br><span class="line">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line"></span><br><span class="line">        proxy_buffer_size 128k;</span><br><span class="line">        proxy_buffers 16 64k;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line"></span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">   location ~* /web/static/ {</span><br><span class="line">        proxy_cache_valid 200 60m;</span><br><span class="line">        proxy_buffering    on;</span><br><span class="line">        expires 864000;</span><br><span class="line">        proxy_pass http://127.0.0.1:8089;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># port proxy 80 to 443</span></span><br><span class="line">server {</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name odoo11s;</span><br><span class="line"></span><br><span class="line">    add_header Strict-Transport-Security max-age=2592000;</span><br><span class="line">    rewrite ^/.*$ https://$host$request_uri? permanent;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgca25a6b" class="outline-4"><h4 id="orgca25a6b">http port 8089 to http 80<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup></h4><div class="outline-text-4" id="text-orgca25a6b"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo rm /etc/nginx/sites-enabled/default</span><br><span class="line"><span class="comment">### Paste following area codes to this file.</span></span><br><span class="line">sudo vim /etc/nginx/sites-available/odoo</span><br><span class="line"><span class="comment"># sudo ln -s /etc/nginx/sites-available/odoo /etc/nginx/sites-enabled/odoo</span></span><br><span class="line"><span class="comment">### Test nginx&apos;s new config</span></span><br><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight"><table><tr><td class="code"><pre><span class="line">upstream odoo {</span><br><span class="line">    server 127.0.0.1:8089;</span><br><span class="line">}</span><br><span class="line">server {</span><br><span class="line">    listen      80 default;</span><br><span class="line">    server_name odoo11;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># log files</span></span><br><span class="line">    access_log  /var/log/nginx/odoo.access.log;</span><br><span class="line">    error_log   /var/log/nginx/odoo.error.log;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># proxy buffers</span></span><br><span class="line">    proxy_buffers 16 64k;</span><br><span class="line">    proxy_buffer_size 128k;</span><br><span class="line">    proxy_read_timeout 600s;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## default location</span></span><br><span class="line">    location / {</span><br><span class="line">        proxy_pass http://0.0.0.0:8089;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># force timeouts if the backend dies</span></span><br><span class="line">        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># set headers</span></span><br><span class="line">        proxy_set_header    Host            $host;</span><br><span class="line">        proxy_set_header    X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header    X-Forwarded-Proto https;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment"># cache some static data in memory for 60mins</span></span><br><span class="line">    location ~* /web/static/ {</span><br><span class="line">        proxy_cache_valid 60m;</span><br><span class="line">        proxy_buffering on;</span><br><span class="line">        expires 864000;</span><br><span class="line">        proxy_pass http://0.0.0.0:8089;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div><p>Restrict uploading file size.</p><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sudo /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="comment">### Add this in http area</span></span><br><span class="line">client_max_body_size 100m;</span><br><span class="line"><span class="comment"># sudo /etc/init.d/nginx reload</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org5d89aa3" class="outline-3"><h3 id="org5d89aa3"><span class="section-number-3">2.2</span> git clone</h3><div class="outline-text-3" id="text-2-2"><p>If your odoo server is running on cloud server, work with git between local and cloud.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Cloud</span></span><br><span class="line">sudo adduser git -g git</span><br><span class="line">sudo passwd git</span><br><span class="line">sudo vim /etc/passwd</span><br><span class="line"><span class="comment">## git:x:1001:1001:git,,,:/home/git:/usr/bin/git-shell</span></span><br><span class="line">sudo mkdir -p /home/git/.ssh</span><br><span class="line">sudo vim /home/git/.ssh/authorized_keys</span><br><span class="line">sudo mkdir -p /var/git</span><br><span class="line">sudo chown -R git:git /var/git</span><br><span class="line">sudo chmod 777 /var/git</span><br><span class="line"><span class="built_in">cd</span> /var/git</span><br><span class="line">git init --bare odoo11.git</span><br><span class="line">sudo chown -R git:git /var/git</span><br><span class="line"><span class="comment">### Local</span></span><br><span class="line">git pull git@111.230.172.145:/var/git/odoo-dev/odoo11.git</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org0fe2798" class="outline-2"><h2 id="org0fe2798"><span class="section-number-2">3</span> Modules/Addon</h2><div class="outline-text-2" id="text-3"></div><div id="outline-container-org52133cd" class="outline-3"><h3 id="org52133cd"><span class="section-number-3">3.1</span> web responsive</h3><div class="outline-text-3" id="text-3-1"><p>Pages adapted to mobile/pad screensize.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -O web_responsive.zip <span class="string">&quot;https://apps.odoo.com/loempia/download/web_responsive/11.0.1.0.2/2M0BvhXUoNhxY3BrtIRd1Q.zip?deps&quot;</span></span><br><span class="line"><span class="comment"># wget -O web_responsive.zip https://apps.odoo.com/loempia/download/web_responsive/11.0.1.0.2/2M0BvhXUoNhxY3BrtIRd1Q.zip?deps</span></span><br><span class="line"><span class="comment"># curl -o web_responsive.zip https://apps.odoo.com/loempia/download/web_responsive/11.0.1.0.2/2M0BvhXUoNhxY3BrtIRd1Q.zip?deps</span></span><br><span class="line">unzip web_responsive.zip -d /home/odoo/addons/</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgfeef715" class="outline-3"><h3 id="orgfeef715"><span class="section-number-3">3.2</span> chinese</h3><div class="outline-text-3" id="text-3-2"><p>Reload all module language.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget -O base_translation_name.zip <span class="string">&quot;https://apps.odoo.com/loempia/download/base_translation_module_name_reload/11.0.1.0/7mu1fkVg7RMJyfTk1HQiBF.zip?deps&quot;</span></span><br><span class="line">sudo unzip base_translation_name.zip -d /home/odoo/addons/</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org9e212a7" class="outline-2"><h2 id="org9e212a7"><span class="section-number-2">4</span> API</h2><div class="outline-text-2" id="text-4"><p>REST or XML-RPC</p><ol class="org-ol"><li>Developer<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup></li><li>odoouse<sup><a id="fnr.5" class="footref" href="#fn.5">5</a></sup></li><li>odoomobile<sup><a id="fnr.6" class="footref" href="#fn.6">6</a></sup></li><li>odoo community association<sup><a id="fnr.7" class="footref" href="#fn.7">7</a></sup></li></ol></div></div><div id="outline-container-org6101128" class="outline-2"><h2 id="org6101128"><span class="section-number-2">5</span> Issues</h2><div class="outline-text-2" id="text-5"></div><div id="outline-container-org0a1d821" class="outline-3"><h3 id="org0a1d821"><span class="section-number-3">5.1</span> Deny ssh users/groups</h3><div class="outline-text-3" id="text-5-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sudo vim /etc/ssh/sshd_config</span></span><br><span class="line"><span class="comment">## DenyGroups git</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div id="text-footnotes"><div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/odoo/odoo" target="_blank" rel="noopener">https://github.com/odoo/odoo</a></p></div></div><div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara"><a href="http://blog.csdn.net/J_z10/article/details/51959067" target="_blank" rel="noopener">http://blog.csdn.net/J_z10/article/details/51959067</a></p></div></div><div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara"><a href="http://blog.csdn.net/cmzhuang/article/details/53766040" target="_blank" rel="noopener">http://blog.csdn.net/cmzhuang/article/details/53766040</a></p></div></div><div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara"><a href="https://renjie.me/" target="_blank" rel="noopener">https://renjie.me/</a></p></div></div><div class="footdef"><sup><a id="fn.5" class="footnum" href="#fnr.5">5</a></sup> <div class="footpara"><p class="footpara"><a href="http://www.cnblogs.com/odoouse/p/4690390.html" target="_blank" rel="noopener">http://www.cnblogs.com/odoouse/p/4690390.html</a></p></div></div><div class="footdef"><sup><a id="fn.6" class="footnum" href="#fnr.6">6</a></sup> <div class="footpara"><p class="footpara"><a href="http://0.0.0.0:8089-mobile-doc-v2.readthedocs.io/en/latest/about/about.html" target="_blank" rel="noopener">http://0.0.0.0:8089-mobile-doc-v2.readthedocs.io/en/latest/about/about.html</a></p></div></div><div class="footdef"><sup><a id="fn.7" class="footnum" href="#fnr.7">7</a></sup> <div class="footpara"><p class="footpara"><a href="https://github.com/OCA" target="_blank" rel="noopener">https://github.com/OCA</a></p></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org67910fb&quot;&gt;1. Installing odoo CE11 on Ubuntu16.04&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf7231a9&quot;&gt;2. Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org0fe2798&quot;&gt;3. Modules/Addon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org9e212a7&quot;&gt;4. API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org6101128&quot;&gt;5. Issues&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="odoo" scheme="https://angry-bird.github.io/categories/odoo/"/>
    
    
      <category term="odoo" scheme="https://angry-bird.github.io/tags/odoo/"/>
    
  </entry>
  
  <entry>
    <title>vsftp</title>
    <link href="https://angry-bird.github.io/2018/02/09/vsftp/"/>
    <id>https://angry-bird.github.io/2018/02/09/vsftp/</id>
    <published>2018-02-09T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org43bcc20">1. Demo</a></li><li><a href="#orgc166f93">2. Details</a><ul><li><a href="#org5e0fe73">2.1. Add user group for vsftpd</a></li><li><a href="#org8ccf099">2.2. Add users to ftp group</a></li><li><a href="#org4a312c3">2.3. Install vsftpd</a></li><li><a href="#orgf872f98">2.4. Config vsftpd</a></li><li><a href="#orga54dc29">2.5. Run vsftpd</a></li></ul></li><li><a href="#orgee94cd7">3. Issues</a><ul><li><a href="#orgbda45fc">3.1. 530</a></li><li><a href="#orgda708ef">3.2. 500</a></li></ul></li></ul></div></div><a id="more"></a><div id="outline-container-org43bcc20" class="outline-2"><h2 id="org43bcc20"><span class="section-number-2">1</span> Demo</h2><div class="outline-text-2" id="text-1"><p>Scenario of a super user(full access to all folders) and multi normal users(only their own folders).</p><ol class="org-ol"><li><p>Add group <b>gftp</b> for all ftp users;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd gftp</span><br></pre></td></tr></table></figure></div></li><li><p>Set super user&apos;s home directory as <span class="underline">/srv/ftp/echo</span>;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir /srv/ftp/<span class="built_in">echo</span></span><br><span class="line">chown <span class="built_in">echo</span>:gftp /srv/ftp/<span class="built_in">echo</span> -R</span><br><span class="line">useradd -d /srv/ftp/<span class="built_in">echo</span> -g gftp <span class="built_in">echo</span></span><br><span class="line">passwd <span class="built_in">echo</span></span><br></pre></td></tr></table></figure></div></li><li><p>Set all normal users&apos; home to subdirectory like <span class="underline">/srv/ftp/echo/demo</span>;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir /srv/ftp/<span class="built_in">echo</span>/demo</span><br><span class="line">chown demo:gftp /srv/ftp/<span class="built_in">echo</span>/demo -R</span><br><span class="line">useradd -d /srv/ftp/<span class="built_in">echo</span>/demo -g gftp demo</span><br><span class="line">passwd demo</span><br></pre></td></tr></table></figure></div></li><li><p>Set all normal users&apos; home directory to be accessed by group <b>gftp</b> by <code>chmod</code>;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod g+rw /srv/ftp/<span class="built_in">echo</span>/demo -R</span><br></pre></td></tr></table></figure></div></li><li>Add <code>allow_writeable_chroot=YES</code> and <code>chroot_local_user=YES</code> in  <span class="underline">/etc/vsftpd.conf</span></li></ol></div></div><div id="outline-container-orgc166f93" class="outline-2"><h2 id="orgc166f93"><span class="section-number-2">2</span> Details</h2><div class="outline-text-2" id="text-2"></div><div id="outline-container-org5e0fe73" class="outline-3"><h3 id="org5e0fe73"><span class="section-number-3">2.1</span> Add user group for vsftpd</h3><div class="outline-text-3" id="text-2-1"><p>Setting a group for ftp, and ftp users are add to this group. This will be more appropriate for security and privacy.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd gftp</span><br><span class="line"><span class="comment"># groups</span></span><br><span class="line"><span class="comment"># newgrp</span></span><br><span class="line"><span class="comment"># groupdel</span></span><br><span class="line"><span class="comment"># groupmod</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org8ccf099" class="outline-3"><h3 id="org8ccf099"><span class="section-number-3">2.2</span> Add users to ftp group</h3><div class="outline-text-3" id="text-2-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir /srv/ftp/<span class="built_in">echo</span></span><br><span class="line">chown <span class="built_in">echo</span>:gftp /srv/ftp/<span class="built_in">echo</span> -R</span><br><span class="line">useradd -d /srv/ftp/<span class="built_in">echo</span> -g gftp <span class="built_in">echo</span></span><br><span class="line">passwd <span class="built_in">echo</span></span><br><span class="line"><span class="comment">### Another User that sharing all files with OTHER GROUP USERS.</span></span><br><span class="line">mkdir /srv/ftp/<span class="built_in">echo</span>/demo</span><br><span class="line">useradd -d /srv/ftp/<span class="built_in">echo</span>/demo -g gftp demo</span><br><span class="line"><span class="comment">### Group own this folder, that means demo is the least privilege user.</span></span><br><span class="line">chown demo:gftp /srv/ftp/<span class="built_in">echo</span>/demo -R</span><br><span class="line">chmod g+rw /srv/ftp/<span class="built_in">echo</span>/demo -R</span><br><span class="line">passwd demo</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org4a312c3" class="outline-3"><h3 id="org4a312c3"><span class="section-number-3">2.3</span> Install vsftpd</h3><div class="outline-text-3" id="text-2-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install vsftpd</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf872f98" class="outline-3"><h3 id="orgf872f98"><span class="section-number-3">2.4</span> Config vsftpd</h3><div class="outline-text-3" id="text-2-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/vsftpd.conf</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">NO</span></span><br><span class="line"><span class="attr">write_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">utf8_filesystem</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">### Restrict user to their own/local root directory, without access to upper folders.</span></span><br><span class="line"><span class="comment">### And this config may cause 500 ERROR.</span></span><br><span class="line"><span class="attr">chroot_local_user</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment">### If you want to specify users having access to other folders exclusively,</span></span><br><span class="line"><span class="comment">### then users in ~chroot_list_file~ are exceptions with ~chroot_local_user~ being ~YES~.</span></span><br><span class="line"><span class="attr">chroot_list_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">chroot_list_file</span>=/etc/vsftpd/chroot_list</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orga54dc29" class="outline-3"><h3 id="orga54dc29"><span class="section-number-3">2.5</span> Run vsftpd</h3><div class="outline-text-3" id="text-2-5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service vsftpd start</span><br><span class="line">service vsftpd stop</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ftp localhost</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orgee94cd7" class="outline-2"><h2 id="orgee94cd7"><span class="section-number-2">3</span> Issues</h2><div class="outline-text-2" id="text-3"></div><div id="outline-container-orgbda45fc" class="outline-3"><h3 id="orgbda45fc"><span class="section-number-3">3.1</span> 530</h3><div class="outline-text-3" id="text-3-1"><p>Comment the last line of this file.</p><div class="org-src-container"><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /etc/pam.d/vsftpd</span></span><br><span class="line">auth required  pam_shells.so</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgda708ef" class="outline-3"><h3 id="orgda708ef"><span class="section-number-3">3.2</span> 500</h3><div class="outline-text-3" id="text-3-2"><pre class="example">500 OOPS: vsftpd: refusing to run with writable root inside chroot()</pre><div class="org-src-container"><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># For old versions</span></span><br><span class="line"><span class="attr">allow_writeable_chroot</span>=<span class="literal">YES</span></span><br><span class="line"><span class="comment"># For extended vsftp</span></span><br><span class="line"><span class="attr">allow_writable_chroot</span>=<span class="literal">YES</span></span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org43bcc20&quot;&gt;1. Demo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc166f93&quot;&gt;2. Details&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org5e0fe73&quot;&gt;2.1. Add user group for vsftpd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8ccf099&quot;&gt;2.2. Add users to ftp group&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org4a312c3&quot;&gt;2.3. Install vsftpd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf872f98&quot;&gt;2.4. Config vsftpd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orga54dc29&quot;&gt;2.5. Run vsftpd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgee94cd7&quot;&gt;3. Issues&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgbda45fc&quot;&gt;3.1. 530&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgda708ef&quot;&gt;3.2. 500&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="ftp" scheme="https://angry-bird.github.io/tags/ftp/"/>
    
  </entry>
  
  <entry>
    <title>Linux shell commands 104</title>
    <link href="https://angry-bird.github.io/2017/10/31/Linux-shell-commands-104/"/>
    <id>https://angry-bird.github.io/2017/10/31/Linux-shell-commands-104/</id>
    <published>2017-10-31T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org289e6c0">1. regular expression</a><ul><li><a href="#org9213422">1.1. &#x57FA;&#x7840;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</a></li><li><a href="#org4d2623a">1.2. POSIX &#x5B57;&#x7B26;&#x96C6;</a></li><li><a href="#org41588bb">1.3. Perl-style</a></li></ul></li><li><a href="#org50330bd">2. grep</a></li><li><a href="#org7d90cd9">3. cut &amp; concatenate</a></li><li><a href="#org7c003c2">4. sed</a></li><li><a href="#org66a2636">5. awk</a></li><li><a href="#org2953e5d">6. Misc</a><ul><li><a href="#org5cbc081">6.1. Parsing email address or url from text</a></li><li><a href="#orgc1659f6">6.2. delete a sentence containing a word</a></li></ul></li></ul></div></div><a id="more"></a><p>Chapter 4 About Text Edit</p><div id="outline-container-org289e6c0" class="outline-2"><h2 id="org289e6c0"><span class="section-number-2">1</span> regular expression</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-org9213422" class="outline-3"><h3 id="org9213422"><span class="section-number-3">1.1</span> &#x57FA;&#x7840;&#x7684;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</h3><div class="outline-text-3" id="text-1-1"><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"><colgroup><col class="org-left"><col class="org-left"></colgroup><thead><tr><th scope="col" class="org-left">regex</th><th scope="col" class="org-left">Desription</th></tr></thead><tbody><tr><td class="org-left">^</td><td class="org-left">start of line</td></tr><tr><td class="org-left">$</td><td class="org-left">end of line</td></tr><tr><td class="org-left">.</td><td class="org-left">matches any one character</td></tr><tr><td class="org-left">[]</td><td class="org-left">matches any one char in [chars]</td></tr><tr><td class="org-left">[^]</td><td class="org-left">matches any one char EXCEPT in [chars]</td></tr><tr><td class="org-left">[-]</td><td class="org-left">matches any char within range [chars]</td></tr><tr><td class="org-left">?</td><td class="org-left">matches one or zero times</td></tr><tr><td class="org-left">+</td><td class="org-left">matches one or more times</td></tr><tr><td class="org-left">*</td><td class="org-left">matches zero or more times</td></tr><tr><td class="org-left">()</td><td class="org-left">substring as one item to match</td></tr><tr><td class="org-left">{n}</td><td class="org-left">match n times</td></tr><tr><td class="org-left">{n,}</td><td class="org-left">match at least n times</td></tr><tr><td class="org-left">{n, m}</td><td class="org-left">match n to m times</td></tr><tr><td class="org-left">|</td><td class="org-left">alternation, OR</td></tr><tr><td class="org-left">\</td><td class="org-left">escape</td></tr></tbody></table></div></div><div id="outline-container-org4d2623a" class="outline-3"><h3 id="org4d2623a"><span class="section-number-3">1.2</span> POSIX &#x5B57;&#x7B26;&#x96C6;</h3><div class="outline-text-3" id="text-1-2"><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"><colgroup><col class="org-left"><col class="org-left"></colgroup><thead><tr><th scope="col" class="org-left">regex</th><th scope="col" class="org-left">Desription</th></tr></thead><tbody><tr><td class="org-left">[:alpha:]</td><td class="org-left">alphabet</td></tr><tr><td class="org-left">[:digit:]</td><td class="org-left">digit</td></tr><tr><td class="org-left">[:alnum:]</td><td class="org-left">alp &amp; number</td></tr><tr><td class="org-left">[:lower:]</td><td class="org-left">lowercase</td></tr><tr><td class="org-left">[:upper:]</td><td class="org-left">uppercase</td></tr><tr><td class="org-left">[:punct:]</td><td class="org-left">punctuation</td></tr><tr><td class="org-left">[:blank:]</td><td class="org-left">space &amp; tab</td></tr><tr><td class="org-left">[:space:]</td><td class="org-left">whitespace</td></tr></tbody></table></div></div><div id="outline-container-org41588bb" class="outline-3"><h3 id="org41588bb"><span class="section-number-3">1.3</span> Perl-style</h3><div class="outline-text-3" id="text-1-3"><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"><colgroup><col class="org-left"><col class="org-left"></colgroup><thead><tr><th scope="col" class="org-left">regex</th><th scope="col" class="org-left">Desription</th></tr></thead><tbody><tr><td class="org-left">\b</td><td class="org-left">word boundary</td></tr><tr><td class="org-left">\B</td><td class="org-left">non-word boundary</td></tr><tr><td class="org-left">\d</td><td class="org-left">single digit</td></tr><tr><td class="org-left">\D</td><td class="org-left">single non-digit</td></tr><tr><td class="org-left">\w</td><td class="org-left">single word</td></tr><tr><td class="org-left">\W</td><td class="org-left">single non-word</td></tr><tr><td class="org-left">\n</td><td class="org-left">newline</td></tr><tr><td class="org-left">\s</td><td class="org-left">single whitespace</td></tr><tr><td class="org-left">&#xA7;</td><td class="org-left">single non-space</td></tr><tr><td class="org-left">\r</td><td class="org-left">return</td></tr></tbody></table><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># IP address</span></span><br><span class="line">[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}</span><br><span class="line">[[:digit:]]{1,3}\.[[:digit:]]{1,3}\.[[:digit:]]{1,3}\.[[:digit:]]{1,3}</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org50330bd" class="outline-2"><h2 id="org50330bd"><span class="section-number-2">2</span> grep</h2><div class="outline-text-2" id="text-2"><p>The master unix utility for searching in the text.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep PATTERN FILE</span><br><span class="line"><span class="comment"># Extented regular expression</span></span><br><span class="line">grep -E PATTERN</span><br><span class="line">egrep PATTERN</span><br><span class="line"><span class="comment"># Only matched portion</span></span><br><span class="line">grep -o -E PATTERN</span><br><span class="line"><span class="comment"># Except lines containing PATTERN</span></span><br><span class="line">grep -v PATTERN FILE</span><br><span class="line"><span class="comment"># Count number of lines</span></span><br><span class="line">grep -c PATTERN FILE</span><br><span class="line"><span class="comment"># Recursively</span></span><br><span class="line">grep -R -n DIRE</span><br><span class="line"><span class="comment"># Byte Offset</span></span><br><span class="line">grep -b -o PATTERN FILE</span><br><span class="line"><span class="comment"># Locate matched pattern</span></span><br><span class="line">grep -l PATTERN FILE</span><br><span class="line"><span class="comment"># Locate non-matched files</span></span><br><span class="line">grep -L PATTERN FILE</span><br><span class="line"><span class="comment"># Ignore case of pattern</span></span><br><span class="line">grep -i PATTERN FILE</span><br><span class="line"><span class="comment"># Multi patterns</span></span><br><span class="line">grep -e PATTERN1 -e PATTERN2 FILE</span><br><span class="line"><span class="comment"># Print 4 lines After matched pattern</span></span><br><span class="line">grep PATTERN -A 4</span><br><span class="line"><span class="comment"># Print 4 lines Before matched pattern</span></span><br><span class="line">grep PATTERN -B 4</span><br><span class="line"><span class="comment"># Print 4 lines that matched pattern as Center</span></span><br><span class="line">grep PATTERN -C 4</span><br><span class="line"><span class="comment"># include &amp; exclude</span></span><br><span class="line">grep PATTERN DIRE -r --include *.{c,cpp}</span><br><span class="line">grep PATTERN DIRE -r --exclude <span class="string">&quot;readme&quot;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org7d90cd9" class="outline-2"><h2 id="org7d90cd9"><span class="section-number-2">3</span> cut &amp; concatenate</h2><div class="outline-text-2" id="text-3"><p>Column-wise cutting of a file</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Field 2 in file</span></span><br><span class="line">cut -f2 FIELD FILE</span><br><span class="line"><span class="comment"># Bytes 1st to 5th</span></span><br><span class="line">cut -b1-5 BYTE FILE</span><br><span class="line"><span class="comment"># Character since 3rd</span></span><br><span class="line">cut -c3- CHAR FILE</span><br><span class="line"><span class="comment"># Delimiter</span></span><br><span class="line">cut FILE -c1-3,5- --output-delimiter <span class="string">&quot;,&quot;</span></span><br></pre></td></tr></table></figure></div><p>Column-wise concatenate of files</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">paste FILE1 FILE2</span><br><span class="line"><span class="comment"># Delimiter</span></span><br><span class="line">paste FILE1 FILE2 -d <span class="string">&apos;,&apos;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org7c003c2" class="outline-2"><h2 id="org7c003c2"><span class="section-number-2">4</span> sed</h2><div class="outline-text-2" id="text-4"><p>Stream editor</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># First occurrence of pattern in each line</span></span><br><span class="line">sed <span class="string">&apos;s/PATTERN/REPLACE/&apos;</span> FILE</span><br><span class="line"><span class="comment"># Write changes Into file</span></span><br><span class="line">sed -i <span class="string">&apos;s/PATTERN/REPLACE/&apos;</span> FILE</span><br><span class="line"><span class="comment"># Global replace</span></span><br><span class="line">sed <span class="string">&apos;s/PATTERN/REPLACE/g&apos;</span> FILE</span><br><span class="line">sed <span class="string">&apos;s:PATTERN:REPLACE:g&apos;</span> FILE</span><br><span class="line">sed <span class="string">&apos;s|PATTERN|REPLACE|g&apos;</span> FILE</span><br><span class="line"><span class="comment"># Global replace since N+1th occurrence</span></span><br><span class="line">sed <span class="string">&apos;s/PATTERN/REPLACE/2g&apos;</span> FILE</span><br><span class="line"><span class="comment"># Delete blank lines</span></span><br><span class="line">sed <span class="string">&apos;/^$/d&apos;</span> FILE</span><br><span class="line"><span class="comment"># Delete line</span></span><br><span class="line">sed <span class="string">&apos;/PATTERN/d&apos;</span> FILE</span><br><span class="line"><span class="comment"># Matched string notation &amp; -- \w\+</span></span><br><span class="line">sed <span class="string">&apos;s/\w\+/[&amp;]/g&apos;</span> FILE</span><br><span class="line"><span class="comment"># Matched substring notation \1 -- \(PATTERN\)</span></span><br><span class="line">sed <span class="string">&apos;s/STRING\(PATTERN\)/\1/&apos;</span></span><br><span class="line"><span class="comment"># Multiple expressions</span></span><br><span class="line">sed <span class="string">&apos;exp&apos;</span> | sed <span class="string">&apos;exp&apos;</span></span><br><span class="line">sed <span class="string">&apos;exp; exp&apos;</span></span><br><span class="line"><span class="comment"># Quoting</span></span><br><span class="line">sed <span class="string">&quot;s/<span class="variable">$VAR</span>/REPLACE/&quot;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org66a2636" class="outline-2"><h2 id="org66a2636"><span class="section-number-2">5</span> awk</h2><div class="outline-text-2" id="text-5"><p>Data streams</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">awk <span class="string">&apos;BEGIN {statements} {statements} END {end statements}&apos;</span></span><br><span class="line">awk <span class="string">&quot;BEGIN {statements} {statements} END {end statements}&quot;</span></span><br><span class="line"><span class="comment"># Print 3rd &amp; 2nd field of every line</span></span><br><span class="line">awk <span class="string">&apos;{ print $3, $2 }&apos;</span> FILE</span><br><span class="line"><span class="comment"># Count number of lines, NR -- records, NF -- fields</span></span><br><span class="line">awk <span class="string">&apos;END{ print NR}&apos;</span> FILE</span><br><span class="line"><span class="comment"># Variable passed from outside to awk</span></span><br><span class="line">awk -v VARI=<span class="variable">$VAR</span> <span class="string">&apos;{print VARI}&apos;</span></span><br><span class="line">awk <span class="string">&apos;{print v1, v2}&apos;</span> v1=<span class="variable">$var1</span> v2=<span class="variable">$var2</span> FILE</span><br><span class="line"><span class="comment"># Filtering lines</span></span><br><span class="line">awk <span class="string">&apos;/START_PATTERN/, /END_PATTERN/&apos;</span> FILE</span><br><span class="line">awk <span class="string">&apos;NR==1,NR==4&apos;</span> FILE</span><br><span class="line">awk <span class="string">&apos;NR &lt; 5&apos;</span> FILE</span><br><span class="line">awk <span class="string">&apos;!/linux/&apos;</span> FILE</span><br><span class="line"><span class="comment"># Setting delimiter</span></span><br><span class="line">awk -F: <span class="string">&apos;{ print $NF }&apos;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&apos;BEGIN { FS=&quot;:&quot; } { print $NF }&apos;</span> /etc/passwd</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org2953e5d" class="outline-2"><h2 id="org2953e5d"><span class="section-number-2">6</span> Misc</h2><div class="outline-text-2" id="text-6"></div><div id="outline-container-org5cbc081" class="outline-3"><h3 id="org5cbc081"><span class="section-number-3">6.1</span> Parsing email address or url from text</h3><div class="outline-text-3" id="text-6-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">egrep -o <span class="string">&apos;[A-Za-z0-9]+@[A-Za-z0-9]+\.[a-zA-Z]{2,4}&apos;</span> FILE</span><br><span class="line">egrep -o <span class="string">&quot;http://[A-Za-z0-9]+\.[a-zA-Z]{2,3}&quot;</span> FILE</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgc1659f6" class="outline-3"><h3 id="orgc1659f6"><span class="section-number-3">6.2</span> delete a sentence containing a word</h3><div class="outline-text-3" id="text-6-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># [^.]* -- any char except ., and comb of it any times</span></span><br><span class="line">sed <span class="string">&apos;s/ [^.]*PATTERN[^.]*\.//g&apos;</span> FILE</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org289e6c0&quot;&gt;1. regular expression&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org9213422&quot;&gt;1.1. &amp;#x57FA;&amp;#x7840;&amp;#x7684;&amp;#x6B63;&amp;#x5219;&amp;#x8868;&amp;#x8FBE;&amp;#x5F0F;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org4d2623a&quot;&gt;1.2. POSIX &amp;#x5B57;&amp;#x7B26;&amp;#x96C6;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org41588bb&quot;&gt;1.3. Perl-style&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org50330bd&quot;&gt;2. grep&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org7d90cd9&quot;&gt;3. cut &amp;amp; concatenate&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org7c003c2&quot;&gt;4. sed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org66a2636&quot;&gt;5. awk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2953e5d&quot;&gt;6. Misc&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org5cbc081&quot;&gt;6.1. Parsing email address or url from text&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc1659f6&quot;&gt;6.2. delete a sentence containing a word&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="shell" scheme="https://angry-bird.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux shell commands 103</title>
    <link href="https://angry-bird.github.io/2017/10/30/Linux-shell-commands-103/"/>
    <id>https://angry-bird.github.io/2017/10/30/Linux-shell-commands-103/</id>
    <published>2017-10-30T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org80ad62f">1. Downloads utils</a><ul><li><a href="#orgd4dd55b">1.1. wget</a></li><li><a href="#orgac42a83">1.2. curl</a></li><li><a href="#org4066ced">1.3. others</a></li></ul></li></ul></div></div><a id="more"></a><p>Chapter 3 About Network</p><div id="outline-container-org80ad62f" class="outline-2"><h2 id="org80ad62f"><span class="section-number-2">1</span> Downloads utils</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-orgd4dd55b" class="outline-3"><h3 id="orgd4dd55b"><span class="section-number-3">1.1</span> wget</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget URL</span><br><span class="line">wget URL1 URL2</span><br><span class="line"><span class="comment"># Downloaded file name and print logs to file</span></span><br><span class="line">wget URL -O down.file -o down.log</span><br><span class="line"><span class="comment"># Try 5 times</span></span><br><span class="line">wget -t 5 URL</span><br><span class="line"><span class="comment"># Limit speed</span></span><br><span class="line">wget --<span class="built_in">limit</span>-rate 20k URL</span><br><span class="line"><span class="comment"># Quota of download</span></span><br><span class="line">wget -Q 100m URL</span><br><span class="line"><span class="comment"># Resume downloading and continue</span></span><br><span class="line">wget -c URL</span><br><span class="line"><span class="comment"># Authentication for HTTP FTP</span></span><br><span class="line">wget --user NAME --password PASS URL</span><br><span class="line"><span class="comment"># Copy webpage as formatted txt</span></span><br><span class="line">lynx -dump URL &gt; webpage.txt</span><br><span class="line"><span class="comment"># Copy a complete website</span></span><br><span class="line">wget --mirror URL</span><br><span class="line">wget -r -N -l DEPTH URL</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgac42a83" class="outline-3"><h3 id="orgac42a83"><span class="section-number-3">1.2</span> curl</h3><div class="outline-text-3" id="text-1-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># More powerful tool</span></span><br><span class="line">curl URL --slient</span><br><span class="line">curl URL &gt; index.html</span><br><span class="line"><span class="comment"># Write to file not ~stdout~</span></span><br><span class="line">curl URL --slient -O</span><br><span class="line">curl URL --slient -o NEW_FILE</span><br><span class="line"><span class="comment"># Progress bar</span></span><br><span class="line">curl URL --progress -o NEW_FILE</span><br><span class="line"><span class="comment"># Resume</span></span><br><span class="line">curl URL/file -C offset</span><br><span class="line"><span class="comment"># Cookies</span></span><br><span class="line">curl URL --cookie-jar cookie_file</span><br><span class="line"><span class="comment"># User agent</span></span><br><span class="line">curl URL --user-agent <span class="string">&quot;Mozilla/5.0&quot;</span></span><br><span class="line"><span class="comment"># Header</span></span><br><span class="line">curl -H <span class="string">&quot;Host: www.archlinux.org&quot;</span> -H <span class="string">&quot;Accept-language: en&quot;</span> URL</span><br><span class="line"><span class="comment"># Limit speed/bandwidth</span></span><br><span class="line">curl URL --<span class="built_in">limit</span>-rate 20k</span><br><span class="line"><span class="comment"># Quota of download</span></span><br><span class="line">curl URL --max-filesize bytes</span><br><span class="line"><span class="comment"># Authentication for HTTP FTP</span></span><br><span class="line">curl -u USER:PASS URL</span><br><span class="line">curl -u USER URL</span><br><span class="line"><span class="comment"># Dump only HTTP headers without downloading file</span></span><br><span class="line">curl -I URL</span><br><span class="line">curl -head URL</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org4066ced" class="outline-3"><h3 id="org4066ced"><span class="section-number-3">1.3</span> others</h3><div class="outline-text-3" id="text-1-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">axel URL --slient -o</span><br><span class="line">httpie URL</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org80ad62f&quot;&gt;1. Downloads utils&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgd4dd55b&quot;&gt;1.1. wget&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgac42a83&quot;&gt;1.2. curl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org4066ced&quot;&gt;1.3. others&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="shell" scheme="https://angry-bird.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux shell commands 102</title>
    <link href="https://angry-bird.github.io/2017/10/29/Linux-shell-commands-102/"/>
    <id>https://angry-bird.github.io/2017/10/29/Linux-shell-commands-102/</id>
    <published>2017-10-29T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orgeb5e672">1. file name</a><ul><li><a href="#org278d7e2">1.1. temp file</a></li><li><a href="#orgc321695">1.2. splitting file</a></li><li><a href="#orgac587ee">1.3. slicing filename</a></li></ul></li><li><a href="#orga61d72e">2. find</a><ul><li><a href="#org250762a">2.1. list all files with path</a></li><li><a href="#orgf39032a">2.2. search by name</a></li><li><a href="#org531eea3">2.3. search by attributes</a></li><li><a href="#org8018daf">2.4. operations</a></li></ul></li><li><a href="#org47a9af9">3. comparison</a><ul><li><a href="#orgedb82f7">3.1. math comparison</a></li><li><a href="#org914f854">3.2. logical comparison</a></li><li><a href="#org837a601">3.3. filesystem conditions</a></li><li><a href="#orgff5c079">3.4. string conditions / comparisons</a></li></ul></li><li><a href="#orga2abacf">4. input</a><ul><li><a href="#org4b1fc6d">4.1. read</a></li><li><a href="#org2d1b9d2">4.2. IFS</a></li><li><a href="#orge7d1dc5">4.3. xarg</a></li></ul></li><li><a href="#org2c22bf6">5. translate</a><ul><li><a href="#org2148e8d">5.1. &#x5C06;&#x8F93;&#x5165;&#x4E2D;&#x7684;&#x4E00;&#x7EC4;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x6210;&#x53E6;&#x4E00;&#x7EC4;&#x5B57;&#x7B26;&#x4E32;&#x3002;</a></li><li><a href="#org44dd795">5.2. &#x5220;&#x9664;&#x7279;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;</a></li><li><a href="#orgb14e9e7">5.3. &#x8865;&#x5145;&#x7279;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;</a></li><li><a href="#orgee854c3">5.4. &#x96C6;&#x5408;&#x5206;&#x7C7B;</a></li></ul></li><li><a href="#org96b18b6">6. sort</a></li><li><a href="#org0b70a17">7. diff</a></li><li><a href="#org93f09dc">8. head &amp; tail</a></li></ul></div></div><a id="more"></a><p>Chapter 2   &#x4ECB;&#x7ECD;&#x5173;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x547D;&#x540D;&#x3001;&#x6587;&#x4EF6;&#x5206;&#x5272;&#x3001;&#x6587;&#x4EF6;&#x67E5;&#x627E;&#x3001;&#x6587;&#x4EF6;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#x3001;&#x6587;&#x4EF6;&#x8F93;&#x5165;&#x3001;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x6392;&#x5E8F;&#x9664;&#x91CD;&#x3001;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5BF9;&#x6BD4;&#x3001;&#x6587;&#x4EF6;&#x9996;&#x5C3E;</p><div id="outline-container-orgeb5e672" class="outline-2"><h2 id="orgeb5e672"><span class="section-number-2">1</span> file name</h2><div class="outline-text-2" id="text-1"><p>&#x91CD;&#x547D;&#x540D;&#x6587;&#x4EF6;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rename *.jpg *.png</span><br><span class="line">rename <span class="string">&apos;s/ /_/g&apos;</span> *</span><br></pre></td></tr></table></figure></div><p>&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x547D;&#x540D;&#xFF0C;&#x5206;&#x5272;&#x6587;&#x4EF6;&#xFF0C;&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x540D;</p></div><div id="outline-container-org278d7e2" class="outline-3"><h3 id="org278d7e2"><span class="section-number-3">1.1</span> temp file</h3><div class="outline-text-3" id="text-1-1"><p>$(tempfile)$RANDOM$$ is PID of current script</p></div></div><div id="outline-container-orgc321695" class="outline-3"><h3 id="orgc321695"><span class="section-number-3">1.2</span> splitting file</h3><div class="outline-text-3" id="text-1-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># generate one test file of 100Kb</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/zero bs=100k count=1 of=data.file</span><br><span class="line">split -b 10k data.file</span><br><span class="line"><span class="comment"># -d numeric suffixes, -a suffix length</span></span><br><span class="line">split -b 10k data.file -d -a 3</span><br><span class="line"><span class="comment"># prefix filename for split files</span></span><br><span class="line">split -b 10k data.file -d -a 3 sfile</span><br><span class="line"><span class="comment"># 10 lines in each split</span></span><br><span class="line">split -l 10 data.file</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgac587ee" class="outline-3"><h3 id="orgac587ee"><span class="section-number-3">1.3</span> slicing filename</h3><div class="outline-text-3" id="text-1-3"><p>&#x63D0;&#x53D6;&#x6587;&#x4EF6;&#x540D; <code>${VAR%.*}</code> &#x6216;&#x8005;&#x6587;&#x4EF6;&#x540E;&#x7F00;&#x540D; <code>${VAR#.*}</code> &#x3002; <code>%</code> &#x4E3A;&#x975E;&#x8D2A;&#x5A6A;&#x6A21;&#x5F0F;&#xFF0C;&#x4ECE;&#x53F3;&#x81F3;&#x5DE6;&#x5339;&#x914D;&#x4E00;&#x4E2A; <code>.*</code> &#xFF0C; <code>#</code> &#x4ECE;&#x5DE6;&#x81F3;&#x53F3;&#x5339;&#x914D;&#x4E00;&#x4E2A; <code>.*</code> &#x3002;&#x63D0;&#x53D6;&#x65B9;&#x5F0F;&#x662F;&#x8D2A;&#x5A6A;&#x6A21;&#x5F0F;&#x662F;&#x4F7F;&#x7528;&#x4E24;&#x4E2A; <code>%%</code> &#x6216; <code>##</code> &#x5373;&#x53EF;&#x3002;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">name=<span class="variable">${file%.*}</span></span><br><span class="line">extn=<span class="variable">${file#.*}</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orga61d72e" class="outline-2"><h2 id="orga61d72e"><span class="section-number-2">2</span> find</h2><div class="outline-text-2" id="text-2"><p>find your files with <code>find</code>.</p></div><div id="outline-container-org250762a" class="outline-3"><h3 id="org250762a"><span class="section-number-3">2.1</span> list all files with path</h3><div class="outline-text-3" id="text-2-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &apos;\n&apos; as the delimitor</span></span><br><span class="line">find .. -<span class="built_in">print</span></span><br><span class="line"><span class="comment"># &apos;\0&apos; as the delimitor, useful for filename contains space</span></span><br><span class="line">find .. -print0</span><br><span class="line"></span><br><span class="line"><span class="comment"># list only directories</span></span><br><span class="line">ls -d */</span><br><span class="line">ls -F | grep <span class="string">&quot;/$&quot;</span></span><br><span class="line">ls -l | grep <span class="string">&quot;^d&quot;</span></span><br><span class="line">find . -<span class="built_in">type</span> d -maxdepth 1 -<span class="built_in">print</span></span><br></pre></td></tr></table></figure></div><p>If there are blanks, use <code>print0</code>.</p></div></div><div id="outline-container-orgf39032a" class="outline-3"><h3 id="orgf39032a"><span class="section-number-3">2.2</span> search by name</h3><div class="outline-text-3" id="text-2-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -name <span class="string">&quot;*.txt&quot;</span> &#x2013;<span class="built_in">print</span></span><br><span class="line">find . \( -name <span class="string">&quot;*.txt&quot;</span> -o -iname <span class="string">&quot;readme*&quot;</span> \) -<span class="built_in">print</span></span><br></pre></td></tr></table></figure></div><p><code>name</code> to match files, <code>iname</code> to ignore case. <code>path</code> to match <b>whole file paths</b>.<code>regex</code> <code>iregex</code> to match file paths based on <i>regular expression</i>, which specify a pattern.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . ! -name <span class="string">&quot;*.dll&quot;</span> -<span class="built_in">print</span></span><br><span class="line">find devel/source_path \( -name <span class="string">&quot;.git&quot;</span> -prune \) -o \( -<span class="built_in">type</span> f -<span class="built_in">print</span> \)</span><br><span class="line">find . -maxdepth 1 -<span class="built_in">type</span> f -<span class="built_in">print</span></span><br><span class="line">find . -mindepth 2 -<span class="built_in">type</span> f -<span class="built_in">print</span></span><br></pre></td></tr></table></figure></div><p><code>!</code> is nagating argument. It matches file names that not end with <i>.txt</i>.<code>prune</code> exclude portion<code>maxdepth</code> or <code>mindepth</code> specify directory depths.</p></div></div><div id="outline-container-org531eea3" class="outline-3"><h3 id="org531eea3"><span class="section-number-3">2.3</span> search by attributes</h3><div class="outline-text-3" id="text-2-3"><p><code>atime</code> to last access time<code>mtime</code> to last modify time<code>ctime</code> to last metadata modify time</p><p><code>amin</code>, <code>mmin</code>, <code>cmin</code> are minutes, instead of days in <code>atime</code>.<code>newer</code> specify a reference file to compare timestamp.</p><div class="org-src-container"><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> find . -<span class="built_in">type</span> f -atime +7 -size +2k -user allen -perm 644 -delete</span></span><br></pre></td></tr></table></figure></div><p><i>+, -, / are older, last, exact days or minutes.<code>size</code> to file size, /b, c, w, k, M, G</i>.</p><p><code>user</code> to file owner<code>perm</code> to file permissions</p></div></div><div id="outline-container-org8018daf" class="outline-3"><h3 id="org8018daf"><span class="section-number-3">2.4</span> operations</h3><div class="outline-text-3" id="text-2-4"><p><code>delete</code> to delete, instead of print<code>exec</code> to execute command on files sorted out.</p><div class="org-src-container"><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"># <span class="built_in">find</span> . -<span class="built_in">type</span> f &#x2013;user root &#x2013;exec chown allen {} \;</span><br></pre></td></tr></table></figure></div><p><code>{}</code> is a match, <code>\;</code> is the end of <code>find</code>.</p></div></div></div><div id="outline-container-org47a9af9" class="outline-2"><h2 id="org47a9af9"><span class="section-number-2">3</span> comparison</h2><div class="outline-text-2" id="text-3"><p>&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x6761;&#x4EF6;&#x5224;&#x65AD;&#xFF08;&#x6BD4;&#x8F83;&#xFF09;&#x5F62;&#x6210;&#x4E86; <code>&#x6D41;&#x63A7;&#x5236;</code></p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">command</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">command</span>;</span><br><span class="line"><span class="keyword">elif</span> condition; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">command</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">command</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[[ condition ]] &amp;&amp; true_cmd || false_cmd</span><br></pre></td></tr></table></figure></div></div><div id="outline-container-orgedb82f7" class="outline-3"><h3 id="orgedb82f7"><span class="section-number-3">3.1</span> math comparison</h3><div class="outline-text-3" id="text-3-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[ <span class="variable">$var</span> -eq 0 ]</span><br></pre></td></tr></table></figure></div><dl class="org-dl"><dt>-eq</dt><dd>equal</dd><dt>-ne</dt><dd>not equal</dd><dt>-gt</dt><dd>greater than</dd><dt>-lt</dt><dd>less than</dd><dt>-ge</dt><dd>greater or equal</dd><dt>-le</dt><dd>less or equal</dd></dl></div></div><div id="outline-container-org914f854" class="outline-3"><h3 id="org914f854"><span class="section-number-3">3.2</span> logical comparison</h3><div class="outline-text-3" id="text-3-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[ <span class="variable">$var1</span> -ne 0 -a <span class="variable">$var2</span> -gt 2 ]</span><br><span class="line">[ <span class="variable">$var1</span> -ne 0 ] &amp;&amp; [ <span class="variable">$var2</span> -gt 2 ]</span><br></pre></td></tr></table></figure></div><dl class="org-dl"><dt>-a</dt><dd>AND</dd><dt>-o</dt><dd>OR</dd></dl></div></div><div id="outline-container-org837a601" class="outline-3"><h3 id="org837a601"><span class="section-number-3">3.3</span> filesystem conditions</h3><div class="outline-text-3" id="text-3-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[[ -e ~/.bash_aliases ]] &amp;&amp; . ~/.bash_aliases</span><br></pre></td></tr></table></figure></div><dl class="org-dl"><dt>-f $var</dt><dd>true if $file holds a regular file path</dd><dt>-x $var</dt><dd>true if $var bolds a executable file path</dd><dt>-e $var</dt><dd>true if $var holds an existing file</dd><dt>-d $var</dt><dd>true if $var holds a directory path</dd><dt>-c $var</dt><dd>true if $var holds a char dev file</dd><dt>-b $var</dt><dd>true if $var holds a block dev file</dd><dt>-w $var</dt><dd>true if $var holds a writable file</dd><dt>-r $var</dt><dd>true if $var holds a readable file</dd><dt>-L $var</dt><dd>true if $var holds a symlink</dd></dl></div></div><div id="outline-container-orgff5c079" class="outline-3"><h3 id="orgff5c079"><span class="section-number-3">3.4</span> string conditions / comparisons</h3><div class="outline-text-3" id="text-3-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[[ <span class="variable">$str1</span> = <span class="variable">$str2</span> ]] <span class="comment"># true if $str1 equals $str2</span></span><br><span class="line">[[ <span class="variable">$str1</span> == <span class="variable">$str2</span> ]] <span class="comment"># true if $str1 equals $str2</span></span><br><span class="line">[[ <span class="variable">$str1</span> != <span class="variable">$str2</span> ]] <span class="comment"># true if $str1 mismatches $str2</span></span><br><span class="line">[[ <span class="variable">$str1</span> &gt; <span class="variable">$str2</span> ]] <span class="comment"># true if $str1 alphabetically greater than $str2</span></span><br><span class="line">[[ -z <span class="variable">$str1</span> ]] <span class="comment"># true if $str1 holds an empty string</span></span><br><span class="line">[[ -n <span class="variable">$str1</span> ]] <span class="comment"># true if $str1 holds an non-empty string</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orga2abacf" class="outline-2"><h2 id="orga2abacf"><span class="section-number-2">4</span> input</h2><div class="outline-text-2" id="text-4"><p>&#x6807;&#x51C6;&#x8F93;&#x5165;&#xFF0C;&#x6216;&#x662F;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#xFF0C;&#x4F5C;&#x4E3A;&#x811A;&#x672C;&#x8F93;&#x5165;&#x3002;&#x8F93;&#x5165;&#x7684;&#x5176;&#x4ED6;&#x91CD;&#x8981;&#x7EC6;&#x8282;&#x4E4B;&#x4E00;&#xFF0C;&#x662F;&#x8BBE;&#x5B9A;&#x5206;&#x9694;&#x7B26;&#x3002;</p></div><div id="outline-container-org4b1fc6d" class="outline-3"><h3 id="org4b1fc6d"><span class="section-number-3">4.1</span> read</h3><div class="outline-text-3" id="text-4-1"><dl class="org-dl"><dt>&#x8BFB;&#x53D6; n &#x4E2A;&#x5B57;&#x7B26;&#x5230; to_var &#x4E2D;</dt><dd>read -n num_chars to_var</dd><dt>&#x8F93;&#x51FA;&#x6D88;&#x606F;&#x7684;&#x8BFB;&#x53D6;</dt><dd>read -p &quot;message&quot; to_var</dd><dt>&#x5C4F;&#x5E55;&#x4E0D;&#x663E;&#x793A;&#x8F93;&#x5165;&#x5185;&#x5BB9;&#x5730;&#x8BFB;&#x53D6;&#x5230; to_var</dt><dd>read -s to_var</dd><dt>&#x8BBE;&#x5B9A;&#x8BFB;&#x53D6;&#x5B57;&#x7B26;&#x7684;&#x8D85;&#x65F6;</dt><dd>read -t timeout to_var</dd><dt>&#x8BBE;&#x5B9A;&#x8BFB;&#x53D6;&#x5B57;&#x7B26;&#x7684;&#x5206;&#x9694;&#x7B26;</dt><dd>read -d delim_char to_var</dd></dl><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">read</span> -n 3 var &amp;&amp; <span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;Please Enter your name:&quot;</span> var</span><br><span class="line"><span class="built_in">read</span> -s password</span><br><span class="line"><span class="built_in">read</span> -t 3 var</span><br><span class="line"><span class="built_in">read</span> -d <span class="string">&quot;:&quot;</span> var</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org2d1b9d2" class="outline-3"><h3 id="org2d1b9d2"><span class="section-number-3">4.2</span> IFS</h3><div class="outline-text-3" id="text-4-2"><p>&#x53E6;&#x4E00;&#x4E2A;&#x5206;&#x9694;&#x7B26;&#x5DE5;&#x5177; : internal field separator. <code>$IFS</code></p></div></div><div id="outline-container-orge7d1dc5" class="outline-3"><h3 id="orge7d1dc5"><span class="section-number-3">4.3</span> xarg</h3><div class="outline-text-3" id="text-4-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat file.txt | xargs</span><br><span class="line">cat file.txt | xargs -n 3</span><br><span class="line">cat file.txt | xargs -n 3 -d _</span><br><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.txt&quot;</span> -print0 | xargs -0 rm -f</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org2c22bf6" class="outline-2"><h2 id="org2c22bf6"><span class="section-number-2">5</span> translate</h2><div class="outline-text-2" id="text-5"></div><div id="outline-container-org2148e8d" class="outline-3"><h3 id="org2148e8d"><span class="section-number-3">5.1</span> &#x5C06;&#x8F93;&#x5165;&#x4E2D;&#x7684;&#x4E00;&#x7EC4;&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x6210;&#x53E6;&#x4E00;&#x7EC4;&#x5B57;&#x7B26;&#x4E32;&#x3002;</h3><div class="outline-text-3" id="text-5-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tr [option] set1 set2</span><br><span class="line">cat file.txt | tr <span class="string">&apos;A-Z&apos;</span> <span class="string">&apos;a-z&apos;</span></span><br><span class="line"><span class="built_in">echo</span> 12345 | tr <span class="string">&apos;0-9&apos;</span> <span class="string">&apos;9876543210&apos;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org44dd795" class="outline-3"><h3 id="org44dd795"><span class="section-number-3">5.2</span> &#x5220;&#x9664;&#x7279;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;</h3><div class="outline-text-3" id="text-5-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat file.txt | tr -d <span class="string">&apos;0-9&apos;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb14e9e7" class="outline-3"><h3 id="orgb14e9e7"><span class="section-number-3">5.3</span> &#x8865;&#x5145;&#x7279;&#x5B9A;&#x5B57;&#x7B26;&#x4E32;</h3><div class="outline-text-3" id="text-5-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat file.txt | tr -c set1</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgee854c3" class="outline-3"><h3 id="orgee854c3"><span class="section-number-3">5.4</span> &#x96C6;&#x5408;&#x5206;&#x7C7B;</h3><div class="outline-text-3" id="text-5-4"><dl class="org-dl"><dt>alnum</dt><dd>alphanumeric characters</dd><dt>alpha</dt><dd>alphabetic characters</dd><dt>cntrl</dt><dd>control characters</dd><dt>digit</dt><dd>numeric characters</dd><dt>xdigit</dt><dd>hexadecimal characters</dd><dt>graph</dt><dd>graphic characters</dd><dt>print</dt><dd>printable characters</dd><dt>punct</dt><dd>punctuation characters</dd><dt>space</dt><dd>whitespace characters</dd><dt>lower</dt><dd>lower-case alpha</dd><dt>upper</dt><dd>upper-case alpha</dd></dl><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tr <span class="string">&apos;[:lower:]&apos;</span> <span class="string">&apos;[:upper:]&apos;</span></span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org96b18b6" class="outline-2"><h2 id="org96b18b6"><span class="section-number-2">6</span> sort</h2><div class="outline-text-2" id="text-6"><p>&#x6392;&#x5E8F;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF0C;&#x5E76;&#x5254;&#x9664;&#x91CD;&#x590D;</p><pre class="example">sort file1.txt file2.txt &gt; sorted.txtsort file1.txt file2.txt -o sorted.txt# numeric sort &amp;&amp; reverse ordersort -n file.txtsort -r file.txt# specify key of column 2sort -k 2 file.txt# ignore leading blanks &amp;&amp; directory ordersort -bd unsorted.txt# sort by monthssort -M file.txt# merge sorted files without sorting againsort -m sorted1 sorted2</pre><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sort unsorted.txt | uniq</span><br><span class="line">sort -u unsorted.txt</span><br><span class="line">uniq sorted.txt</span><br><span class="line"><span class="comment"># display only unique lines</span></span><br><span class="line">uniq -u sorted.txt</span><br><span class="line"><span class="comment"># display counts</span></span><br><span class="line">sort unsorted.txt | uniq -c</span><br><span class="line"><span class="comment"># display duplicate lines</span></span><br><span class="line">sort unsorted.txt | uniq -d</span><br><span class="line"><span class="comment"># -s skip first N characters</span></span><br><span class="line"><span class="comment"># -w maximum characters to compare</span></span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">comm sorted1.txt sorted2.txt</span><br><span class="line">comm sorted1.txt sorted2.txt -3</span><br><span class="line">comm sorted1.txt sorted2.txt -1 -2</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org0b70a17" class="outline-2"><h2 id="org0b70a17"><span class="section-number-2">7</span> diff</h2><div class="outline-text-2" id="text-7"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">diff file1.txt file2.txt</span><br><span class="line"><span class="comment"># Unified output will be like git</span></span><br><span class="line">diff -u file1.txt file2.txt</span><br><span class="line"><span class="comment"># Save differences to file.patch</span></span><br><span class="line">diff -u file1.txt file2.txt &gt; file.patch</span><br><span class="line"><span class="comment"># Apply patch, i.e. having same contents of file2.txt</span></span><br><span class="line">patch -p1 file1.txt &lt; file.patch</span><br><span class="line"><span class="comment"># Revert patch</span></span><br><span class="line">patch -p1 file1.txt &lt; file.patch -R</span><br><span class="line"><span class="comment"># Recursively generating diff</span></span><br><span class="line">diff -Naur dire1 dire2</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org93f09dc" class="outline-2"><h2 id="org93f09dc"><span class="section-number-2">8</span> head &amp; tail</h2><div class="outline-text-2" id="text-8"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Print first 10 lines</span></span><br><span class="line">head file</span><br><span class="line">cat ~/.spacemacs | head</span><br><span class="line"><span class="comment"># First 4 lines to be printed</span></span><br><span class="line">head -n 4 file</span><br><span class="line"><span class="comment"># All lines except last 5 lines</span></span><br><span class="line">head -n -5 file</span><br><span class="line"><span class="comment"># Print last 10 lines</span></span><br><span class="line">tail file</span><br><span class="line"><span class="comment"># Last 4 lines to be printed</span></span><br><span class="line">tail -n 4 file</span><br><span class="line"><span class="comment"># All lines except first (5-1) line</span></span><br><span class="line">tail -n +5</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Reading a growing file, using pid</span></span><br><span class="line">PID=$(pidof emacs)</span><br><span class="line">tail -f file.txt --pid <span class="variable">$PID</span></span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Count number of lines</span></span><br><span class="line">wc -l file</span><br><span class="line"><span class="comment"># print the length of longest line</span></span><br><span class="line">wc file -L</span><br><span class="line"><span class="comment"># Tree view of files and directories</span></span><br><span class="line">tree ~/Documents</span><br><span class="line"><span class="comment"># -P PATTERN highlight only files matched by pattern</span></span><br><span class="line">tree path -P <span class="string">&quot;*.sh&quot;</span></span><br><span class="line"><span class="comment"># -I PATTERN highlight only files excluding the match pattern</span></span><br><span class="line">tree path -I <span class="string">&quot;*.org&quot;</span></span><br><span class="line"><span class="comment"># Print size along with them</span></span><br><span class="line">tree -h</span><br><span class="line"><span class="comment"># Generate HTML output at directory PATH</span></span><br><span class="line">tree PATH -H http://localhost -o out.html</span><br></pre></td></tr></table></figure></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgeb5e672&quot;&gt;1. file name&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org278d7e2&quot;&gt;1.1. temp file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc321695&quot;&gt;1.2. splitting file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgac587ee&quot;&gt;1.3. slicing filename&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orga61d72e&quot;&gt;2. find&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org250762a&quot;&gt;2.1. list all files with path&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf39032a&quot;&gt;2.2. search by name&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org531eea3&quot;&gt;2.3. search by attributes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8018daf&quot;&gt;2.4. operations&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org47a9af9&quot;&gt;3. comparison&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgedb82f7&quot;&gt;3.1. math comparison&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org914f854&quot;&gt;3.2. logical comparison&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org837a601&quot;&gt;3.3. filesystem conditions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgff5c079&quot;&gt;3.4. string conditions / comparisons&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orga2abacf&quot;&gt;4. input&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org4b1fc6d&quot;&gt;4.1. read&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2d1b9d2&quot;&gt;4.2. IFS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orge7d1dc5&quot;&gt;4.3. xarg&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2c22bf6&quot;&gt;5. translate&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org2148e8d&quot;&gt;5.1. &amp;#x5C06;&amp;#x8F93;&amp;#x5165;&amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x7EC4;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x8F6C;&amp;#x6362;&amp;#x6210;&amp;#x53E6;&amp;#x4E00;&amp;#x7EC4;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x3002;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org44dd795&quot;&gt;5.2. &amp;#x5220;&amp;#x9664;&amp;#x7279;&amp;#x5B9A;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgb14e9e7&quot;&gt;5.3. &amp;#x8865;&amp;#x5145;&amp;#x7279;&amp;#x5B9A;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgee854c3&quot;&gt;5.4. &amp;#x96C6;&amp;#x5408;&amp;#x5206;&amp;#x7C7B;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org96b18b6&quot;&gt;6. sort&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org0b70a17&quot;&gt;7. diff&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org93f09dc&quot;&gt;8. head &amp;amp; tail&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="shell" scheme="https://angry-bird.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Linux shell commands 101</title>
    <link href="https://angry-bird.github.io/2017/10/20/Linux-shell-commands-101/"/>
    <id>https://angry-bird.github.io/2017/10/20/Linux-shell-commands-101/</id>
    <published>2017-10-20T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#org374bfe1">1. &#x6587;&#x4EF6;</a><ul><li><a href="#orga5ab246">1.1. &#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x3001;&#x663E;&#x793A;&#x5185;&#x5BB9;&#x3001;&#x4FEE;&#x6539;&#x5C5E;&#x4E3B;&#x5C5E;&#x6027;</a></li><li><a href="#orgb03684f">1.2. Loopback filesystem vs. loopback file</a></li><li><a href="#org860e2a8">1.3. Creating &amp; Mounting ISO files as loopback</a></li><li><a href="#orgc9bd5b1">1.4. Compression</a></li><li><a href="#orgad8158b">1.5. Archiving</a></li></ul></li><li><a href="#orgdf68e67">2. &#x7528;&#x6237;</a><ul><li><a href="#orgf16435f">2.1. &#x6DFB;&#x52A0;&#x3001;&#x4FEE;&#x6539;&#x3001;&#x5220;&#x9664;</a></li><li><a href="#org3e76ccc">2.2. &#x767B;&#x5F55;&#x4FE1;&#x606F;</a></li></ul></li><li><a href="#org8d675fe">3. &#x7CFB;&#x7EDF;</a><ul><li><a href="#org21333fa">3.1. &#x786C;&#x76D8;&#x4F7F;&#x7528;&#x91CF;</a></li><li><a href="#orgb39bc6e">3.2. CPU &#x65F6;&#x95F4;&#x4F7F;&#x7528;&#x91CF;</a></li><li><a href="#orgf0fd427">3.3. &#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x91CF;</a></li><li><a href="#org6593000">3.4. &#x8BA1;&#x5212;&#x4EFB;&#x52A1;</a></li></ul></li><li><a href="#orgce4397a">4. &#x7F51;&#x7EDC;</a><ul><li><a href="#org46cca44">4.1. ip</a></li><li><a href="#org538f0f2">4.2. ifconfig</a></li><li><a href="#orgb63793a">4.3. networkmanager</a></li><li><a href="#org406df43">4.4. write static ip</a></li><li><a href="#org22d40b3">4.5. network communication</a></li></ul></li></ul></div></div><a id="more"></a><p>&#x7B2C; 1 &#x7BC7; &#x4ECB;&#x7ECD; Linux &#x7CFB;&#x7EDF;&#x914D;&#x7F6E;&#x547D;&#x4EE4;&#xFF0C;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x4FEE;&#x6539;&#xFF0C;&#x7528;&#x6237;&#x6DFB;&#x52A0;&#x3001;&#x5220;&#x9664;&#x3001;&#x4FEE;&#x6539;&#xFF0C;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;</p><div id="outline-container-org374bfe1" class="outline-2"><h2 id="org374bfe1"><span class="section-number-2">1</span> &#x6587;&#x4EF6;</h2><div class="outline-text-2" id="text-1"></div><div id="outline-container-orga5ab246" class="outline-3"><h3 id="orga5ab246"><span class="section-number-3">1.1</span> &#x6587;&#x4EF6;&#x521B;&#x5EFA;&#x3001;&#x663E;&#x793A;&#x5185;&#x5BB9;&#x3001;&#x4FEE;&#x6539;&#x5C5E;&#x4E3B;&#x5C5E;&#x6027;</h3><div class="outline-text-3" id="text-1-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero bs=100k count=1 of=data.file</span><br><span class="line"><span class="comment"># touch modify files, create them if they not exist</span></span><br><span class="line">touch file{1..100}.sh</span><br><span class="line"><span class="comment"># modify access &amp; modification time</span></span><br><span class="line">touch -a file.sh</span><br><span class="line">touch -m file.sh</span><br><span class="line">touch -d <span class="string">&quot;jan 20 2017&quot;</span> file.sh</span><br><span class="line">ln -s target_file symlink_name</span><br><span class="line">find . -<span class="built_in">type</span> l -<span class="built_in">print</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">test</span>&gt;&gt;file.sh</span><br><span class="line">file file.sh</span><br><span class="line">file -b file.sh</span><br><span class="line">cat file.sh</span><br><span class="line">chmod 755 file.sh</span><br><span class="line">chmod u=rwx g=rw o=r file.sh</span><br><span class="line">chmod a+x file.sh</span><br><span class="line"><span class="comment">## Recursively change permissions to current directory</span></span><br><span class="line">chmod 777 . -R</span><br><span class="line"><span class="comment"># chown user.group filename</span></span><br><span class="line">chown zuoshi.kali file.sh</span><br><span class="line">chown zuoshi.kali . -R</span><br><span class="line"><span class="comment"># make immutable file</span></span><br><span class="line">chattr +i file.sh</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb03684f" class="outline-3"><h3 id="orgb03684f"><span class="section-number-3">1.2</span> Loopback filesystem vs. loopback file</h3><div class="outline-text-3" id="text-1-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=loopbackfile.img bs=1G count=1</span><br><span class="line">mkfs.ext4 loopbackfile.img</span><br><span class="line">sudo mkdir /mnt/lookback</span><br><span class="line">mount -o loop loopbackfile.img /mnt/loopback</span><br><span class="line"><span class="comment"># Or use follow steps to mount loopbackfile</span></span><br><span class="line">losetup /dev/loop1 loopbackfile.img</span><br><span class="line">mount /dev/loop1 /mnt/loopback</span><br><span class="line"><span class="comment"># 1st partition on disk img file, just like sda1 on sda</span></span><br><span class="line"><span class="comment"># offset is 32256 byte</span></span><br><span class="line">losetup -o 32256 /dev/loop2 loopbackfile.img</span><br><span class="line">umount /dev/loop1</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org860e2a8" class="outline-3"><h3 id="org860e2a8"><span class="section-number-3">1.3</span> Creating &amp; Mounting ISO files as loopback</h3><div class="outline-text-3" id="text-1-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat /dev/cdrom &gt; linux.iso</span><br><span class="line"><span class="comment"># The preferred way</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/cdrom of=linux.iso</span><br><span class="line"><span class="comment"># Another way</span></span><br><span class="line">mkisofs -V <span class="string">&quot;Label&quot;</span> -o linux.iso source_dir/</span><br><span class="line"><span class="comment"># Hybrid ISO can be written to USB sd as a bootable USB device,</span></span><br><span class="line"><span class="comment"># So convernt bootable ISO file to Hybrid ISO</span></span><br><span class="line">isohybrid linux.iso</span><br><span class="line"><span class="comment"># Write it to usb sd</span></span><br><span class="line">dd <span class="keyword">if</span>=linux.iso of=/dev/sdb1</span><br><span class="line"><span class="comment"># Or just use cat</span></span><br><span class="line">cat linux.iso &gt; /dev/sdb1</span><br><span class="line"><span class="comment"># Burning an iso file into CD ROM or DVD ROM</span></span><br><span class="line">cdrecord -v dev=/dev/cdrom linux.iso</span><br><span class="line"><span class="comment"># mounting iso files</span></span><br><span class="line">mkdir /mnt/iso</span><br><span class="line">mount -o loop linux.iso /mnt/iso</span><br><span class="line"><span class="comment"># Flush into iso file</span></span><br><span class="line">sync</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgc9bd5b1" class="outline-3"><h3 id="orgc9bd5b1"><span class="section-number-3">1.4</span> Compression</h3><div class="outline-text-3" id="text-1-4"></div><div id="outline-container-org7cc61cf" class="outline-4"><h4 id="org7cc61cf">zip</h4><div class="outline-text-4" id="text-org7cc61cf"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">zip arch.zip file</span><br><span class="line">zip -r arch.zip dire file</span><br><span class="line"><span class="comment"># Delete file from arch.zip</span></span><br><span class="line">zip -d arch.zip file</span><br><span class="line"><span class="comment"># Update</span></span><br><span class="line">zip arch.zip -u newfile</span><br><span class="line"><span class="comment"># List</span></span><br><span class="line">unzip -l arch.zip</span><br><span class="line"><span class="comment"># Extract</span></span><br><span class="line">unzip file.zip</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org1ac35f5" class="outline-4"><h4 id="org1ac35f5">gz, bz2, xz</h4><div class="outline-text-4" id="text-org1ac35f5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gzip file</span><br><span class="line">gunzip arch.gz</span><br><span class="line"><span class="comment"># List</span></span><br><span class="line">gzip -l arch.gz</span><br><span class="line"><span class="comment"># Read from =stdio= and compress output file</span></span><br><span class="line">cat file | gzip -c &gt; arch.gz</span><br><span class="line"><span class="comment"># Dump extracted file without extracting gz</span></span><br><span class="line">zcat arch.gz</span><br><span class="line"><span class="comment"># Compression ratio</span></span><br><span class="line">gzip -9 file</span><br><span class="line"><span class="comment"># bzip &amp; bzip2</span></span><br><span class="line">bzip2 file</span><br><span class="line">bunzip2 arch.bz2</span><br><span class="line">bunzip2 arch.bz2 -k</span><br><span class="line">cat file | bzip2 -c &gt; arch.tar.bz2</span><br><span class="line"><span class="comment"># lzma</span></span><br><span class="line">lzma file</span><br><span class="line">unlzma file</span><br><span class="line">cat file | lzma -c &gt; file.lzma</span><br><span class="line"><span class="comment"># xz</span></span><br><span class="line">xz -z file</span><br><span class="line">xz -d arch.xz</span><br><span class="line">xz -d arch.xz -k</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org49086b2" class="outline-4"><h4 id="org49086b2">squashfs</h4><div class="outline-text-4" id="text-org49086b2"><p>&#x53EA;&#x8BFB;&#x538B;&#x7F29;&#x6587;&#x4EF6;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06; 2-3G &#x7684;&#x6570;&#x636E;&#x538B;&#x7F29;&#x5230; 700M &#x5927;&#x5C0F;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x6B63;&#x5982; Linux &#x7684; Live CD &#x4E00;&#x6837;&#x3002;&#x914D;&#x5408; loopback &#x6A21;&#x5F0F;&#x6302;&#x8F7D;&#x538B;&#x7F29;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6BCF;&#x6B21;&#x53EA;&#x89E3;&#x538B;&#x5C11;&#x91CF;&#x6587;&#x4EF6;&#xFF0C;&#x800C;&#x80FD;&#x7EF4;&#x6301;&#x8F83;&#x9AD8;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x3002;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mksquashfs SOURCES comp.squashfs</span><br><span class="line">mkdir -p /mnt/squash</span><br><span class="line">mount -o loop comp.squashfs /mnt/squash</span><br><span class="line"><span class="comment"># Exclude</span></span><br><span class="line">sudo mksquashfs /etc comp.squashfs -e /etc/passwd /etc/shadow</span><br><span class="line">sudo mksquashfs /etc comp.squashfs -ef exclude.list</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org7198cfc" class="outline-4"><h4 id="org7198cfc">crypo tools</h4><div class="outline-text-4" id="text-org7198cfc"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crypt PASSPHRASE input encrypted</span><br><span class="line">gpg -c input</span><br><span class="line">gpg file.gpg</span><br><span class="line">base64 file &gt; out_file</span><br><span class="line">md5sum file</span><br><span class="line">sha1sum file</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org2089769" class="outline-4"><h4 id="org2089769">sync &amp; backup</h4><div class="outline-text-4" id="text-org2089769"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -az /home/zuoshi /home/backup</span><br><span class="line">rsync -az source_path dest_path --exclude <span class="string">&quot;*.txt&quot;</span></span><br><span class="line">rsync -az source_path dest_path --exclude-from exclude.list</span><br><span class="line"><span class="comment"># Delete non-exist files from destination path</span></span><br><span class="line">rsync -az source_path dest_path --delete</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orgad8158b" class="outline-3"><h3 id="orgad8158b"><span class="section-number-3">1.5</span> Archiving</h3><div class="outline-text-3" id="text-1-5"></div><div id="outline-container-org9d7b98d" class="outline-4"><h4 id="org9d7b98d">tar</h4><div class="outline-text-4" id="text-org9d7b98d"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create and compress after archiving</span></span><br><span class="line">tar -cf output.tar file1 file2 folder1 ..</span><br><span class="line"><span class="comment">#-a --auto-compress with extension</span></span><br><span class="line">tar -caf output.tar.xz file1 file2</span><br><span class="line">tar -czf output.tar.gz file1 file2</span><br><span class="line">tar -cjf output.tar.bz2 file1 file2</span><br><span class="line"><span class="comment"># --lzma xz</span></span><br><span class="line">tar -cJf output.tar.xz file1 file2</span><br><span class="line"><span class="comment"># --total printing total bytes after archiving</span></span><br><span class="line"><span class="comment"># Exclude a set of file from archiving</span></span><br><span class="line">tar -cf arch.tar * --exclude <span class="string">&quot;*.txt&quot;</span></span><br><span class="line">tar -cf arch.tar * -X EXCLUED.LIST</span><br><span class="line"><span class="comment"># Exclude version control directory</span></span><br><span class="line">tar --exclude-vcs -czvvf source_code.tar.gz DIRE</span><br><span class="line"><span class="comment"># Extract to</span></span><br><span class="line">tar -xf archive.tar -C /path/to/extra_dir</span><br><span class="line">tar -xJf output.tar.gz</span><br><span class="line"><span class="comment"># Extract and delete</span></span><br><span class="line">tar -xzf output.tar.gz --remove-files</span><br><span class="line"><span class="comment"># Update</span></span><br><span class="line">tar -rf output.tar new_file</span><br><span class="line"><span class="comment"># Updating only file1 has newer modification timestamp</span></span><br><span class="line">tar -uf archive.tar file1</span><br><span class="line"><span class="comment"># Merge tarballs</span></span><br><span class="line">tar -Af file1.tar file2.tar</span><br><span class="line"><span class="comment"># List = test</span></span><br><span class="line">tar -tf output.tar</span><br><span class="line"><span class="comment"># Differ</span></span><br><span class="line">tar -df archive.tar file1 file2</span><br><span class="line"><span class="comment"># Delete files in archive</span></span><br><span class="line">tar -f archive.tar --delete file1 file2</span><br><span class="line">tar --delete --file archive.tar file1 file2</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf9731cb" class="outline-4"><h4 id="orgf9731cb">cpio</h4><div class="outline-text-4" id="text-orgf9731cb"><p>&#x6587;&#x4EF6;&#x5939;&#x548C;&#x5E26;&#x6709;&#x8DEF;&#x5F84;&#x7684;&#x6587;&#x4EF6;&#xFF0C; <code>cpio</code> &#x538B;&#x7F29;&#x89E3;&#x538B;&#x65F6;&#x4F1A;&#x9075;&#x5B88;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C; <code>tar</code> &#x5219;&#x79FB;&#x9664; <code>/</code> &#x8F6C;&#x6362;&#x6210;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x7684;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x3002;</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Archiving to output file</span></span><br><span class="line"><span class="built_in">echo</span> file1 file2 | cpio -o &gt; arch.cpio</span><br><span class="line"><span class="comment"># List file in archive file</span></span><br><span class="line">cpio -it &lt; arch.cpio</span><br><span class="line"><span class="comment"># Extract from archive</span></span><br><span class="line">cpio -id &lt; arch.cpio</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="outline-container-orgdf68e67" class="outline-2"><h2 id="orgdf68e67"><span class="section-number-2">2</span> &#x7528;&#x6237;</h2><div class="outline-text-2" id="text-2"></div><div id="outline-container-orgf16435f" class="outline-3"><h3 id="orgf16435f"><span class="section-number-3">2.1</span> &#x6DFB;&#x52A0;&#x3001;&#x4FEE;&#x6539;&#x3001;&#x5220;&#x9664;</h3><div class="outline-text-3" id="text-2-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">useradd -g users -s /bin/bash -m name</span><br><span class="line">usermod -d /mnt/usb/home -m name</span><br><span class="line">passwd name</span><br><span class="line">userdel name</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org3e76ccc" class="outline-3"><h3 id="org3e76ccc"><span class="section-number-3">2.2</span> &#x767B;&#x5F55;&#x4FE1;&#x606F;</h3><div class="outline-text-3" id="text-2-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">who</span><br><span class="line">w</span><br><span class="line">users</span><br><span class="line">uptime</span><br><span class="line">last</span><br><span class="line">lastb</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-org8d675fe" class="outline-2"><h2 id="org8d675fe"><span class="section-number-2">3</span> &#x7CFB;&#x7EDF;</h2><div class="outline-text-2" id="text-3"></div><div id="outline-container-org21333fa" class="outline-3"><h3 id="org21333fa"><span class="section-number-3">3.1</span> &#x786C;&#x76D8;&#x4F7F;&#x7528;&#x91CF;</h3><div class="outline-text-3" id="text-3-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Disk usage</span></span><br><span class="line">du -sh</span><br><span class="line">du -ch</span><br><span class="line">du file</span><br><span class="line">du -a directory</span><br><span class="line"><span class="comment"># Print size in bytes(default), kilobytes, megabytes, Block size(n bytes)</span></span><br><span class="line">du -b file</span><br><span class="line">du -k file</span><br><span class="line">du -m file</span><br><span class="line">du -B 4 file</span><br><span class="line"><span class="comment"># Exclude files</span></span><br><span class="line">du --exclude <span class="string">&quot;*.org&quot;</span> deft</span><br><span class="line">du --exclude-from exclude.txt deft</span><br><span class="line">du --max-depth 2 deft</span><br><span class="line"><span class="comment"># 10 largest size file</span></span><br><span class="line">du -ak deft | sort -nrk 1 | head</span><br><span class="line"><span class="comment"># Disk free space</span></span><br><span class="line">df -h</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb39bc6e" class="outline-3"><h3 id="orgb39bc6e"><span class="section-number-3">3.2</span> CPU &#x65F6;&#x95F4;&#x4F7F;&#x7528;&#x91CF;</h3><div class="outline-text-3" id="text-3-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">time COMMAND</span><br><span class="line">time ls</span><br><span class="line">time -o output.txt COMMAND</span><br><span class="line">time -f <span class="string">&quot;Time: %U&quot;</span> -a -o output.txt ls</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgf0fd427" class="outline-3"><h3 id="orgf0fd427"><span class="section-number-3">3.3</span> &#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x91CF;</h3><div class="outline-text-3" id="text-3-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps</span><br><span class="line">ps -fe | head</span><br><span class="line">top</span><br><span class="line">pgrep</span><br><span class="line">lsof</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">kill</span> -l</span><br><span class="line"><span class="built_in">kill</span> -s SIGNAL PID</span><br><span class="line"><span class="built_in">kill</span> -9 PID</span><br><span class="line">killall PName</span><br><span class="line">killall -9 emacs</span><br><span class="line">killall -u USER PName</span><br></pre></td></tr></table></figure></div><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hostname</span><br><span class="line">uname -n</span><br><span class="line">uname -a</span><br><span class="line">uname -r</span><br><span class="line">uname -m</span><br><span class="line">cat /proc/cpuinfo</span><br><span class="line">cat /proc/meninfo</span><br><span class="line">cat /proc/partitions</span><br><span class="line">fdisk -l</span><br><span class="line">lshw</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org6593000" class="outline-3"><h3 id="org6593000"><span class="section-number-3">3.4</span> &#x8BA1;&#x5212;&#x4EFB;&#x52A1;</h3><div class="outline-text-3" id="text-3-4"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create a scheduling task</span></span><br><span class="line">crontab -e</span><br><span class="line"><span class="comment"># 02 02 * * * /home/zuoshi/test.sh</span></span><br><span class="line">crontab task.cron</span><br><span class="line">crontab &lt;&lt; EOF</span><br><span class="line">http_proxy=http://192.168.0.3:3128</span><br><span class="line">00 * * * * /home/zuoshi/download.sh</span><br><span class="line"><span class="comment"># Viewing the cron table</span></span><br><span class="line">crontab -l -u zuoshi</span><br><span class="line"><span class="comment"># Removing the cron table</span></span><br><span class="line">crontab -r</span><br></pre></td></tr></table></figure></div></div></div></div><div id="outline-container-orgce4397a" class="outline-2"><h2 id="orgce4397a"><span class="section-number-2">4</span> &#x7F51;&#x7EDC;</h2><div class="outline-text-2" id="text-4"></div><div id="outline-container-org46cca44" class="outline-3"><h3 id="org46cca44"><span class="section-number-3">4.1</span> ip</h3><div class="outline-text-3" id="text-4-1"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> nameserver 8.8.8.8 &gt;&gt; /etc/resolv.conf</span><br><span class="line">ip addr show</span><br><span class="line">ip link status</span><br><span class="line">ip addr add 192.168.0.10/24 broadcast 192.168.0.255 dev ens33</span><br><span class="line">ip link <span class="built_in">set</span> ens33 up</span><br><span class="line">ip route add default via 192.168.0.1</span><br><span class="line">ping -c2 github.com</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org538f0f2" class="outline-3"><h3 id="org538f0f2"><span class="section-number-3">4.2</span> ifconfig</h3><div class="outline-text-3" id="text-4-2"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ifconfig eth0 up</span><br><span class="line">ifconfig eth0 192.168.0.1 netmask 255.255.255.0 broadcast 192.168.0.255</span><br><span class="line">route add default gw 192.168.0.100</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgb63793a" class="outline-3"><h3 id="orgb63793a"><span class="section-number-3">4.3</span> networkmanager</h3><div class="outline-text-3" id="text-4-3"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmcli connection add con-name <span class="string">&quot;static&quot;</span> ifname eth0 <span class="built_in">type</span> ethernet autoconnect yes ip4 192.168.0.1 gw4 192.168.0.101</span><br><span class="line">nmcli connection modify <span class="string">&quot;static&quot;</span> ipv4.dns 8.8.4.4</span><br><span class="line">nmcli connection modify <span class="string">&quot;static&quot;</span> +ipv4.dns 8.8.8.8</span><br><span class="line">nmcli connection modify <span class="string">&quot;static&quot;</span> +ipv4.addresses 192.168.0.2/24</span><br><span class="line">nmcli connection up static</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org406df43" class="outline-3"><h3 id="org406df43"><span class="section-number-3">4.4</span> write static ip</h3><div class="outline-text-3" id="text-4-4"><div class="org-src-container"><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="comment">## /etc/network/interfaces</span></span><br><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line">source /etc/network/interfaces.d/*</span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"><span class="comment"># Static inet</span></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">    address 192.168.0.1</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    broadcast 192.168.0.255</span><br><span class="line">    gateway 192.168.0.100</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org22d40b3" class="outline-3"><h3 id="org22d40b3"><span class="section-number-3">4.5</span> network communication</h3><div class="outline-text-3" id="text-4-5"><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lsof -i</span><br><span class="line">netstat -antp</span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org374bfe1&quot;&gt;1. &amp;#x6587;&amp;#x4EF6;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orga5ab246&quot;&gt;1.1. &amp;#x6587;&amp;#x4EF6;&amp;#x521B;&amp;#x5EFA;&amp;#x3001;&amp;#x663E;&amp;#x793A;&amp;#x5185;&amp;#x5BB9;&amp;#x3001;&amp;#x4FEE;&amp;#x6539;&amp;#x5C5E;&amp;#x4E3B;&amp;#x5C5E;&amp;#x6027;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgb03684f&quot;&gt;1.2. Loopback filesystem vs. loopback file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org860e2a8&quot;&gt;1.3. Creating &amp;amp; Mounting ISO files as loopback&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgc9bd5b1&quot;&gt;1.4. Compression&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgad8158b&quot;&gt;1.5. Archiving&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgdf68e67&quot;&gt;2. &amp;#x7528;&amp;#x6237;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgf16435f&quot;&gt;2.1. &amp;#x6DFB;&amp;#x52A0;&amp;#x3001;&amp;#x4FEE;&amp;#x6539;&amp;#x3001;&amp;#x5220;&amp;#x9664;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org3e76ccc&quot;&gt;2.2. &amp;#x767B;&amp;#x5F55;&amp;#x4FE1;&amp;#x606F;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org8d675fe&quot;&gt;3. &amp;#x7CFB;&amp;#x7EDF;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org21333fa&quot;&gt;3.1. &amp;#x786C;&amp;#x76D8;&amp;#x4F7F;&amp;#x7528;&amp;#x91CF;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgb39bc6e&quot;&gt;3.2. CPU &amp;#x65F6;&amp;#x95F4;&amp;#x4F7F;&amp;#x7528;&amp;#x91CF;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgf0fd427&quot;&gt;3.3. &amp;#x7CFB;&amp;#x7EDF;&amp;#x8D44;&amp;#x6E90;&amp;#x4F7F;&amp;#x7528;&amp;#x91CF;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org6593000&quot;&gt;3.4. &amp;#x8BA1;&amp;#x5212;&amp;#x4EFB;&amp;#x52A1;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgce4397a&quot;&gt;4. &amp;#x7F51;&amp;#x7EDC;&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org46cca44&quot;&gt;4.1. ip&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org538f0f2&quot;&gt;4.2. ifconfig&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orgb63793a&quot;&gt;4.3. networkmanager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org406df43&quot;&gt;4.4. write static ip&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org22d40b3&quot;&gt;4.5. network communication&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="shell" scheme="https://angry-bird.github.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Snippet</title>
    <link href="https://angry-bird.github.io/2017/10/18/snippet/"/>
    <id>https://angry-bird.github.io/2017/10/18/snippet/</id>
    <published>2017-10-18T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><p>Snipppet &#x662F;&#x975E;&#x5E38;&#x68D2;&#x7684;&#x4EE3;&#x7801;&#x7F16;&#x8F91;&#x5DE5;&#x5177;&#xFF0C;&#x80FD;&#x6781;&#x5927;&#x5730;&#x63D0;&#x9AD8;&#x4EE3;&#x7801;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x3002;Snippet &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x6BB5;&#x6E90;&#x4EE3;&#x7801;&#x6216;&#x6587;&#x5B57;&#xFF0C;&#x7531;&#x7F16;&#x8F91;&#x5668;&#x4EE5;&#x6A21;&#x5757;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x653E;&#x3001;&#x4EE5;&#x7D22;&#x5F15;&#x65B9;&#x5F0F;&#x8C03;&#x7528;&#x548C;&#x7BA1;&#x7406;&#x5B83;&#xFF0C;&#x8FBE;&#x5230;&#x5B9E;&#x9645;&#x5F00;&#x53D1;&#x4E2D;&#x7684;&#x590D;&#x7528;&#x3002;&#x5F00;&#x53D1;&#x8005;&#x5728;&#x7F16;&#x7A0B;&#x6216;&#x5199;&#x4F5C;&#x65F6;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x8F93;&#x5165; Snippet &#x540D;&#xFF08;&#x7D22;&#x5F15;&#x540D;&#xFF09;&#xFF0C;&#x5373;&#x53EF;&#x63D0;&#x4F9B;&#x8865;&#x5168;&#xFF08;&#x4EE5;&#x7D22;&#x5F15;&#x540D;&#x8C03;&#x7528;&#x6B64; Snippet&#xFF09;&#x9009;&#x9879;&#x3002;&#x5728; Emacs &#x4E2D;&#xFF0C;yassnippet &#x662F;&#x6211;&#x7528;&#x8FC7;&#x7684;&#x6700;&#x68D2;&#x7684;&#xFF0C;&#x6709;&#x4E86;&#x5B83;&#x518D;&#x4E5F;&#x4E0D;&#x6015;&#x7E41;&#x7410;&#x7684;&#x91CD;&#x590D;&#x6027;&#x5DE5;&#x4F5C;&#x4E86;&#x3002;</p><a id="more"></a><div id="outline-container-org17bb4bb" class="outline-2"><h2 id="org17bb4bb"><span class="section-number-2">1</span> yassnippet</h2><div class="outline-text-2" id="text-1"><p><a href="https://github.com/joaotavora/yasnippet%0A" target="_blank" rel="noopener">yassnippet</a> &#x5DF2;&#x7ECF;&#x662F; spacemacs &#x4E2D; auto-complete layer &#x81EA;&#x5E26;&#x7684; snippet &#x5DE5;&#x5177;&#x4E86;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x771F;&#x7684;&#x5F88;&#x68D2;&#x5440;&#xFF01;</p></div><div id="outline-container-orgaf56041" class="outline-3"><h3 id="orgaf56041"><span class="section-number-3">1.1</span> config</h3><div class="outline-text-3" id="text-1-1"><p>&#x5B89;&#x88C5;&#x5B8C; yassnippet&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4ECE;&#x5176;&#x4E0B; snippets/ &#x4E2D;&#x770B;&#x5230;&#x81EA;&#x5E26;&#x7684;&#x5927;&#x91CF; snippets&#xFF0C;&#x5F53;&#x7136;&#x4E5F;&#x5EFA;&#x8BAE;&#x81EA;&#x884C;&#x4FEE;&#x6539;&#x3001;&#x521B;&#x5EFA;&#x9002;&#x5408;&#x81EA;&#x5DF1;&#x7684; Snippet&#xFF0C;&#x5B58;&#x653E;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x76EE;&#x5F55;&#x4E0B;&#x3002;</p><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(setq yas-snippet-dirs</span><br><span class="line">      &apos;(&quot;~/.emacs.d/private/snippets&quot;</span><br><span class="line">        &quot;~/.emacs.d/elpa/yasnippet*/snippets&quot;</span><br><span class="line">        ))</span><br></pre></td></tr></table></figure></div><p>&#x5982;&#x679C;&#x662F; spacemacs &#x7528;&#x6237;&#xFF0C;&#x8FD9;&#x4E9B;&#x5168;&#x90FD;&#x662F;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#x4E86;</p><pre class="example">The following directories are added by default:- =~/.emacs.d/elpa/yasnippet-xxxxx/snippets=- =~/.emacs.d/layers/auto-completion/snippets=- =~/.emacs.d/private/snippets= (conditional to the value of =auto-completion-private-snippets-directory=)- =~/.spacemacs.d/snippets= (conditional to the existence of =~/.spacemacs.d= directory)</pre><p>&#x6211;&#x7684;.spacemacs &#x4E2D; auto-complete &#x8BBE;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;</p><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(auto-completion :variables</span><br><span class="line">                 auto-completion-return-key-behavior &apos;complete</span><br><span class="line">                 auto-completion-tab-key-behavior &apos;cycle</span><br><span class="line">                 auto-completion-complete-with-key-sequence nil</span><br><span class="line">                 auto-completion-complete-with-key-sequence-delay 0.1</span><br><span class="line">                 auto-completion-enable-snippets-in-popup t</span><br><span class="line">                 auto-completion-enable-help-tooltip t</span><br><span class="line">                 auto-completion-enable-sort-by-usage t</span><br><span class="line">                 )</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org719caec" class="outline-3"><h3 id="org719caec"><span class="section-number-3">1.2</span> snippets for org-mode</h3><div class="outline-text-3" id="text-1-2"></div><div id="outline-container-orga6810e9" class="outline-4"><h4 id="orga6810e9">head</h4><div class="outline-text-4" id="text-orga6810e9"><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- mode: snippet -*-</span><br><span class="line"># name: head</span><br><span class="line"># key: head_</span><br><span class="line"># --</span><br><span class="line">#+OPTIONS: ^:{} toc:2 num:t &lt;:nil c:nil \n:nil email:nil f:t todo:t date:nil timestamp:nil creator:nil author:nil</span><br><span class="line">#+BIND: org-html-validation-link nil</span><br><span class="line">#+STARTUP: indent align content latexpreview</span><br><span class="line">#+EXPORT_EXCLUDE_TAGS: noexport</span><br><span class="line">#+AUTHOR: zuoshi\thanks{This document is generated by Emacs org-mode.}</span><br><span class="line">#+TITLE:$1</span><br><span class="line">#+LATEX_CLASS: article</span><br><span class="line">#+LATEX_CLASS_OPTIONS: [12pt, a4paper]</span><br><span class="line">#+LATEX_HEADER: \usepackage[total={6in, 8in}]{geometry}</span><br><span class="line">#+LATEX_HEADER: \usepackage{xeCJK}</span><br><span class="line">#+LATEX_HEADER_EXTRA: \setCJKmainfont{Source Han Sans UI SC}</span><br><span class="line">#+LATEX_HEADER_EXTRA: \hypersetup{CJKbookmarks=true, colorlinks=true, linkcolor=magenta, urlcolor=blue, filecolor=green, citecolor=red, menucolor=cyan}</span><br><span class="line"># #+STARTUP: beamer</span><br><span class="line"># #+LATEX_HEADER: \usetheme{Warsaw}</span><br><span class="line"># #+LATEX_HEADER: \usecolortheme{whale}</span><br><span class="line">$0</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org3c8f910" class="outline-4"><h4 id="org3c8f910">tab</h4><div class="outline-text-4" id="text-org3c8f910"><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- mode: snippet -*-</span><br><span class="line"># name: tab</span><br><span class="line"># key: tab_</span><br><span class="line"># --</span><br><span class="line">#+CAPTION: $1</span><br><span class="line">#+NAME: tab:$2</span><br><span class="line">#+TBLFM:$3</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-org1c88bbc" class="outline-4"><h4 id="org1c88bbc">wtab</h4><div class="outline-text-4" id="text-org1c88bbc"><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- mode: snippet -*-</span><br><span class="line"># name: wtab</span><br><span class="line"># key: wtab_</span><br><span class="line"># --</span><br><span class="line">|-|-|-|</span><br><span class="line">|function |shortcuts | note|</span><br><span class="line">|-|-|-|</span><br><span class="line">|-|-|-|</span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orgdb4bdb0" class="outline-4"><h4 id="orgdb4bdb0">img</h4><div class="outline-text-4" id="text-orgdb4bdb0"><div class="org-src-container"><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># -*- mode: snippet -*-</span><br><span class="line"># name: img</span><br><span class="line"># key: img_</span><br><span class="line"># --</span><br><span class="line">#+CAPTION: $1</span><br><span class="line">#+NAME: img:$2</span><br></pre></td></tr></table></figure></div></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;p&gt;
Snipppet &amp;#x662F;&amp;#x975E;&amp;#x5E38;&amp;#x68D2;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x7F16;&amp;#x8F91;&amp;#x5DE5;&amp;#x5177;&amp;#xFF0C;&amp;#x80FD;&amp;#x6781;&amp;#x5927;&amp;#x5730;&amp;#x63D0;&amp;#x9AD8;&amp;#x4EE3;&amp;#x7801;&amp;#x5F00;&amp;#x53D1;&amp;#x6548;&amp;#x7387;&amp;#x3002;Snippet &amp;#x5176;&amp;#x5B9E;&amp;#x5C31;&amp;#x662F;&amp;#x4E00;&amp;#x6BB5;&amp;#x6E90;&amp;#x4EE3;&amp;#x7801;&amp;#x6216;&amp;#x6587;&amp;#x5B57;&amp;#xFF0C;&amp;#x7531;&amp;#x7F16;&amp;#x8F91;&amp;#x5668;&amp;#x4EE5;&amp;#x6A21;&amp;#x5757;&amp;#x7684;&amp;#x5F62;&amp;#x5F0F;&amp;#x5B58;&amp;#x653E;&amp;#x3001;&amp;#x4EE5;&amp;#x7D22;&amp;#x5F15;&amp;#x65B9;&amp;#x5F0F;&amp;#x8C03;&amp;#x7528;&amp;#x548C;&amp;#x7BA1;&amp;#x7406;&amp;#x5B83;&amp;#xFF0C;&amp;#x8FBE;&amp;#x5230;&amp;#x5B9E;&amp;#x9645;&amp;#x5F00;&amp;#x53D1;&amp;#x4E2D;&amp;#x7684;&amp;#x590D;&amp;#x7528;&amp;#x3002;&amp;#x5F00;&amp;#x53D1;&amp;#x8005;&amp;#x5728;&amp;#x7F16;&amp;#x7A0B;&amp;#x6216;&amp;#x5199;&amp;#x4F5C;&amp;#x65F6;&amp;#xFF0C;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x8F93;&amp;#x5165; Snippet &amp;#x540D;&amp;#xFF08;&amp;#x7D22;&amp;#x5F15;&amp;#x540D;&amp;#xFF09;&amp;#xFF0C;&amp;#x5373;&amp;#x53EF;&amp;#x63D0;&amp;#x4F9B;&amp;#x8865;&amp;#x5168;&amp;#xFF08;&amp;#x4EE5;&amp;#x7D22;&amp;#x5F15;&amp;#x540D;&amp;#x8C03;&amp;#x7528;&amp;#x6B64; Snippet&amp;#xFF09;&amp;#x9009;&amp;#x9879;&amp;#x3002;&amp;#x5728; Emacs &amp;#x4E2D;&amp;#xFF0C;yassnippet &amp;#x662F;&amp;#x6211;&amp;#x7528;&amp;#x8FC7;&amp;#x7684;&amp;#x6700;&amp;#x68D2;&amp;#x7684;&amp;#xFF0C;&amp;#x6709;&amp;#x4E86;&amp;#x5B83;&amp;#x518D;&amp;#x4E5F;&amp;#x4E0D;&amp;#x6015;&amp;#x7E41;&amp;#x7410;&amp;#x7684;&amp;#x91CD;&amp;#x590D;&amp;#x6027;&amp;#x5DE5;&amp;#x4F5C;&amp;#x4E86;&amp;#x3002;
&lt;/p&gt;
    
    </summary>
    
      <category term="emacs" scheme="https://angry-bird.github.io/categories/emacs/"/>
    
    
      <category term="emacs" scheme="https://angry-bird.github.io/tags/emacs/"/>
    
      <category term="yasnippet" scheme="https://angry-bird.github.io/tags/yasnippet/"/>
    
  </entry>
  
  <entry>
    <title>Rime custom</title>
    <link href="https://angry-bird.github.io/2017/10/17/rime-custom/"/>
    <id>https://angry-bird.github.io/2017/10/17/rime-custom/</id>
    <published>2017-10-17T00:00:00.000Z</published>
    <updated>2018-05-11T12:32:44.000Z</updated>
    
    <content type="html"><![CDATA[<div id="content"><div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul><li><a href="#orgdc0e77b">1. About Rime</a></li><li><a href="#org6a4960e">2. ibus-rime</a><ul><li><a href="#org843a752">2.1. installation</a></li><li><a href="#org02fa2b1">2.2. issues</a></li></ul></li><li><a href="#org2c86aeb">3. squirrel</a><ul><li><a href="#org1530b0a">3.1. <code>squirrel.custom.yaml</code></a></li><li><a href="#orge67b1c8">3.2. modified color scheme</a></li><li><a href="#org1917650">3.3. <code>luna_pinyin.custom.yaml</code></a></li></ul></li></ul></div></div><a id="more"></a><div id="outline-container-orgdc0e77b" class="outline-2"><h2 id="orgdc0e77b"><span class="section-number-2">1</span> About Rime</h2><div class="outline-text-2" id="text-1"><p>Rime is the best chinese input method that I have ever met. It can be customized according to my habits and perferred settings.</p></div></div><div id="outline-container-org6a4960e" class="outline-2"><h2 id="org6a4960e"><span class="section-number-2">2</span> ibus-rime</h2><div class="outline-text-2" id="text-2"></div><div id="outline-container-org843a752" class="outline-3"><h3 id="org843a752"><span class="section-number-3">2.1</span> installation</h3><div class="outline-text-3" id="text-2-1"><p><code>fcitx-rime</code> is a better choice for vim users. But <code>ibus-rime</code> is more stable and updated.</p><div class="org-src-container"><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install ibus ibus-rime fcitx-rime</span><br></pre></td></tr></table></figure></div><p><code>~/.config/ibus/rime</code> is <code>ibus-rime</code>&apos;s default config file path. It&apos;s recommended to use <code>*.custom.yaml</code> to save user&apos;s own configuration instead of modifying default files.</p></div></div><div id="outline-container-org02fa2b1" class="outline-3"><h3 id="org02fa2b1"><span class="section-number-3">2.2</span> issues</h3><div class="outline-text-3" id="text-2-2"><p>Run <code>ibus-setup</code> to set pannel and candidate preference, for <code>ibus-rime</code> having no permissions to modify <code>ibus</code> configuration.</p><p>If <code>ibus-rime</code> is missing in system tray, check <code>/usr/share/ibus-rime/icons/zhung.svg</code>. Copy it as zhung.png, then open and save as zhung.svg.</p></div></div></div><div id="outline-container-org2c86aeb" class="outline-2"><h2 id="org2c86aeb"><span class="section-number-2">3</span> squirrel</h2><div class="outline-text-2" id="text-3"><p>MacOS version of rime is named <code>squirrel</code>, and with <code>fcitx-remote-for-osx</code> it become an amazing input-method.</p></div><div id="outline-container-org1530b0a" class="outline-3"><h3 id="org1530b0a"><span class="section-number-3">3.1</span> <code>squirrel.custom.yaml</code></h3><div class="outline-text-3" id="text-3-1"><div class="org-src-container"><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">patch:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># us_keyboard_layout: true</span></span><br><span class="line"><span class="attr">  show_notifications_when:</span> <span class="string">appropriate</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">## disable chinese character input as defaut</span></span><br><span class="line">  <span class="string">app_options/com.runningwithcrayons.Alfred-3:</span></span><br><span class="line"><span class="attr">    ascii_mode:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># app_options/org.gnu.Emacs :</span></span><br><span class="line">  <span class="comment">#   ascii_mode: true</span></span><br><span class="line">  <span class="string">app_options/com.tencent.qq:</span> <span class="string">{}</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">## other color schemes aqua&#xFF0C;azure&#xFF0C;luna, ink, starcraft, solarized_rock, dark_temple</span></span><br><span class="line">  <span class="comment"># style/color_scheme : lost_temple</span></span><br><span class="line">  <span class="comment"># style/color_scheme : clean_white</span></span><br><span class="line">  <span class="string">style/color_scheme</span> <span class="string">:</span> <span class="string">google</span></span><br><span class="line">  <span class="string">style/horizontal</span> <span class="string">:</span> <span class="literal">false</span></span><br><span class="line">  <span class="string">style/inline_preedit</span> <span class="string">:</span> <span class="literal">false</span></span><br><span class="line">  <span class="string">style/corner_radius</span> <span class="string">:</span> <span class="number">3</span></span><br><span class="line">  <span class="string">style/border_height</span> <span class="string">:</span> <span class="number">4</span></span><br><span class="line">  <span class="string">style/border_width</span> <span class="string">:</span> <span class="number">4</span></span><br><span class="line">  <span class="string">style/line_spacing</span> <span class="string">:</span> <span class="number">1</span></span><br><span class="line">  <span class="string">style/spacing</span> <span class="string">:</span> <span class="number">5</span></span><br><span class="line">  <span class="string">style/font_point</span> <span class="string">:</span> <span class="number">20</span></span><br><span class="line">  <span class="string">style/font_face</span> <span class="string">:</span> <span class="string">&quot;Hiragino Sans GB W3&quot;</span></span><br></pre></td></tr></table></figure></div></div></div><div id="outline-container-orge67b1c8" class="outline-3"><h3 id="orge67b1c8"><span class="section-number-3">3.2</span> modified color scheme</h3><div class="outline-text-3" id="text-3-2"><pre class="example">patch:  # us_keyboard_layout: true  show_notifications_when: appropriate  style:    color_scheme: apathy  preset_color_schemes:    apathy:      name: &quot;&#x51B7;&#x6F20; / Apathy&quot;      author: &quot;LIANG Hai &quot;      horizontal: true  # &#x6C34;&#x5E73;&#x6392;&#x5217;      inline_preedit: true #&#x5355;&#x884C;&#x663E;&#x793A;&#xFF0C;false &#x53CC;&#x884C;&#x663E;&#x793A;      candidate_format: &quot;%c\u2005%@\u2005&quot;  # &#x7528; 1/6 em &#x7A7A;&#x683C; U+2005 &#x6765;&#x63A7;&#x5236;&#x7F16;&#x53F7; %c &#x548C;&#x5019;&#x9009;&#x8BCD; %@ &#x524D;&#x540E;&#x7684;&#x7A7A;&#x95F4;&#x3002;      corner_radius: 5  #&#x5019;&#x9009;&#x6761;&#x5706;&#x89D2;      border_height: 6                                   # &#x7A97;&#x53E3;&#x8FB9;&#x754C;&#x9AD8;&#x5EA6;&#xFF0C;&#x5927;&#x4E8E;&#x5706;&#x89D2;&#x534A;&#x5F84;&#x624D;&#x751F;&#x6548;      border_width: 6                                    # &#x7A97;&#x53E3;&#x8FB9;&#x754C;&#x5BBD;&#x5EA6;&#xFF0C;&#x5927;&#x4E8E;&#x5706;&#x89D2;&#x534A;&#x5F84;&#x624D;&#x751F;&#x6548;      back_color: 0xFFFFFF  #&#x5019;&#x9009;&#x6761;&#x80CC;&#x666F;&#x8272;      border_color: 0xE0B693                             # &#x8FB9;&#x6846;&#x8272;      font_face: &quot;.AdobeSHSDeskSC-Regular&quot;  #&#x5019;&#x9009;&#x8BCD;&#x5B57;&#x4F53;      font_point: 16  #&#x5019;&#x9009;&#x5B57;&#x8BCD;&#x5927;&#x5C0F;      text_color: 0x424242  #&#x9AD8;&#x4EAE;&#x9009;&#x4E2D;&#x8BCD;&#x989C;&#x8272;      label_font_face: &quot;SourceCodePro-Regular&quot;   #&#x5019;&#x9009;&#x8BCD;&#x7F16;&#x53F7;&#x5B57;&#x4F53;      label_font_point: 13   #&#x5019;&#x9009;&#x7F16;&#x53F7;&#x5927;&#x5C0F;      label_color: 0x9e9e9e                              # &#x9884;&#x9009;&#x680F;&#x7F16;&#x53F7;&#x989C;&#x8272;      candidate_text_color: 0x000000                     # &#x9884;&#x9009;&#x9879;&#x6587;&#x5B57;&#x989C;&#x8272;      text_color: 0x9e9e9e                               # &#x62FC;&#x97F3;&#x884C;&#x6587;&#x5B57;&#x989C;&#x8272;&#xFF0C;24 &#x4F4D;&#x8272;&#x503C;&#xFF0C;16 &#x8FDB;&#x5236;&#xFF0C;BGR &#x987A;&#x5E8F;      comment_text_color: 0x999999                       # &#x62FC;&#x97F3;&#x7B49;&#x63D0;&#x793A;&#x6587;&#x5B57;&#x989C;&#x8272;      hilited_text_color: 0x9e9e9e                       # &#x9AD8;&#x4EAE;&#x62FC;&#x97F3; (&#x9700;&#x8981;&#x5F00;&#x542F;&#x5185;&#x5D4C;&#x7F16;&#x7801;)      hilited_candidate_text_color: 0x000000             # &#x7B2C;&#x4E00;&#x5019;&#x9009;&#x9879;&#x6587;&#x5B57;&#x989C;&#x8272;      hilited_candidate_back_color: 0xfff0e4             # &#x7B2C;&#x4E00;&#x5019;&#x9009;&#x9879;&#x80CC;&#x666F;&#x80CC;&#x666F;&#x8272;      hilited_candidate_label_color: 0x9e9e9e            # &#x7B2C;&#x4E00;&#x5019;&#x9009;&#x9879;&#x7F16;&#x53F7;&#x989C;&#x8272;      hilited_comment_text_color: 0x9e9e9e               # &#x6CE8;&#x89E3;&#x6587;&#x5B57;&#x9AD8;&#x4EAE;  &quot;app_options/com.runningwithcrayons.Alfred-3/ascii_mode&quot;: true  # &quot;app_options/org.gnu.Emacs/ascii_mode&quot;: true</pre></div></div><div id="outline-container-org1917650" class="outline-3"><h3 id="org1917650"><span class="section-number-3">3.3</span> <code>luna_pinyin.custom.yaml</code></h3><div class="outline-text-3" id="text-3-3"><div class="org-src-container"><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># luna_pinyin.custom.yaml</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#x88DC;&#x976A;&#x529F;&#x80FD;&#xFF1A;&#x5C07;&#x6719;&#x6708;&#x62FC;&#x97F3;&#x7684;&#x8A5E;&#x5EAB;&#x4FEE;&#x6539;&#x7232;&#x6719;&#x6708;&#x62FC;&#x97F3;&#x64F4;&#x5145;&#x8A5E;&#x5EAB;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#x4F5C;&#x8005;&#xFF1A;&#x747E;&#x6600; &lt;cokunhui@gmail.com&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#x6CE8;&#x610F;&#xFF1A;&#x672C;&#x88DC;&#x976A;&#x9069;&#x7528;&#x65BC;&#x6240;&#x6709;&#x6719;&#x6708;&#x62FC;&#x97F3;&#x7CFB;&#x5217;&#x65B9;&#x6848;&#xFF08;&#x300C;&#x6719;&#x6708;&#x62FC;&#x97F3;&#x300D;&#x3001;&#x300C;&#x6719;&#x6708;&#x62FC;&#x97F3;&#xB7;&#x7B80;&#x5316;&#x5B57;&#x300D;&#x3001;&#x300C;&#x6719;&#x6708;&#x62FC;&#x97F3;&#xB7;&#x81FA;&#x7063;&#x6B63;&#x9AD4;&#x300D;&#x3001;&#x300C;&#x6719;&#x6708;&#x62FC;&#x97F3;&#xB7;&#x8A9E;&#x53E5;&#x6D41;&#x300D;&#xFF09;&#x3002;</span></span><br><span class="line"><span class="comment"># &#x53EA;&#x9808;&#x5C07;&#x672C; custom.yaml &#x7684;&#x524D;&#x9762;&#x540D;&#x5B57;&#x6539;&#x7232;&#x5C0D;&#x61C9;&#x7684;&#x8F38;&#x5165;&#x65B9;&#x6848;&#x540D;&#x5B57;&#x7136;&#x5F8C;&#x653E;&#x5165;&#x7528;&#x6236;&#x6587;&#x4EF6;&#x593E;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x5373;&#x53EF;&#x3002;&#x5982; luna_pinyin_simp.custom.yaml&#x3002;</span></span><br><span class="line"><span class="comment"># &#x96D9;&#x62FC;&#x7528;&#x6236;&#x8ACB;&#x4F7F;&#x7528; double_pinyin.custom.yaml&#x3002;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#x9644;&#x6719;&#x6708;&#x62FC;&#x97F3;&#x7CFB;&#x5217;&#x65B9;&#x6848;&#x8207;&#x5176;&#x5C0D;&#x61C9;&#x7684; id &#x4E00;&#x89BD;&#x8868;&#xFF1A;</span></span><br><span class="line"><span class="comment"># &#x8F38;&#x5165;&#x65B9;&#x6848;id</span></span><br><span class="line"><span class="comment"># &#x6719;&#x6708;&#x62FC;&#x97F3;luna_pinyin</span></span><br><span class="line"><span class="comment"># &#x6719;&#x6708;&#x62FC;&#x97F3;&#xB7;&#x7B80;&#x5316;&#x5B57;luna_pinyin_simp</span></span><br><span class="line"><span class="comment"># &#x6719;&#x6708;&#x62FC;&#x97F3;&#xB7;&#x81FA;&#x7063;&#x6B63;&#x9AD4;luna_pinyin_tw</span></span><br><span class="line"><span class="comment"># &#x6719;&#x6708;&#x62FC;&#x97F3;&#xB7;&#x8A9E;&#x53E5;&#x6D41;luna_pinyin_fluency</span></span><br><span class="line"></span><br><span class="line"><span class="attr">patch:</span></span><br><span class="line"><span class="attr">  switches:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">ascii_mode</span></span><br><span class="line"><span class="attr">      reset:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">      states:</span> <span class="string">[&quot;&#x4E2D;&#x6587;&quot;,</span> <span class="string">&quot;&#x897F;&#x6587;&quot;</span><span class="string">]</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">full_shape</span></span><br><span class="line"><span class="attr">      states:</span> <span class="string">[&quot;&#x534A;&#x89D2;&quot;,</span> <span class="string">&quot;&#x5168;&#x89D2;&quot;</span><span class="string">]</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">zh_simp</span>                      <span class="comment"># (&#x203B;1) &#x7E41;&#x7B80;&#x8F6C;&#x6362;</span></span><br><span class="line"><span class="attr">      reset:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">      states:</span> <span class="string">[&quot;&#x6F22;&#x5B57;&quot;,</span> <span class="string">&quot;&#x6C49;&#x5B57;&quot;</span><span class="string">]</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">ascii_punct</span></span><br><span class="line"><span class="attr">      states:</span> <span class="string">[&quot;&#x3002;&#xFF0C;&quot;,</span> <span class="string">&quot;&#xFF0E;&#xFF0C;&quot;</span><span class="string">]</span></span><br><span class="line"><span class="comment">#    - options: [&quot;utf8&quot;, &quot;gbk&quot;, &quot;gb2312&quot;] # (&#x203B;2)&#x5B57;&#x7B26;&#x96C6;&#x9009;&#x5355;</span></span><br><span class="line"><span class="comment">#      reset: 0                           #     &#x9ED8;&#x8BA4; UTF8</span></span><br><span class="line"><span class="comment">#      states:</span></span><br><span class="line"><span class="comment">#        - UTF-8</span></span><br><span class="line"><span class="comment">#        - GBK</span></span><br><span class="line"><span class="comment">#        - GB2312</span></span><br><span class="line"><span class="attr">  simplifier:</span></span><br><span class="line"><span class="attr">    option_name:</span> <span class="string">zh_simp</span></span><br><span class="line"></span><br><span class="line">  <span class="string">engine/filters:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">simplifier</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">uniquifier</span></span><br><span class="line"><span class="comment">#      - charset_filter@gbk               # (&#x203B;3) GBK &#x8FC7;&#x6EE4;</span></span><br><span class="line"><span class="comment">#  &#x7DE8;&#x8B6F;&#x7248;&#x672C;&#x7684;&#x9F20;&#x9B1A;&#x7BA1;&#x53EF;&#x4EE5;&#x53BB;&#x6389;&#x4E0A;&#x9762;&#x5E7E;&#x884C;&#x7684;&#x8A3B;&#x91CB;&#x7B26;&#x865F;&#xFF0C;&#x5553;&#x7528;&#x5B57;&#x7B26;&#x96C6;&#x904E;&#x6FFE;&#x529F;&#x80FD;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;speller/algebra/@before 0&quot;</span><span class="string">:</span> <span class="string">xform/^([b-df-hj-np-tv-z])$/$1_/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x52A0;&#x8F09; easy_en &#x4F9D;&#x8CF4;</span></span><br><span class="line">  <span class="string">&quot;schema/dependencies/@next&quot;</span><span class="string">:</span> <span class="string">easy_en</span></span><br><span class="line"><span class="comment"># &#x8F09;&#x5165;&#x7FFB;&#x8B6F;&#x82F1;&#x6587;&#x7684;&#x78BC;&#x8868;&#x7FFB;&#x8B6F;&#x5668;&#xFF0C;&#x53D6;&#x540D;&#x7232; english</span></span><br><span class="line">  <span class="string">&quot;engine/translators/@next&quot;</span><span class="string">:</span> <span class="string">table_translator@english</span></span><br><span class="line"><span class="comment"># english &#x7FFB;&#x8B6F;&#x5668;&#x7684;&#x8A2D;&#x5B9A;&#x9805;</span></span><br><span class="line"><span class="attr">  english:</span></span><br><span class="line"><span class="attr">    dictionary:</span> <span class="string">easy_en</span></span><br><span class="line"><span class="attr">    spelling_hints:</span> <span class="number">9</span></span><br><span class="line"><span class="attr">    enable_completion:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    enable_sentence:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    initial_quality:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  &#x8F09;&#x5165;&#x6719;&#x6708;&#x62FC;&#x97F3;&#x64F4;&#x5145;&#x8A5E;&#x5EAB;</span></span><br><span class="line">  <span class="string">&quot;translator/dictionary&quot;</span><span class="string">:</span> <span class="string">luna_pinyin.extended</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  &#x7B26;&#x53F7;&#x5FEB;&#x901F;&#x8F93;&#x5165;&#x548C;&#x90E8;&#x5206;&#x7B26;&#x53F7;&#x7684;&#x5FEB;&#x901F;&#x4E0A;&#x5C4F;</span></span><br><span class="line"><span class="attr">  punctuator:</span></span><br><span class="line"><span class="attr">    import_preset:</span> <span class="string">symbols</span></span><br><span class="line"><span class="attr">    symbols:</span></span><br><span class="line">      <span class="string">&quot;/fs&quot;</span><span class="string">:</span> <span class="string">[&#xBD;,</span> <span class="string">&#x2030;,</span> <span class="string">&#xBC;,</span> <span class="string">&#x2153;,</span> <span class="string">&#x2154;,</span> <span class="string">&#xBE;,</span> <span class="string">&#x2152;</span> <span class="string">]</span></span><br><span class="line">      <span class="string">&quot;/bq&quot;</span><span class="string">:</span> <span class="string">[&#x1F602;&#xFE0F;,</span> <span class="string">&#x1F605;&#xFE0F;,</span> <span class="string">&#x263A;&#xFE0F;,</span> <span class="string">&#x1F631;&#xFE0F;,</span> <span class="string">&#x1F62D;&#xFE0F;,</span> <span class="string">&#x1F607;&#xFE0F;,</span> <span class="string">&#x1F643;&#xFE0F;,</span> <span class="string">&#x1F914;&#xFE0F;,</span> <span class="string">&#x1F48A;&#xFE0F;,</span> <span class="string">&#x1F4AF;&#xFE0F;,</span> <span class="string">&#x1F44D;&#xFE0F;,</span> <span class="string">&#x1F648;&#xFE0F;,</span> <span class="string">&#x1F4A9;&#xFE0F;,</span> <span class="string">&#x1F608;&#xFE0F;</span> <span class="string">]</span></span><br><span class="line">      <span class="string">&quot;/dn&quot;</span><span class="string">:</span> <span class="string">[&#x2318;,</span> <span class="string">&#x2325;,</span> <span class="string">&#x21E7;,</span> <span class="string">&#x2303;,</span> <span class="string">&#x238B;,</span> <span class="string">&#x21EA;,</span> <span class="string">&#xF8FF;,</span> <span class="string">&#x232B;,</span> <span class="string">&#x2326;,</span> <span class="string">&#x21A9;&#xFE0E;,</span> <span class="string">&#x23CE;,</span> <span class="string">&#x2191;,</span> <span class="string">&#x2193;,</span> <span class="string">&#x2190;,</span> <span class="string">&#x2192;,</span> <span class="string">&#x2196;,</span> <span class="string">&#x2198;,</span> <span class="string">&#x21DF;,</span> <span class="string">&#x21DE;]</span></span><br><span class="line">      <span class="string">&quot;/fh&quot;</span><span class="string">:</span> <span class="string">[</span> <span class="string">&#x2022;,</span> <span class="string">&#x266A;,</span> <span class="string">&#xA9;,</span> <span class="string">&#x262D;,</span> <span class="string">&#x262E;,</span> <span class="string">&#x2720;,</span> <span class="string">&#x269C;,</span> <span class="string">&#x269B;,</span> <span class="string">&#x2624;,</span> <span class="string">&#x262F;,</span> <span class="string">&#xAE;,</span> <span class="string">&#x2117;,</span> <span class="string">&#x2120;,</span> <span class="string">&#x2122;,</span> <span class="string">&#x2121;,</span> <span class="string">&#x2421;,</span> <span class="string">&#x2642;,</span> <span class="string">&#x2640;,</span> <span class="string">&#x2609;,</span> <span class="string">&#x260A;,</span> <span class="string">&#x260B;,</span> <span class="string">&#x260C;,</span> <span class="string">&#x260D;,</span> <span class="string">&#x2610;,</span> <span class="string">&#x2611;&#xFE0E;,</span> <span class="string">&#x2612;,</span> <span class="string">&#x261C;,</span> <span class="string">&#x261D;,</span> <span class="string">&#x261E;,</span> <span class="string">&#x261F;,</span> <span class="string">&#x270E;,</span> <span class="string">&#x2704;,</span> <span class="string">&#x2672;,</span> <span class="string">&#x267B;,</span> <span class="string">&#x2690;,</span> <span class="string">&#x2691;,</span> <span class="string">&#x26A0;]</span></span><br><span class="line">      <span class="string">&quot;/xh&quot;</span><span class="string">:</span> <span class="string">[</span> <span class="string">&#xFF0A;,</span> <span class="string">&#xD7;,</span> <span class="string">&#x2731;,</span> <span class="string">&#x2605;,</span> <span class="string">&#x2606;,</span> <span class="string">&#x2729;,</span> <span class="string">&#x2727;,</span> <span class="string">&#x274B;,</span> <span class="string">&#x274A;,</span> <span class="string">&#x2749;,</span> <span class="string">&#x2748;,</span> <span class="string">&#x2745;,</span> <span class="string">&#x273F;,</span> <span class="string">&#x2732;]</span></span><br><span class="line"><span class="attr">    half_shape:</span></span><br><span class="line">      <span class="string">&quot;#&quot;</span><span class="string">:</span> <span class="string">&quot;#&quot;</span></span><br><span class="line">      <span class="string">&quot;*&quot;</span><span class="string">:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="string">&quot;`&quot;</span><span class="string">:</span> <span class="string">&quot;`&quot;</span></span><br><span class="line">      <span class="string">&quot;~&quot;</span><span class="string">:</span> <span class="string">&quot;~&quot;</span></span><br><span class="line">      <span class="string">&quot;@&quot;</span><span class="string">:</span> <span class="string">&quot;@&quot;</span></span><br><span class="line">      <span class="string">&quot;=&quot;</span><span class="string">:</span> <span class="string">&quot;=&quot;</span></span><br><span class="line">      <span class="string">&quot;/&quot;</span><span class="string">:</span> <span class="string">[&quot;/&quot;,</span> <span class="string">&quot;&#xF7;&quot;</span><span class="string">,]</span></span><br><span class="line">      <span class="string">&apos;\&apos;: &quot;&#x3001;&quot;</span></span><br><span class="line"><span class="string">      &quot;_&quot; : &quot;&#x2500;&#x2500;&quot;</span></span><br><span class="line"><span class="string">      &quot;&apos;</span><span class="string">&quot;: {pair: [&quot;</span><span class="string">&#x300C;&quot;,</span> <span class="string">&quot;&#x300D;&quot;</span><span class="string">]}</span></span><br><span class="line">      <span class="string">&quot;[&quot;</span><span class="string">:</span> <span class="string">[&quot;&#x3010;&quot;,</span> <span class="string">&quot;[&quot;</span><span class="string">]</span></span><br><span class="line">      <span class="string">&quot;]&quot;</span><span class="string">:</span> <span class="string">[&quot;&#x3011;&quot;,</span> <span class="string">&quot;]&quot;</span><span class="string">]</span></span><br><span class="line">      <span class="string">&quot;$&quot;</span><span class="string">:</span> <span class="string">[&quot;&#xA5;&quot;,</span> <span class="string">&quot;$&quot;</span><span class="string">,</span> <span class="string">&quot;&#x20AC;&quot;</span><span class="string">,</span> <span class="string">&quot;&#xA3;&quot;</span><span class="string">,</span> <span class="string">&quot;&#xA2;&quot;</span><span class="string">,</span> <span class="string">&quot;&#xA4;&quot;</span><span class="string">]</span></span><br><span class="line">      <span class="string">&quot;&lt;&quot;</span><span class="string">:</span> <span class="string">[&quot;&#x300A;&quot;,</span> <span class="string">&quot;&#x3008;&quot;</span><span class="string">,</span> <span class="string">&quot;&#xAB;&quot;</span><span class="string">,</span> <span class="string">&quot;&lt;&quot;</span><span class="string">]</span></span><br><span class="line">      <span class="string">&quot;&gt;&quot;</span><span class="string">:</span> <span class="string">[&quot;&#x300B;&quot;,</span> <span class="string">&quot;&#x3009;&quot;</span><span class="string">,</span> <span class="string">&quot;&#xBB;&quot;</span><span class="string">,</span> <span class="string">&quot;&gt;&quot;</span><span class="string">]</span></span><br><span class="line">  <span class="string">recognizer/patterns/punct:</span> <span class="string">&quot;^/([a-z]+|[0-9]0?)$&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x6A21;&#x7CCA;&#x62FC;&#x97F3;</span></span><br><span class="line">  <span class="string">&apos;speller/algebra&apos;</span><span class="string">:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">erase/^xx$/</span>                      <span class="comment"># &#x7B2C;&#x4E00;&#x884C;&#x4FDD;&#x7559;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x6A21;&#x7CCA;&#x97F3;&#x5B9A;&#x7FA9;</span></span><br><span class="line">    <span class="comment"># &#x9700;&#x8981;&#x54EA;&#x7D44;&#x5C31;&#x522A;&#x53BB;&#x884C;&#x9996;&#x7684; # &#x865F;&#xFF0C;&#x55AE;&#x96D9;&#x5411;&#x4EFB;&#x9078;</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/^([zcs])h/$1/</span>             <span class="comment"># zh, ch, sh =&gt; z, c, s</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/^([zcs])([^h])/$1h$2/</span>     <span class="comment"># z, c, s =&gt; zh, ch, sh</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/^n/l/</span>                     <span class="comment"># n =&gt; l</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/^l/n/</span>                     <span class="comment"># l =&gt; n</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x9019;&#x5169;&#x7D44;&#x4E00;&#x822C;&#x662F;&#x55AE;&#x5411;&#x7684;</span></span><br><span class="line">    <span class="comment">#- derive/^r/l/                     # r =&gt; l</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#- derive/^ren/yin/                 # ren =&gt; yin, reng =&gt; ying</span></span><br><span class="line">    <span class="comment">#- derive/^r/y/                     # r =&gt; y</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x4E0B;&#x9762; hu &lt;=&gt; f &#x9019;&#x7D44;&#x5BEB;&#x6CD5;&#x8907;&#x96DC;&#x4E00;&#x4E9B;&#xFF0C;&#x5206;&#x60C5;&#x6CC1;&#x8A0E;&#x8AD6;</span></span><br><span class="line">    <span class="comment">#- derive/^hu$/fu/                  # hu =&gt; fu</span></span><br><span class="line">    <span class="comment">#- derive/^hong$/feng/              # hong =&gt; feng</span></span><br><span class="line">    <span class="comment">#- derive/^hu([in])$/fe$1/          # hui =&gt; fei, hun =&gt; fen</span></span><br><span class="line">    <span class="comment">#- derive/^hu([ao])/f$1/            # hua =&gt; fa, ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#- derive/^fu$/hu/                  # fu =&gt; hu</span></span><br><span class="line">    <span class="comment">#- derive/^feng$/hong/              # feng =&gt; hong</span></span><br><span class="line">    <span class="comment">#- derive/^fe([in])$/hu$1/          # fei =&gt; hui, fen =&gt; hun</span></span><br><span class="line">    <span class="comment">#- derive/^f([ao])/hu$1/            # fa =&gt; hua, ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x97FB;&#x6BCD;&#x90E8;&#x4EFD;</span></span><br><span class="line">    <span class="comment">#- derive/^([bpmf])eng$/$1ong/      # meng = mong, ...</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/([ei])n$/$1ng/</span>            <span class="comment"># en =&gt; eng, in =&gt; ing</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/([ei])ng$/$1n/</span>            <span class="comment"># eng =&gt; en, ing =&gt; in</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x6A23;&#x4F8B;&#x8DB3;&#x5920;&#x4E86;&#xFF0C;&#x5176;&#x4ED6;&#x8ACB;&#x81EA;&#x5DF1;&#x7E3D;&#x7D50;&#x2026;&#x2026;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x6A21;&#x7CCA;&#x97F3;&#x5B9A;&#x7FA9;&#x5148;&#x65BC;&#x7C21;&#x62FC;&#x5B9A;&#x7FA9;&#xFF0C;&#x65B9;&#x53EF;&#x4EE4;&#x7C21;&#x62FC;&#x652F;&#x6301;&#x4EE5;&#x4E0A;&#x6A21;&#x7CCA;&#x97F3;</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">abbrev/^([a-z]).+$/$1/</span>           <span class="comment"># &#x7C21;&#x62FC;&#xFF08;&#x9996;&#x5B57;&#x6BCD;&#xFF09;</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">abbrev/^([zcs]h).+$/$1/</span>          <span class="comment"># &#x7C21;&#x62FC;&#xFF08;zh, ch, sh&#xFF09;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x7D44;&#x5BB9;&#x932F;&#x62FC;&#x5BEB;&#xFF0C;&#x300A;&#x6F22;&#x8A9E;&#x62FC;&#x97F3;&#x300B;&#x65B9;&#x6848;&#x4EE5;&#x524D;&#x8005;&#x7232;&#x6B63;</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/^([nl])ve$/$1ue/</span>          <span class="comment"># nve = nue, lve = lue</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/^([jqxy])u/$1v/</span>           <span class="comment"># ju = jv,</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/un$/uen/</span>                  <span class="comment"># gun = guen,</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/ui$/uei/</span>                  <span class="comment"># gui = guei,</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/iu$/iou/</span>                  <span class="comment"># jiu = jiou,</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x81EA;&#x52D5;&#x7CFE;&#x6B63;&#x4E00;&#x4E9B;&#x5E38;&#x898B;&#x7684;&#x6309;&#x9375;&#x932F;&#x8AA4;</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/([aeiou])ng$/$1gn/</span>        <span class="comment"># dagn =&gt; dang</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/([dtngkhrzcs])o(u|ng)$/$1o/</span>  <span class="comment"># zho =&gt; zhong|zhou</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/ong$/on/</span>                  <span class="comment"># zhonguo =&gt; zhong guo</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/ao$/oa/</span>                   <span class="comment"># hoa =&gt; hao</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/ua$/au/</span>                   <span class="comment"># shau =&gt; shua</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">derive/([iu])a(o|ng?)$/a$1$2/</span>    <span class="comment"># tain =&gt; tian</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x5206;&#x5C16;&#x5718;&#x5F8C; v =&gt; &#xFC; &#x7684;&#x6539;&#x5BEB;&#x689D;&#x4EF6;&#x4E5F;&#x8981;&#x76F8;&#x61C9;&#x5730;&#x64F4;&#x5145;&#xFF1A;</span></span><br><span class="line">    <span class="comment">#&apos;translator/preedit_format&apos;:</span></span><br><span class="line">   <span class="comment">#  - &quot;xform/([nljqxyzcs])v/$1&#xFC;/&quot;</span></span><br></pre></td></tr></table></figure></div></div></div></div></div><div id="postamble" class="status"><p class="validation"></p></div>]]></content>
    
    <summary type="html">
    
      &lt;div id=&quot;content&quot;&gt;
&lt;div id=&quot;table-of-contents&quot;&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id=&quot;text-table-of-contents&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#orgdc0e77b&quot;&gt;1. About Rime&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org6a4960e&quot;&gt;2. ibus-rime&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org843a752&quot;&gt;2.1. installation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org02fa2b1&quot;&gt;2.2. issues&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org2c86aeb&quot;&gt;3. squirrel&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#org1530b0a&quot;&gt;3.1. &lt;code&gt;squirrel.custom.yaml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#orge67b1c8&quot;&gt;3.2. modified color scheme&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#org1917650&quot;&gt;3.3. &lt;code&gt;luna_pinyin.custom.yaml&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
    
    </summary>
    
      <category term="linux" scheme="https://angry-bird.github.io/categories/linux/"/>
    
    
      <category term="linux" scheme="https://angry-bird.github.io/tags/linux/"/>
    
      <category term="rime" scheme="https://angry-bird.github.io/tags/rime/"/>
    
  </entry>
  
</feed>
